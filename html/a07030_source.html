<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UFT-8"/>
<title> OpenFOAM&reg; Programmer's C++ documentation </title>
<!-- links -->
<link href="../OpenFOAMdocIcon.png" rel="icon" type="image/png" />
<link href="search/search.css" rel="stylesheet" type="text/css" />
<link href="../css/openfoam.css" rel="stylesheet" type="text/css" />
<script type="text/javaScript" src="search/search.js"></script>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<!-- meta info -->
<meta
    name="keywords"
    content="computational fluid dynamics, CFD, OpenFOAM, open source CFD, open source"
    />
</head>
<body>
<div class="page-container">
  <div class="header">
    <div class="header-top">
      <a class="sitelogo" href="http://www.openfoam.org" title="Home">
        <img class=left src="../css/img/OpenFOAMlogo.png">
      </a>
      <div class="sitename">
        <h1>
          <a href="http://foam.sourceforge.net/doc/Doxygen/html/"
             title="Source Guide">OpenFOAM C++ Documentation
          </a>
        </h1>
      </div>
    </div>  <!-- header-top -->
  </div>  <!-- header -->
  <div class="main">
    <div>
    <!-- begin of doxygen-generated content -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_7be0d8c199b9408ae01f5d77515b8def.html">mesh</a></li><li class="navelem"><a class="el" href="dir_c04cd1fd02bb0d2c4c2f2aa3e7a8ece5.html">autoMesh</a></li><li class="navelem"><a class="el" href="dir_2ed70c589061122d8c252fc1024d37eb.html">autoHexMesh</a></li><li class="navelem"><a class="el" href="dir_a4c6b2cc7c246ae75e729d303ab27485.html">autoHexMeshDriver</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">autoSnapDriverFeature.C</div>  </div>
</div><!--header-->
<div class="contents">
<a href="a07030.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*---------------------------------------------------------------------------*\</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">  =========                 |</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">  \\      /  F ield         | OpenFOAM: The Open Source CFD Toolbox</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">   \\    /   O peration     |</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">    \\  /    A nd           | Copyright (C) 2011-2016 OpenFOAM Foundation</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">     \\/     M anipulation  |</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">-------------------------------------------------------------------------------</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">License</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">    This file is part of OpenFOAM.</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">    OpenFOAM is free software: you can redistribute it and/or modify it</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">    under the terms of the GNU General Public License as published by</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">    the Free Software Foundation, either version 3 of the License, or</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">    (at your option) any later version.</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">    OpenFOAM is distributed in the hope that it will be useful, but WITHOUT</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">    ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">    FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">    for more details.</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">    You should have received a copy of the GNU General Public License</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">    along with OpenFOAM.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">\*---------------------------------------------------------------------------*/</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="a07029.html">autoSnapDriver.H</a>&quot;</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="a04889.html">polyTopoChange.H</a>&quot;</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="a08677.html">syncTools.H</a>&quot;</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="a05871.html">fvMesh.H</a>&quot;</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="a09836.html">OBJstream.H</a>&quot;</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="a04830.html">motionSmoother.H</a>&quot;</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="a07063.html">refinementSurfaces.H</a>&quot;</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="a07061.html">refinementFeatures.H</a>&quot;</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="a08181.html">unitConversion.H</a>&quot;</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="a08773.html">plane.H</a>&quot;</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="a04973.html">featureEdgeMesh.H</a>&quot;</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="a07267.html">treeDataPoint.H</a>&quot;</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="a07543.html">indexedOctree.H</a>&quot;</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="a07039.html">snapParameters.H</a>&quot;</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="a08705.html">PatchTools.H</a>&quot;</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment">// * * * * * * * * * * * * * * Static Data Members * * * * * * * * * * * * * //</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="keyword">namespace </span><a class="code" href="a10733.html">Foam</a></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;{</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</div><div class="line"><a name="l00047"></a><span class="lineno"><a class="line" href="a01368.html">   47</a></span>&#160;    <span class="keyword">class </span><a class="code" href="a01368.html">listPlusEqOp</a></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    {</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <span class="keyword">public</span>:</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div><div class="line"><a name="l00051"></a><span class="lineno"><a class="line" href="a01368.html#ae4420a9fd791f5ab9ebad1a3150ba899">   51</a></span>&#160;        <span class="keywordtype">void</span> <a class="code" href="a01368.html#ae4420a9fd791f5ab9ebad1a3150ba899">operator()</a>(<a class="code" href="a01364.html">List&lt;T&gt;</a>&amp; <a class="code" href="a06985.html#a9336ebf25087d91c818ee6e9ec29f8c1">x</a>, <span class="keyword">const</span> <a class="code" href="a01364.html">List&lt;T&gt;</a>&amp; <a class="code" href="a06984.html#afa8b67a0d5607da908ad92ed485e19e8">y</a>)<span class="keyword"> const</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="keyword">        </span>{</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;            <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> sz = x.<a class="code" href="a01364.html#a8a5f6fa29bd4b500caf186f60245b384">size</a>();</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;            x.<a class="code" href="a01364.html#aedb985ffeaf1bdbfeccc2a8730405703">setSize</a>(sz+y.<a class="code" href="a01364.html#a8a5f6fa29bd4b500caf186f60245b384">size</a>());</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;            <a class="code" href="a07669.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(y, i)</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;            {</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;                x[sz++] = y[i];</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;            }</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;        }</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    };</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;}</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="comment">// * * * * * * * * * * * * * Private Member Functions  * * * * * * * * * * * //</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="keywordtype">bool</span> Foam::autoSnapDriver::isFeaturePoint</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;(</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <span class="keyword">const</span> scalar featureCos,</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <span class="keyword">const</span> <a class="code" href="a01972.html">indirectPrimitivePatch</a>&amp; pp,</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <span class="keyword">const</span> <a class="code" href="a01756.html">PackedBoolList</a>&amp; isFeatureEdge,</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <span class="keyword">const</span> <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> pointI</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;)<span class="keyword"> const</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <span class="keyword">const</span> <a class="code" href="a00754.html">pointField</a>&amp; <a class="code" href="a04278.html#a1adbc4c519b2cee284a47d6682036276">points</a> = pp.<a class="code" href="a01972.html#a180aa335ba66b3224df33de8eb29b3bf">localPoints</a>();</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <span class="keyword">const</span> <a class="code" href="a01364.html">edgeList</a>&amp; edges = pp.<a class="code" href="a01972.html#aae82d34fe433288eb6b1f9dea53675c8">edges</a>();</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <span class="keyword">const</span> <a class="code" href="a01364.html">labelList</a>&amp; pEdges = pp.<a class="code" href="a01972.html#a9372e15b6f50db75f39f33f24d4887a4">pointEdges</a>()[pointI];</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> nFeatEdges = 0;</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <a class="code" href="a07669.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(pEdges, i)</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    {</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;        <span class="keywordflow">if</span> (isFeatureEdge[pEdges[i]])</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;        {</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;            nFeatEdges++;</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;            <span class="keywordflow">for</span> (<a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> j = i+1; j &lt; pEdges.<a class="code" href="a01364.html#a8a5f6fa29bd4b500caf186f60245b384">size</a>(); j++)</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;            {</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;                <span class="keywordflow">if</span> (isFeatureEdge[pEdges[j]])</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;                {</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;                    <span class="keyword">const</span> <a class="code" href="a00611.html">edge</a>&amp; eI = edges[pEdges[i]];</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;                    <span class="keyword">const</span> <a class="code" href="a00611.html">edge</a>&amp; eJ = edges[pEdges[j]];</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;                    <span class="keyword">const</span> <a class="code" href="a02791.html">point</a>&amp; <a class="code" href="a04438.html#a334650304cdcdff41898bee9eaf2e3db">p</a> = points[pointI];</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;                    <span class="keyword">const</span> <a class="code" href="a02791.html">point</a>&amp; pI = points[eI.<a class="code" href="a00611.html#ab53e2468b3b9d33c35dc8be5c6867e0f">otherVertex</a>(pointI)];</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;                    <span class="keyword">const</span> <a class="code" href="a02791.html">point</a>&amp; pJ = points[eJ.<a class="code" href="a00611.html#ab53e2468b3b9d33c35dc8be5c6867e0f">otherVertex</a>(pointI)];</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;                    <a class="code" href="a02791.html">vector</a> vI = p-pI;</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;                    scalar vIMag = <a class="code" href="a10733.html#a929da2a3fdcf3dacbbe0487d3a330dae">mag</a>(vI);</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;                    <a class="code" href="a02791.html">vector</a> vJ = pJ-<a class="code" href="a04438.html#a334650304cdcdff41898bee9eaf2e3db">p</a>;</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;                    scalar vJMag = <a class="code" href="a10733.html#a929da2a3fdcf3dacbbe0487d3a330dae">mag</a>(vJ);</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;                    <span class="keywordflow">if</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;                    (</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;                        vIMag &gt; SMALL</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;                     &amp;&amp; vJMag &gt; SMALL</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;                     &amp;&amp; ((vI/vIMag &amp; vJ/vJMag) &lt; featureCos)</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;                    )</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;                    {</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;                        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;                    }</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;                }</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;            }</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        }</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    }</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    <span class="keywordflow">if</span> (nFeatEdges == 1)</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    {</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        <span class="comment">// End of feature-edge string</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    }</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;}</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="keywordtype">void</span> Foam::autoSnapDriver::smoothAndConstrain</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;(</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <span class="keyword">const</span> <a class="code" href="a01756.html">PackedBoolList</a>&amp; isPatchMasterEdge,</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    <span class="keyword">const</span> <a class="code" href="a01972.html">indirectPrimitivePatch</a>&amp; pp,</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <span class="keyword">const</span> <a class="code" href="a01364.html">labelList</a>&amp; meshEdges,</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <span class="keyword">const</span> <a class="code" href="a01364.html">List&lt;pointConstraint&gt;</a>&amp; constraints,</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <a class="code" href="a00754.html">vectorField</a>&amp; disp</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;)<span class="keyword"> const</span></div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <span class="keyword">const</span> <a class="code" href="a00876.html">fvMesh</a>&amp; <a class="code" href="a04729.html#a4c1de256df6b3d186a85745b3149394a">mesh</a> = meshRefiner_.mesh();</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> avgIter = 0; avgIter &lt; 20; avgIter++)</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    {</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        <span class="comment">// Calculate average displacement of neighbours</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        <span class="comment">// - unconstrained (i.e. surface) points use average of all</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        <span class="comment">//   neighbouring points</span></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        <span class="comment">// - from testing it has been observed that it is not beneficial</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        <span class="comment">//   to have edge constrained points use average of all edge or point</span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;        <span class="comment">//   constrained neighbours since they&#39;re already attracted to</span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;        <span class="comment">//   the nearest point on the feature.</span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        <span class="comment">//   Having them attract to point-constrained neighbours does not</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        <span class="comment">//   make sense either since there is usually just one of them so</span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        <span class="comment">//   it severely distorts it.</span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        <span class="comment">// - same for feature points. They are already attracted to the</span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        <span class="comment">//   nearest feature point.</span></div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        <a class="code" href="a00754.html">vectorField</a> dispSum(pp.<a class="code" href="a01972.html#a9927abeba2c8506177084d644b6e573a">nPoints</a>(), <a class="code" href="a02791.html#ac3b79445511a1e3a6443b59ac93c394a">vector::zero</a>);</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        <a class="code" href="a01364.html">labelList</a> dispCount(pp.<a class="code" href="a01972.html#a9927abeba2c8506177084d644b6e573a">nPoints</a>(), 0);</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        <span class="keyword">const</span> <a class="code" href="a01364.html">labelListList</a>&amp; pointEdges = pp.<a class="code" href="a01972.html#a9372e15b6f50db75f39f33f24d4887a4">pointEdges</a>();</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;        <span class="keyword">const</span> <a class="code" href="a01364.html">edgeList</a>&amp; edges = pp.<a class="code" href="a01972.html#aae82d34fe433288eb6b1f9dea53675c8">edges</a>();</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;        <a class="code" href="a07669.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(pointEdges, pointI)</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        {</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;            <span class="keyword">const</span> <a class="code" href="a01364.html">labelList</a>&amp; pEdges = pointEdges[pointI];</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;            <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> nConstraints = constraints[pointI].<a class="code" href="a02735.html#a1c9828bc3de9502754d944c95a2ce0d9">first</a>();</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;            <span class="keywordflow">if</span> (nConstraints &lt;= 1)</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;            {</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;                <a class="code" href="a07669.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(pEdges, i)</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;                {</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;                    <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> edgeI = pEdges[i];</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;                    <span class="keywordflow">if</span> (isPatchMasterEdge[edgeI])</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;                    {</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;                        <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> nbrPointI = edges[edgeI].otherVertex(pointI);</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;                        <span class="keywordflow">if</span> (constraints[nbrPointI].first() &gt;= nConstraints)</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;                        {</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;                            dispSum[pointI] += disp[nbrPointI];</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;                            dispCount[pointI]++;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;                        }</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;                    }</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;                }</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;            }</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        }</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        <a class="code" href="a02545.html#a197ed77a9101bdfb37253bd3f507c017">syncTools::syncPointList</a></div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        (</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;            mesh,</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;            pp.<a class="code" href="a01972.html#ae4935f85c38392518565dd7c666e3caf">meshPoints</a>(),</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;            dispSum,</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;            <a class="code" href="a01863.html">plusEqOp&lt;point&gt;</a>(),</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;            <a class="code" href="a02791.html#ac3b79445511a1e3a6443b59ac93c394a">vector::zero</a>,</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;            <a class="code" href="a02663.html">mapDistribute::transform</a>()</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        );</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;        <a class="code" href="a02545.html#a197ed77a9101bdfb37253bd3f507c017">syncTools::syncPointList</a></div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        (</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;            mesh,</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;            pp.<a class="code" href="a01972.html#ae4935f85c38392518565dd7c666e3caf">meshPoints</a>(),</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;            dispCount,</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;            <a class="code" href="a01863.html">plusEqOp&lt;label&gt;</a>(),</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;            <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a>(0),</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;            <a class="code" href="a10733.html#a919915170941701c1223291531ad010c">mapDistribute::transform</a>()</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;        );</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;        <span class="comment">// Constraints</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        <a class="code" href="a07669.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(constraints, pointI)</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;        {</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;            <span class="keywordflow">if</span> (dispCount[pointI] &gt; 0)</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;            {</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;                <span class="comment">// Mix my displacement with neighbours&#39; displacement</span></div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;                disp[pointI] =</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;                    0.5</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;                   *(disp[pointI] + dispSum[pointI]/dispCount[pointI]);</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;            }</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        }</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    }</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;}</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="keywordtype">void</span> Foam::autoSnapDriver::calcNearestFace</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;(</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    <span class="keyword">const</span> <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> iter,</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    <span class="keyword">const</span> <a class="code" href="a01972.html">indirectPrimitivePatch</a>&amp; pp,</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <span class="keyword">const</span> <a class="code" href="a00754.html">scalarField</a>&amp; faceSnapDist,</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    <a class="code" href="a00754.html">vectorField</a>&amp; faceDisp,</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <a class="code" href="a00754.html">vectorField</a>&amp; faceSurfaceNormal,</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    <a class="code" href="a01364.html">labelList</a>&amp; faceSurfaceGlobalRegion,</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    <a class="code" href="a00754.html">vectorField</a>&amp; faceRotation</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;)<span class="keyword"> const</span></div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    <span class="keyword">const</span> <a class="code" href="a00876.html">fvMesh</a>&amp; <a class="code" href="a04729.html#a4c1de256df6b3d186a85745b3149394a">mesh</a> = meshRefiner_.mesh();</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    <span class="keyword">const</span> <a class="code" href="a02117.html">refinementSurfaces</a>&amp; surfaces = meshRefiner_.<a class="code" href="a02117.html#adcd7311efdf37e4637a13fa45dd405ef">surfaces</a>();</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    <span class="comment">// Displacement and orientation per pp face.</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    faceDisp.<a class="code" href="a01364.html#aedb985ffeaf1bdbfeccc2a8730405703">setSize</a>(pp.size());</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    faceDisp = <a class="code" href="a02791.html#ac3b79445511a1e3a6443b59ac93c394a">vector::zero</a>;</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    faceSurfaceNormal.<a class="code" href="a01364.html#aedb985ffeaf1bdbfeccc2a8730405703">setSize</a>(pp.size());</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    faceSurfaceNormal = <a class="code" href="a02791.html#ac3b79445511a1e3a6443b59ac93c394a">vector::zero</a>;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    faceSurfaceGlobalRegion.<a class="code" href="a01364.html#aedb985ffeaf1bdbfeccc2a8730405703">setSize</a>(pp.size());</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    faceSurfaceGlobalRegion = -1;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <span class="comment">// Divide surfaces into zoned and unzoned</span></div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    <span class="keyword">const</span> <a class="code" href="a01364.html">labelList</a> zonedSurfaces =</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;        <a class="code" href="a02502.html#a59d8871cd9c916017046af1f0a57c60f">surfaceZonesInfo::getNamedSurfaces</a>(surfaces.<a class="code" href="a02117.html#ae149e1770f0bee2a1c69148fe9c6e6a3">surfZones</a>());</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <span class="keyword">const</span> <a class="code" href="a01364.html">labelList</a> unzonedSurfaces =</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;        <a class="code" href="a02502.html#a1f8c08324d9ad320e759f30f23b2d151">surfaceZonesInfo::getUnnamedSurfaces</a>(surfaces.<a class="code" href="a02117.html#ae149e1770f0bee2a1c69148fe9c6e6a3">surfZones</a>());</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    <span class="comment">// Per pp face the current surface snapped to</span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    <a class="code" href="a01364.html">labelList</a> snapSurf(pp.size(), -1);</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    <span class="comment">// Do zoned surfaces</span></div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    <span class="comment">// ~~~~~~~~~~~~~~~~~</span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    <span class="comment">// Zoned faces only attract to corresponding surface</span></div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    <span class="comment">// Extract faces per zone</span></div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    <span class="keyword">const</span> <a class="code" href="a02033.html">PtrList&lt;surfaceZonesInfo&gt;</a>&amp; surfZones = surfaces.<a class="code" href="a02117.html#ae149e1770f0bee2a1c69148fe9c6e6a3">surfZones</a>();</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    <a class="code" href="a07669.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(zonedSurfaces, i)</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    {</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;        <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> zoneSurfI = zonedSurfaces[i];</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;        <span class="keyword">const</span> <a class="code" href="a02873.html">word</a>&amp; faceZoneName = surfZones[zoneSurfI].faceZoneName();</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;        <span class="comment">// Get indices of faces on pp that are also in zone</span></div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;        <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> zoneI = mesh.<a class="code" href="a01917.html#aa3b2dc268f43cd7ca2d043febae4f0e6">faceZones</a>().<a class="code" href="a02900.html#a09614eb35eb88968e053707fde62f274">findZoneID</a>(faceZoneName);</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;        <span class="keywordflow">if</span> (zoneI == -1)</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;        {</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;            <a class="code" href="a07724.html#af2484eff8084de37cba5d9d7a00fb293">FatalErrorInFunction</a></div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;Problem. Cannot find zone &quot;</span> &lt;&lt; faceZoneName</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;                &lt;&lt; <a class="code" href="a10733.html#a06ca7250d8e89caf05243ec094843642">exit</a>(<a class="code" href="a10733.html#ac50d206700f3f71855dd30c9a076de43">FatalError</a>);</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;        }</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;        <span class="keyword">const</span> <a class="code" href="a00740.html">faceZone</a>&amp; fZone = mesh.<a class="code" href="a01917.html#aa3b2dc268f43cd7ca2d043febae4f0e6">faceZones</a>()[zoneI];</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;        <a class="code" href="a01756.html">PackedBoolList</a> isZonedFace(mesh.<a class="code" href="a01969.html#a9be088de373a98524a153de7da0e92e8">nFaces</a>());</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;        <a class="code" href="a07669.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(fZone, i)</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;        {</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;            isZonedFace[fZone[i]] = 1;</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;        }</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;        <a class="code" href="a00603.html">DynamicList&lt;label&gt;</a> ppFaces(fZone.<a class="code" href="a01364.html#a8a5f6fa29bd4b500caf186f60245b384">size</a>());</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;        <a class="code" href="a00603.html">DynamicList&lt;label&gt;</a> meshFaces(fZone.<a class="code" href="a01364.html#a8a5f6fa29bd4b500caf186f60245b384">size</a>());</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;        <a class="code" href="a07669.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(pp.addressing(), i)</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;        {</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;            <span class="keywordflow">if</span> (isZonedFace[pp.addressing()[i]])</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;            {</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;                snapSurf[i] = zoneSurfI;</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;                ppFaces.append(i);</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;                meshFaces.append(pp.addressing()[i]);</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;            }</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;        }</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;        <span class="comment">//Pout&lt;&lt; &quot;For faceZone &quot; &lt;&lt; fZone.name()</span></div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;        <span class="comment">//    &lt;&lt; &quot; found &quot; &lt;&lt; ppFaces.size() &lt;&lt; &quot; out of &quot; &lt;&lt; pp.size()</span></div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;        <span class="comment">//    &lt;&lt; endl;</span></div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;        <a class="code" href="a00754.html">pointField</a> fc</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;        (</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;            <a class="code" href="a01972.html">indirectPrimitivePatch</a></div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;            (</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;                <a class="code" href="a01059.html">IndirectList&lt;face&gt;</a>(mesh.<a class="code" href="a01917.html#a4434536d50d4c14116249da802a1e2b2">faces</a>(), meshFaces),</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;                mesh.<a class="code" href="a01917.html#a084ae534298576408f063a6b3b820959">points</a>()</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;            ).faceCentres()</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;        );</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;        <a class="code" href="a01364.html">List&lt;pointIndexHit&gt;</a> hitInfo;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;        <a class="code" href="a01364.html">labelList</a> hitSurface;</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;        <a class="code" href="a01364.html">labelList</a> hitRegion;</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;        <a class="code" href="a00754.html">vectorField</a> hitNormal;</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;        surfaces.<a class="code" href="a02117.html#a5ce86015ef1926009d3bee3cc1b1784c">findNearestRegion</a></div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        (</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;            <a class="code" href="a10733.html#a1cb143a027019075df276006651d7048">labelList</a>(1, zoneSurfI),</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;            fc,</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;            <a class="code" href="a10733.html#a277dc11c581d53826ab5090b08f3b17b">sqr</a>(faceSnapDist),<span class="comment">// sqr of attract dist</span></div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;            hitSurface,</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;            hitInfo,</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;            hitRegion,</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;            hitNormal</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;        );</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;        <a class="code" href="a07669.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(hitInfo, hitI)</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;        {</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;            <span class="keywordflow">if</span> (hitInfo[hitI].hit())</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;            {</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;                <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> faceI = ppFaces[hitI];</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;                faceDisp[faceI] = hitInfo[hitI].hitPoint() - fc[hitI];</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;                faceSurfaceNormal[faceI] = hitNormal[hitI];</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;                faceSurfaceGlobalRegion[faceI] = surfaces.<a class="code" href="a02117.html#a1216e33f4746b2776b87629c0510fa3b">globalRegion</a></div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;                (</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;                    hitSurface[hitI],</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;                    hitRegion[hitI]</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;                );</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;            }</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;            {</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;                <a class="code" href="a07728.html#a58548a3fc67fb931bc4e99f94d5f41b8">WarningInFunction</a></div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot;Did not find surface near face centre &quot;</span> &lt;&lt; fc[hitI]</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;                    &lt;&lt; <a class="code" href="a10733.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;            }</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;        }</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    }</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    <span class="comment">// Do unzoned surfaces</span></div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    <span class="comment">// ~~~~~~~~~~~~~~~~~~~</span></div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    <span class="comment">// Unzoned faces attract to any unzoned surface</span></div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    <a class="code" href="a00603.html">DynamicList&lt;label&gt;</a> ppFaces(pp.size());</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    <a class="code" href="a00603.html">DynamicList&lt;label&gt;</a> meshFaces(pp.size());</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    <a class="code" href="a07669.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(pp.addressing(), i)</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    {</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;        <span class="keywordflow">if</span> (snapSurf[i] == -1)</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;        {</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;            ppFaces.append(i);</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;            meshFaces.append(pp.addressing()[i]);</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;        }</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    }</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    <span class="comment">//Pout&lt;&lt; &quot;Found &quot; &lt;&lt; ppFaces.size() &lt;&lt; &quot; unzoned faces out of &quot;</span></div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    <span class="comment">//   &lt;&lt; pp.size() &lt;&lt; endl;</span></div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    <a class="code" href="a00754.html">pointField</a> fc</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    (</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;        <a class="code" href="a01972.html">indirectPrimitivePatch</a></div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;        (</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;            <a class="code" href="a01059.html">IndirectList&lt;face&gt;</a>(mesh.<a class="code" href="a01917.html#a4434536d50d4c14116249da802a1e2b2">faces</a>(), meshFaces),</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;            mesh.<a class="code" href="a01917.html#a084ae534298576408f063a6b3b820959">points</a>()</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;        ).faceCentres()</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    );</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    <a class="code" href="a01364.html">List&lt;pointIndexHit&gt;</a> hitInfo;</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    <a class="code" href="a01364.html">labelList</a> hitSurface;</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    <a class="code" href="a01364.html">labelList</a> hitRegion;</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    <a class="code" href="a00754.html">vectorField</a> hitNormal;</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    surfaces.<a class="code" href="a02117.html#a5ce86015ef1926009d3bee3cc1b1784c">findNearestRegion</a></div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    (</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;        unzonedSurfaces,</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;        fc,</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;        <a class="code" href="a10733.html#a277dc11c581d53826ab5090b08f3b17b">sqr</a>(faceSnapDist),<span class="comment">// sqr of attract dist</span></div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;        hitSurface,</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;        hitInfo,</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;        hitRegion,</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;        hitNormal</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    );</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    <a class="code" href="a07669.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(hitInfo, hitI)</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    {</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;        <span class="keywordflow">if</span> (hitInfo[hitI].hit())</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;        {</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;            <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> faceI = ppFaces[hitI];</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;            faceDisp[faceI] = hitInfo[hitI].hitPoint() - fc[hitI];</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;            faceSurfaceNormal[faceI] = hitNormal[hitI];</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;            faceSurfaceGlobalRegion[faceI] = surfaces.<a class="code" href="a02117.html#a1216e33f4746b2776b87629c0510fa3b">globalRegion</a></div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;            (</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;                hitSurface[hitI],</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;                hitRegion[hitI]</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;            );</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;        }</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;        {</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;            <a class="code" href="a07728.html#a58548a3fc67fb931bc4e99f94d5f41b8">WarningInFunction</a></div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;Did not find surface near face centre &quot;</span> &lt;&lt; fc[hitI]</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;                &lt;&lt; <a class="code" href="a10733.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;        }</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    }</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    <span class="comment">// Determine rotation</span></div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    <span class="comment">// ~~~~~~~~~~~~~~~~~~</span></div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    <span class="comment">// Determine rotation axis</span></div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    faceRotation.<a class="code" href="a01364.html#aedb985ffeaf1bdbfeccc2a8730405703">setSize</a>(pp.size());</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    faceRotation = <a class="code" href="a02791.html#ac3b79445511a1e3a6443b59ac93c394a">vector::zero</a>;</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    <a class="code" href="a07669.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(faceRotation, faceI)</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    {</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;        <span class="comment">// Note: extend to &gt;180 degrees checking</span></div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;        faceRotation[faceI] =</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;            pp.<a class="code" href="a01972.html#aa454c45ea89f03f5d0bd92ea2f38d85a">faceNormals</a>()[faceI]</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;          ^ faceSurfaceNormal[faceI];</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    }</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    <span class="keywordflow">if</span> (debug&amp;<a class="code" href="a01470.html#a92dc814ea7fd34acae287945426740d3a42750666a219d68f9028ca726fe4fa71">meshRefinement::ATTRACTION</a>)</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    {</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;        dumpMove</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;        (</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;            mesh.<a class="code" href="a00876.html#a48fcf6de2789aff6b430b5fc1a05693f">time</a>().<a class="code" href="a02610.html#a2db7691b348697844893a04d3110e3d5">path</a>()</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;          / <span class="stringliteral">&quot;faceDisp_&quot;</span> + <a class="code" href="a10733.html#adcb0df2bd4953cb6bb390272d8263c3a">name</a>(iter) + <span class="stringliteral">&quot;.obj&quot;</span>,</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;            pp.<a class="code" href="a01972.html#a3f7e028407f9cc6cc3aa08672f9c1eb6">faceCentres</a>(),</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;            pp.<a class="code" href="a01972.html#a3f7e028407f9cc6cc3aa08672f9c1eb6">faceCentres</a>() + faceDisp</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;        );</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;        dumpMove</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;        (</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;            mesh.<a class="code" href="a00876.html#a48fcf6de2789aff6b430b5fc1a05693f">time</a>().<a class="code" href="a02610.html#a2db7691b348697844893a04d3110e3d5">path</a>()</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;          / <span class="stringliteral">&quot;faceRotation_&quot;</span> + <a class="code" href="a10733.html#adcb0df2bd4953cb6bb390272d8263c3a">name</a>(iter) + <span class="stringliteral">&quot;.obj&quot;</span>,</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;            pp.<a class="code" href="a01972.html#a3f7e028407f9cc6cc3aa08672f9c1eb6">faceCentres</a>(),</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;            pp.<a class="code" href="a01972.html#a3f7e028407f9cc6cc3aa08672f9c1eb6">faceCentres</a>() + faceRotation</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;        );</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    }</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;}</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;<span class="comment">// Collect (possibly remote) per point data of all surrounding faces</span></div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;<span class="comment">// ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;<span class="comment">// - faceSurfaceNormal</span></div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;<span class="comment">// - faceDisp</span></div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;<span class="comment">// - faceCentres&amp;faceNormal</span></div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;<span class="keywordtype">void</span> Foam::autoSnapDriver::calcNearestFacePointProperties</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;(</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    <span class="keyword">const</span> <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> iter,</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    <span class="keyword">const</span> <a class="code" href="a01972.html">indirectPrimitivePatch</a>&amp; pp,</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    <span class="keyword">const</span> <a class="code" href="a00754.html">vectorField</a>&amp; faceDisp,</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    <span class="keyword">const</span> <a class="code" href="a00754.html">vectorField</a>&amp; faceSurfaceNormal,</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    <span class="keyword">const</span> <a class="code" href="a01364.html">labelList</a>&amp; faceSurfaceGlobalRegion,</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    <a class="code" href="a01364.html">List</a>&lt;<a class="code" href="a01364.html">List&lt;point&gt;</a>&gt;&amp; pointFaceSurfNormals,</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    <a class="code" href="a01364.html">List</a>&lt;<a class="code" href="a01364.html">List&lt;point&gt;</a>&gt;&amp; pointFaceDisp,</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    <a class="code" href="a01364.html">List</a>&lt;<a class="code" href="a01364.html">List&lt;point&gt;</a>&gt;&amp; pointFaceCentres,</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    <a class="code" href="a01364.html">List&lt;labelList&gt;</a>&amp;    pointFacePatchID</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;)<span class="keyword"> const</span></div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    <span class="keyword">const</span> <a class="code" href="a00876.html">fvMesh</a>&amp; <a class="code" href="a04729.html#a4c1de256df6b3d186a85745b3149394a">mesh</a> = meshRefiner_.mesh();</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    <span class="keyword">const</span> <a class="code" href="a01756.html">PackedBoolList</a> isMasterFace(<a class="code" href="a02545.html#a46e7fd91866d97d6f21c35b1a892f0c4">syncTools::getMasterFaces</a>(mesh));</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    <span class="comment">// For now just get all surrounding face data. Expensive - should just</span></div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    <span class="comment">// store and sync data on coupled points only</span></div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    <span class="comment">// (see e.g PatchToolsNormals.C)</span></div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    pointFaceSurfNormals.setSize(pp.<a class="code" href="a01972.html#a9927abeba2c8506177084d644b6e573a">nPoints</a>());</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    pointFaceDisp.setSize(pp.<a class="code" href="a01972.html#a9927abeba2c8506177084d644b6e573a">nPoints</a>());</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    pointFaceCentres.setSize(pp.<a class="code" href="a01972.html#a9927abeba2c8506177084d644b6e573a">nPoints</a>());</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    pointFacePatchID.<a class="code" href="a01364.html#aedb985ffeaf1bdbfeccc2a8730405703">setSize</a>(pp.<a class="code" href="a01972.html#a9927abeba2c8506177084d644b6e573a">nPoints</a>());</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    <span class="comment">// Fill local data</span></div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    <a class="code" href="a07669.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(pp.<a class="code" href="a01972.html#a758f775d09e1be4cdd80daea4e402f55">pointFaces</a>(), pointI)</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    {</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;        <span class="keyword">const</span> <a class="code" href="a01364.html">labelList</a>&amp; <a class="code" href="a03926.html#a2f81f8565e1a8d530c3f1a811faa6614">pFaces</a> = pp.<a class="code" href="a01972.html#a758f775d09e1be4cdd80daea4e402f55">pointFaces</a>()[pointI];</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;        <span class="comment">// Count valid face normals</span></div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;        <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> nFaces = 0;</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;        <a class="code" href="a07669.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(pFaces, i)</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;        {</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;            <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> faceI = pFaces[i];</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;            <span class="keywordflow">if</span> (isMasterFace[faceI] &amp;&amp; faceSurfaceGlobalRegion[faceI] != -1)</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;            {</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;                nFaces++;</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;            }</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;        }</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;        <a class="code" href="a01364.html">List&lt;point&gt;</a>&amp; pNormals = pointFaceSurfNormals[pointI];</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;        pNormals.<a class="code" href="a01364.html#aedb985ffeaf1bdbfeccc2a8730405703">setSize</a>(nFaces);</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;        <a class="code" href="a01364.html">List&lt;point&gt;</a>&amp; pDisp = pointFaceDisp[pointI];</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;        pDisp.<a class="code" href="a01364.html#aedb985ffeaf1bdbfeccc2a8730405703">setSize</a>(nFaces);</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;        <a class="code" href="a01364.html">List&lt;point&gt;</a>&amp; pFc = pointFaceCentres[pointI];</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;        pFc.<a class="code" href="a01364.html#aedb985ffeaf1bdbfeccc2a8730405703">setSize</a>(nFaces);</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;        <a class="code" href="a01364.html">labelList</a>&amp; pFid = pointFacePatchID[pointI];</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;        pFid.<a class="code" href="a01364.html#aedb985ffeaf1bdbfeccc2a8730405703">setSize</a>(nFaces);</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;        nFaces = 0;</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;        <a class="code" href="a07669.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(pFaces, i)</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;        {</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;            <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> faceI = pFaces[i];</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;            <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> globalRegionI = faceSurfaceGlobalRegion[faceI];</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;            <span class="keywordflow">if</span> (isMasterFace[faceI] &amp;&amp; globalRegionI != -1)</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;            {</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;                pNormals[nFaces] = faceSurfaceNormal[faceI];</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;                pDisp[nFaces] = faceDisp[faceI];</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;                pFc[nFaces] = pp.<a class="code" href="a01972.html#a3f7e028407f9cc6cc3aa08672f9c1eb6">faceCentres</a>()[faceI];</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;                pFid[nFaces] = globalToMasterPatch_[globalRegionI];</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;                nFaces++;</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;            }</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;        }</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    }</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    <span class="comment">// Collect additionally &#39;normal&#39; boundary faces for boundaryPoints of pp</span></div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    <span class="comment">// ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    <span class="comment">// points on the boundary of pp should pick up non-pp normals</span></div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    <span class="comment">// as well for the feature-reconstruction to behave correctly.</span></div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    <span class="comment">// (the movement is already constrained outside correctly so it</span></div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    <span class="comment">//  is only that the unconstrained attraction vector is calculated</span></div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;    <span class="comment">//  correctly)</span></div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    {</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;        <span class="keyword">const</span> <a class="code" href="a01911.html">polyBoundaryMesh</a>&amp; pbm = mesh.<a class="code" href="a01917.html#a6b7f5ba89250dbd7a1c6c7860ab60fe3">boundaryMesh</a>();</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;        <a class="code" href="a01364.html">labelList</a> patchID(pbm.<a class="code" href="a01911.html#aa3446017bbf9e5b33aff322cb86f2072">patchID</a>());</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;        <span class="comment">// Unmark all non-coupled boundary faces</span></div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;        <a class="code" href="a07669.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(pbm, patchI)</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;        {</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;            <span class="keyword">const</span> <a class="code" href="a01935.html">polyPatch</a>&amp; pp = pbm[patchI];</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;            <span class="keywordflow">if</span> (pp.<a class="code" href="a01935.html#acffd678e538fc569f301aacdb4f019b7">coupled</a>() || isA&lt;emptyPolyPatch&gt;(pp))</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;            {</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;                <a class="code" href="a07669.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(pp, i)</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;                {</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;                    <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> meshFaceI = pp.<a class="code" href="a01935.html#a861f370e41af7d54d7ff91da65de6e6a">start</a>()+i;</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;                    patchID[meshFaceI-mesh.<a class="code" href="a01969.html#aa1eec60bd258a70018b8ffda0dced7bb">nInternalFaces</a>()] = -1;</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;                }</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;            }</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;        }</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;        <span class="comment">// Remove any meshed faces</span></div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;        <a class="code" href="a07669.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(pp.addressing(), i)</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;        {</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;            <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> meshFaceI = pp.addressing()[i];</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;            patchID[meshFaceI-mesh.<a class="code" href="a01969.html#aa1eec60bd258a70018b8ffda0dced7bb">nInternalFaces</a>()] = -1;</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;        }</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;        <span class="comment">// See if pp point uses any non-meshed boundary faces</span></div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;        <span class="keyword">const</span> <a class="code" href="a01364.html">labelList</a>&amp; boundaryPoints = pp.<a class="code" href="a01972.html#a4f3f0946737ca194c1976468d653dc21">boundaryPoints</a>();</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;        <a class="code" href="a07669.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(boundaryPoints, i)</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;        {</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;            <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> pointI = boundaryPoints[i];</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;            <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> meshPointI = pp.<a class="code" href="a01972.html#ae4935f85c38392518565dd7c666e3caf">meshPoints</a>()[pointI];</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;            <span class="keyword">const</span> <a class="code" href="a02791.html">point</a>&amp; pt = mesh.<a class="code" href="a01917.html#a084ae534298576408f063a6b3b820959">points</a>()[meshPointI];</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;            <span class="keyword">const</span> <a class="code" href="a01364.html">labelList</a>&amp; <a class="code" href="a03926.html#a2f81f8565e1a8d530c3f1a811faa6614">pFaces</a> = mesh.<a class="code" href="a01969.html#a758f775d09e1be4cdd80daea4e402f55">pointFaces</a>()[meshPointI];</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;            <a class="code" href="a01364.html">List&lt;point&gt;</a>&amp; pNormals = pointFaceSurfNormals[pointI];</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;            <a class="code" href="a01364.html">List&lt;point&gt;</a>&amp; pDisp = pointFaceDisp[pointI];</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;            <a class="code" href="a01364.html">List&lt;point&gt;</a>&amp; pFc = pointFaceCentres[pointI];</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;            <a class="code" href="a01364.html">labelList</a>&amp; pFid = pointFacePatchID[pointI];</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;            <a class="code" href="a07669.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(pFaces, i)</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;            {</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;                <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> meshFaceI = pFaces[i];</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;                <span class="keywordflow">if</span> (!mesh.<a class="code" href="a01969.html#a836bb7ec097736e6d0c7903e486776a8">isInternalFace</a>(meshFaceI))</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;                {</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;                    <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> patchI = patchID[meshFaceI-mesh.<a class="code" href="a01969.html#aa1eec60bd258a70018b8ffda0dced7bb">nInternalFaces</a>()];</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;                    <span class="keywordflow">if</span> (patchI != -1)</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;                    {</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;                        <a class="code" href="a02791.html">vector</a> fn = mesh.<a class="code" href="a01969.html#a460495623a8ec621b95f93bbcb3d4773">faceAreas</a>()[meshFaceI];</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;                        pNormals.<a class="code" href="a01364.html#a399dd2bf0d9a32016717dc90126f016b">append</a>(fn/<a class="code" href="a10733.html#a929da2a3fdcf3dacbbe0487d3a330dae">mag</a>(fn));</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;                        pDisp.<a class="code" href="a01364.html#a399dd2bf0d9a32016717dc90126f016b">append</a>(mesh.<a class="code" href="a01969.html#a56749206c7d38a4c3cfbf4103547e555">faceCentres</a>()[meshFaceI]-pt);</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;                        pFc.<a class="code" href="a01364.html#a399dd2bf0d9a32016717dc90126f016b">append</a>(mesh.<a class="code" href="a01969.html#a56749206c7d38a4c3cfbf4103547e555">faceCentres</a>()[meshFaceI]);</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;                        pFid.<a class="code" href="a01364.html#a399dd2bf0d9a32016717dc90126f016b">append</a>(patchI);</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;                    }</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;                }</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;            }</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;        }</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;    }</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;    <a class="code" href="a02545.html#a197ed77a9101bdfb37253bd3f507c017">syncTools::syncPointList</a></div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;    (</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;        mesh,</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;        pp.<a class="code" href="a01972.html#ae4935f85c38392518565dd7c666e3caf">meshPoints</a>(),</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;        pointFaceSurfNormals,</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;        <a class="code" href="a01368.html">listPlusEqOp&lt;point&gt;</a>(),</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;        <a class="code" href="a01364.html">List&lt;point&gt;</a>(),</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;        <a class="code" href="a10733.html#a919915170941701c1223291531ad010c">mapDistribute::transform</a>()</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    );</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    <a class="code" href="a02545.html#a197ed77a9101bdfb37253bd3f507c017">syncTools::syncPointList</a></div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    (</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;        mesh,</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;        pp.<a class="code" href="a01972.html#ae4935f85c38392518565dd7c666e3caf">meshPoints</a>(),</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;        pointFaceDisp,</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;        <a class="code" href="a01368.html">listPlusEqOp&lt;point&gt;</a>(),</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;        <a class="code" href="a01364.html">List&lt;point&gt;</a>(),</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;        <a class="code" href="a10733.html#a919915170941701c1223291531ad010c">mapDistribute::transform</a>()</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    );</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;    <a class="code" href="a02545.html#a197ed77a9101bdfb37253bd3f507c017">syncTools::syncPointList</a></div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;    (</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;        mesh,</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;        pp.<a class="code" href="a01972.html#ae4935f85c38392518565dd7c666e3caf">meshPoints</a>(),</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;        pointFaceCentres,</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;        <a class="code" href="a01368.html">listPlusEqOp&lt;point&gt;</a>(),</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;        <a class="code" href="a01364.html">List&lt;point&gt;</a>(),</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;        <a class="code" href="a02666.html">mapDistribute::transformPosition</a>()</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;    );</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;    <a class="code" href="a02545.html#a197ed77a9101bdfb37253bd3f507c017">syncTools::syncPointList</a></div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;    (</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;        mesh,</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;        pp.<a class="code" href="a01972.html#ae4935f85c38392518565dd7c666e3caf">meshPoints</a>(),</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;        pointFacePatchID,</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;        <a class="code" href="a01368.html">listPlusEqOp&lt;label&gt;</a>(),</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;        <a class="code" href="a01364.html">List&lt;label&gt;</a>()</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;    );</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;    <span class="comment">// Sort the data according to the face centres. This is only so we get</span></div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;    <span class="comment">// consistent behaviour serial and parallel.</span></div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;    <a class="code" href="a01364.html">labelList</a> visitOrder;</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;    <a class="code" href="a07669.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(pointFaceDisp, pointI)</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;    {</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;        <a class="code" href="a01364.html">List&lt;point&gt;</a>&amp; pNormals = pointFaceSurfNormals[pointI];</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;        <a class="code" href="a01364.html">List&lt;point&gt;</a>&amp; pDisp = pointFaceDisp[pointI];</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;        <a class="code" href="a01364.html">List&lt;point&gt;</a>&amp; pFc = pointFaceCentres[pointI];</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;        <a class="code" href="a01364.html">labelList</a>&amp; pFid = pointFacePatchID[pointI];</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;        <a class="code" href="a10733.html#acf128ea037506c14446998bb7ca39264">sortedOrder</a>(<a class="code" href="a10733.html#a929da2a3fdcf3dacbbe0487d3a330dae">mag</a>(pFc)(), visitOrder);</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;        pNormals = <a class="code" href="a01364.html">List&lt;point&gt;</a>(pNormals, visitOrder);</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;        pDisp = <a class="code" href="a01364.html">List&lt;point&gt;</a>(pDisp, visitOrder);</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;        pFc = <a class="code" href="a01364.html">List&lt;point&gt;</a>(pFc, visitOrder);</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;        pFid = <a class="code" href="a02733.html">UIndirectList&lt;label&gt;</a>(pFid, visitOrder)();</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;    }</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;}</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;<span class="comment">// Gets passed in offset to nearest point on feature edge. Calculates</span></div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;<span class="comment">// if the point has a different number of faces on either side of the feature</span></div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;<span class="comment">// and if so attracts the point to that non-dominant plane.</span></div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;<span class="keywordtype">void</span> Foam::autoSnapDriver::correctAttraction</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;(</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;    <span class="keyword">const</span> <a class="code" href="a00603.html">DynamicList&lt;point&gt;</a>&amp; surfacePoints,</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;    <span class="keyword">const</span> <a class="code" href="a00603.html">DynamicList&lt;label&gt;</a>&amp; surfaceCounts,</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;    <span class="keyword">const</span> <a class="code" href="a02791.html">point</a>&amp; edgePt,</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;    <span class="keyword">const</span> <a class="code" href="a02791.html">vector</a>&amp; edgeNormal,       <span class="comment">// normalised normal</span></div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;    <span class="keyword">const</span> <a class="code" href="a02791.html">point</a>&amp; pt,</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;    <a class="code" href="a02791.html">vector</a>&amp; edgeOffset              <span class="comment">// offset from pt to point on edge</span></div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;)<span class="keyword"> const</span></div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;    <span class="comment">// Tangential component along edge</span></div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;    scalar tang = ((pt-edgePt)&amp;edgeNormal);</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;    <a class="code" href="a01364.html">labelList</a> order;</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;    <a class="code" href="a10733.html#acf128ea037506c14446998bb7ca39264">Foam::sortedOrder</a>(surfaceCounts, order);</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;    <span class="keywordflow">if</span> (order[0] &lt; order[1])</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;    {</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;        <span class="comment">// There is a non-dominant plane. Use the point on the plane to</span></div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;        <span class="comment">// attract to.</span></div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;        <a class="code" href="a02791.html">vector</a> attractD = surfacePoints[order[0]]-edgePt;</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;        <span class="comment">// Tangential component along edge</span></div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;        scalar tang2 = (attractD&amp;edgeNormal);</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;        <span class="comment">// Normal component</span></div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;        attractD -= tang2*edgeNormal;</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;        <span class="comment">// Calculate fraction of normal distances</span></div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;        scalar magAttractD = <a class="code" href="a10733.html#a929da2a3fdcf3dacbbe0487d3a330dae">mag</a>(attractD);</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;        scalar fraction = magAttractD/(magAttractD+<a class="code" href="a10733.html#a929da2a3fdcf3dacbbe0487d3a330dae">mag</a>(edgeOffset));</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;        <a class="code" href="a02791.html">point</a> linePt =</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;            edgePt</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;          + ((1.0-fraction)*tang2 + fraction*tang)*edgeNormal;</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;        edgeOffset = linePt-pt;</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;    }</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;}</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;<a class="code" href="a01885.html">Foam::pointIndexHit</a> Foam::autoSnapDriver::findMultiPatchPoint</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;(</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;    <span class="keyword">const</span> <a class="code" href="a02791.html">point</a>&amp; pt,</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;    <span class="keyword">const</span> <a class="code" href="a01364.html">labelList</a>&amp; patchIDs,</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;    <span class="keyword">const</span> <a class="code" href="a01364.html">List&lt;point&gt;</a>&amp; faceCentres</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;)<span class="keyword"> const</span></div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;    <span class="comment">// Determine if multiple patchIDs</span></div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;    <span class="keywordflow">if</span> (patchIDs.<a class="code" href="a01364.html#a8a5f6fa29bd4b500caf186f60245b384">size</a>())</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;    {</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;        <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> patch0 = patchIDs[0];</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> i = 1; i &lt; patchIDs.<a class="code" href="a01364.html#a8a5f6fa29bd4b500caf186f60245b384">size</a>(); i++)</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;        {</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;            <span class="keywordflow">if</span> (patchIDs[i] != patch0)</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;            {</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="a10733.html#a29558ed008131ebedb6c3b965e9f4175">pointIndexHit</a>(<span class="keyword">true</span>, pt, <a class="code" href="a10733.html#acac9122dd09fe8b931de9af18f7f4ead">labelMax</a>);</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;            }</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;        }</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;    }</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="a10733.html#a29558ed008131ebedb6c3b965e9f4175">pointIndexHit</a>(<span class="keyword">false</span>, <a class="code" href="a02791.html#ac3b79445511a1e3a6443b59ac93c394a">vector::zero</a>, <a class="code" href="a10733.html#acac9122dd09fe8b931de9af18f7f4ead">labelMax</a>);</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;}</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;<a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">Foam::label</a> Foam::autoSnapDriver::findNormal</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;(</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;    <span class="keyword">const</span> scalar featureCos,</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;    <span class="keyword">const</span> <a class="code" href="a02791.html">vector</a>&amp; n,</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;    <span class="keyword">const</span> <a class="code" href="a00603.html">DynamicList&lt;vector&gt;</a>&amp; surfaceNormals</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;)<span class="keyword"> const</span></div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;    <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> index = -1;</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;    <a class="code" href="a07669.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(surfaceNormals, j)</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;    {</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;        scalar cosAngle = (n&amp;surfaceNormals[j]);</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;        <span class="keywordflow">if</span></div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;        (</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;            (cosAngle &gt;= featureCos)</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;         || (cosAngle &lt; (-1+0.001)) <span class="comment">// triangle baffles</span></div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;        )</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;        {</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;            index = j;</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;        }</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;    }</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;    <span class="keywordflow">return</span> index;</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;}</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;<span class="comment">// Detect multiple patches. Returns pointIndexHit:</span></div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;<span class="comment">// - false, index=-1 : single patch</span></div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;<span class="comment">// - true , index=0  : multiple patches but on different normals planes</span></div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;<span class="comment">//                     (so geometric feature edge is also a region edge)</span></div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;<span class="comment">// - true , index=1  : multiple patches on same normals plane i.e. flat region</span></div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;<span class="comment">//                     edge</span></div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;<a class="code" href="a01885.html">Foam::pointIndexHit</a> Foam::autoSnapDriver::findMultiPatchPoint</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;(</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;    <span class="keyword">const</span> <a class="code" href="a02791.html">point</a>&amp; pt,</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;    <span class="keyword">const</span> <a class="code" href="a01364.html">labelList</a>&amp; patchIDs,</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;    <span class="keyword">const</span> <a class="code" href="a00603.html">DynamicList&lt;vector&gt;</a>&amp; surfaceNormals,</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;    <span class="keyword">const</span> <a class="code" href="a01364.html">labelList</a>&amp; faceToNormalBin</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;)<span class="keyword"> const</span></div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;    <span class="keywordflow">if</span> (patchIDs.<a class="code" href="a02735.html#ac6e61de369e994009e36f344f99c15ad">empty</a>())</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;    {</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="a10733.html#a29558ed008131ebedb6c3b965e9f4175">pointIndexHit</a>(<span class="keyword">false</span>, pt, -1);</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;    }</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;    <span class="comment">// Detect single patch situation (to avoid allocation)</span></div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;    <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> patch0 = patchIDs[0];</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> i = 1; i &lt; patchIDs.<a class="code" href="a01364.html#a8a5f6fa29bd4b500caf186f60245b384">size</a>(); i++)</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;    {</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;        <span class="keywordflow">if</span> (patchIDs[i] != patch0)</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;        {</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;            patch0 = -1;</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;        }</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;    }</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;    <span class="keywordflow">if</span> (patch0 &gt;= 0)</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;    {</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;        <span class="comment">// Single patch</span></div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="a10733.html#a29558ed008131ebedb6c3b965e9f4175">pointIndexHit</a>(<span class="keyword">false</span>, pt, -1);</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;    }</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;    {</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;        <span class="keywordflow">if</span> (surfaceNormals.<a class="code" href="a01364.html#a8a5f6fa29bd4b500caf186f60245b384">size</a>() == 1)</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;        {</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;            <span class="comment">// Same normals plane, flat region edge.</span></div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="a10733.html#a29558ed008131ebedb6c3b965e9f4175">pointIndexHit</a>(<span class="keyword">true</span>, pt, 1);</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;        }</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;        {</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;            <span class="comment">// Detect per normals bin</span></div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;            <a class="code" href="a01364.html">labelList</a> normalToPatch(surfaceNormals.<a class="code" href="a01364.html#a8a5f6fa29bd4b500caf186f60245b384">size</a>(), -1);</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;            <a class="code" href="a07669.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(faceToNormalBin, i)</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;            {</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;                <span class="keywordflow">if</span> (faceToNormalBin[i] != -1)</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;                {</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;                    <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a>&amp; patch = normalToPatch[faceToNormalBin[i]];</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;                    <span class="keywordflow">if</span> (patch == -1)</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;                    {</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;                        <span class="comment">// First occurence</span></div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;                        patch = patchIDs[i];</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;                    }</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;                    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (patch == -2)</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;                    {</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;                        <span class="comment">// Already marked as being on multiple patches</span></div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;                    }</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;                    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (patch != patchIDs[i])</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;                    {</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;                        <span class="comment">// Mark as being on multiple patches</span></div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;                        patch = -2;</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;                    }</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;                }</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;            }</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;            <a class="code" href="a07669.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(normalToPatch, normalI)</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;            {</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;                <span class="keywordflow">if</span> (normalToPatch[normalI] == -2)</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;                {</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;                    <span class="comment">// Multiple patches on same normals plane, flat region</span></div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;                    <span class="comment">// edge</span></div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;                    <span class="keywordflow">return</span> <a class="code" href="a10733.html#a29558ed008131ebedb6c3b965e9f4175">pointIndexHit</a>(<span class="keyword">true</span>, pt, 1);</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;                }</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;            }</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;            <span class="comment">// All patches on either side of geometric feature anyway</span></div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="a10733.html#a29558ed008131ebedb6c3b965e9f4175">pointIndexHit</a>(<span class="keyword">true</span>, pt, 0);</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;        }</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;    }</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;}</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;<span class="keywordtype">void</span> Foam::autoSnapDriver::featureAttractionUsingReconstruction</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;(</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;    <span class="keyword">const</span> <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> iter,</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;    <span class="keyword">const</span> scalar featureCos,</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;    <span class="keyword">const</span> <a class="code" href="a01972.html">indirectPrimitivePatch</a>&amp; pp,</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;    <span class="keyword">const</span> <a class="code" href="a00754.html">scalarField</a>&amp; snapDist,</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;    <span class="keyword">const</span> <a class="code" href="a00754.html">vectorField</a>&amp; nearestDisp,</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;    <span class="keyword">const</span> <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> pointI,</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;    <span class="keyword">const</span> <a class="code" href="a01364.html">List</a>&lt;<a class="code" href="a01364.html">List&lt;point&gt;</a>&gt;&amp; pointFaceSurfNormals,</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;    <span class="keyword">const</span> <a class="code" href="a01364.html">List</a>&lt;<a class="code" href="a01364.html">List&lt;point&gt;</a>&gt;&amp; pointFaceDisp,</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;    <span class="keyword">const</span> <a class="code" href="a01364.html">List</a>&lt;<a class="code" href="a01364.html">List&lt;point&gt;</a>&gt;&amp; pointFaceCentres,</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;    <span class="keyword">const</span> <a class="code" href="a01364.html">labelListList</a>&amp; pointFacePatchID,</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;    <a class="code" href="a00603.html">DynamicList&lt;point&gt;</a>&amp; surfacePoints,</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;    <a class="code" href="a00603.html">DynamicList&lt;vector&gt;</a>&amp; surfaceNormals,</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;    <a class="code" href="a01364.html">labelList</a>&amp; faceToNormalBin,</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;    <a class="code" href="a02791.html">vector</a>&amp; patchAttraction,</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;    <a class="code" href="a01871.html">pointConstraint</a>&amp; patchConstraint</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;)<span class="keyword"> const</span></div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;    patchAttraction = <a class="code" href="a02791.html#ac3b79445511a1e3a6443b59ac93c394a">vector::zero</a>;</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;    patchConstraint = <a class="code" href="a01871.html">pointConstraint</a>();</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;    <span class="keyword">const</span> <a class="code" href="a01364.html">List&lt;point&gt;</a>&amp; pfSurfNormals = pointFaceSurfNormals[pointI];</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;    <span class="keyword">const</span> <a class="code" href="a01364.html">List&lt;point&gt;</a>&amp; pfDisp = pointFaceDisp[pointI];</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;    <span class="keyword">const</span> <a class="code" href="a01364.html">List&lt;point&gt;</a>&amp; pfCentres = pointFaceCentres[pointI];</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;    <span class="comment">// Bin according to surface normal</span></div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;    <span class="comment">// ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;    <span class="comment">//- Bins of differing normals:</span></div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;    <span class="comment">//  - one normal   : flat(tish) surface</span></div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;    <span class="comment">//  - two normals  : geometric feature edge</span></div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;    <span class="comment">//  - three normals: geometric feature point</span></div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;    <span class="comment">//  - four normals : too complex a feature</span></div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;    surfacePoints.<a class="code" href="a00603.html#ac8bb3912a3ce86b15842e79d0b421204">clear</a>();</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;    surfaceNormals.<a class="code" href="a00603.html#ac8bb3912a3ce86b15842e79d0b421204">clear</a>();</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;    <span class="comment">//- From face to above normals bin</span></div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;    faceToNormalBin.<a class="code" href="a01364.html#aedb985ffeaf1bdbfeccc2a8730405703">setSize</a>(pfDisp.<a class="code" href="a01364.html#a8a5f6fa29bd4b500caf186f60245b384">size</a>());</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;    faceToNormalBin = -1;</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;    <a class="code" href="a07669.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(pfSurfNormals, i)</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;    {</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;        <span class="keyword">const</span> <a class="code" href="a02791.html">point</a>&amp; fc = pfCentres[i];</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;        <span class="keyword">const</span> <a class="code" href="a02791.html">vector</a>&amp; fSNormal = pfSurfNormals[i];</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;        <span class="keyword">const</span> <a class="code" href="a02791.html">vector</a>&amp; fDisp = pfDisp[i];</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;        <span class="comment">// What to do with very far attraction? For now just ignore the face</span></div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="a10733.html#ae6fff2c6981e6d9618aa5038e69def6e">magSqr</a>(fDisp) &lt; <a class="code" href="a10733.html#a277dc11c581d53826ab5090b08f3b17b">sqr</a>(snapDist[pointI]) &amp;&amp; <a class="code" href="a10733.html#a929da2a3fdcf3dacbbe0487d3a330dae">mag</a>(fSNormal) &gt; VSMALL)</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;        {</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;            <span class="keyword">const</span> <a class="code" href="a02791.html">point</a> pt = fc + fDisp;</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;            <span class="comment">// Do we already have surface normal?</span></div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;            faceToNormalBin[i] = findNormal</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;            (</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;                featureCos,</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;                fSNormal,</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;                surfaceNormals</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;            );</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;            <span class="keywordflow">if</span> (faceToNormalBin[i] != -1)</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;            {</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;                <span class="comment">// Same normal</span></div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;            }</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;            {</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;                <span class="comment">// Now check if the planes go through the same edge or point</span></div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;                <span class="keywordflow">if</span> (surfacePoints.<a class="code" href="a01364.html#a8a5f6fa29bd4b500caf186f60245b384">size</a>() &lt;= 1)</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;                {</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;                    surfacePoints.<a class="code" href="a00603.html#a7b67b42af715604376ad63a681dee6d8">append</a>(pt);</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;                    faceToNormalBin[i] = surfaceNormals.<a class="code" href="a01364.html#a8a5f6fa29bd4b500caf186f60245b384">size</a>();</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;                    surfaceNormals.<a class="code" href="a00603.html#a7b67b42af715604376ad63a681dee6d8">append</a>(fSNormal);</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;                }</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (surfacePoints.<a class="code" href="a01364.html#a8a5f6fa29bd4b500caf186f60245b384">size</a>() == 2)</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;                {</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;                    <a class="code" href="a01858.html">plane</a> pl0(surfacePoints[0], surfaceNormals[0]);</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;                    <a class="code" href="a01858.html">plane</a> pl1(surfacePoints[1], surfaceNormals[1]);</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;                    <a class="code" href="a02078.html">plane::ray</a> r(pl0.<a class="code" href="a01858.html#aebd9283b52c2ab06723a37a4abf61466">planeIntersect</a>(pl1));</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;                    <a class="code" href="a02791.html">vector</a> featureNormal = r.dir() / <a class="code" href="a10733.html#a929da2a3fdcf3dacbbe0487d3a330dae">mag</a>(r.dir());</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;                    <span class="keywordflow">if</span> (<a class="code" href="a10733.html#a929da2a3fdcf3dacbbe0487d3a330dae">mag</a>(fSNormal&amp;featureNormal) &gt;= 0.001)</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;                    {</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;                        <span class="comment">// Definitely makes a feature point</span></div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;                        surfacePoints.<a class="code" href="a00603.html#a7b67b42af715604376ad63a681dee6d8">append</a>(pt);</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;                        faceToNormalBin[i] = surfaceNormals.<a class="code" href="a01364.html#a8a5f6fa29bd4b500caf186f60245b384">size</a>();</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;                        surfaceNormals.<a class="code" href="a00603.html#a7b67b42af715604376ad63a681dee6d8">append</a>(fSNormal);</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;                    }</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;                }</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (surfacePoints.<a class="code" href="a01364.html#a8a5f6fa29bd4b500caf186f60245b384">size</a>() == 3)</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;                {</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;                    <span class="comment">// Have already feature point. See if this new plane is</span></div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;                    <span class="comment">// the same point or not.</span></div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;                    <a class="code" href="a01858.html">plane</a> pl0(surfacePoints[0], surfaceNormals[0]);</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;                    <a class="code" href="a01858.html">plane</a> pl1(surfacePoints[1], surfaceNormals[1]);</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;                    <a class="code" href="a01858.html">plane</a> pl2(surfacePoints[2], surfaceNormals[2]);</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;                    <a class="code" href="a02791.html">point</a> p012(pl0.<a class="code" href="a01858.html#a20158d89e149ca638d4b63470e420781">planePlaneIntersect</a>(pl1, pl2));</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;                    <a class="code" href="a02078.html">plane::ray</a> r(pl0.<a class="code" href="a01858.html#aebd9283b52c2ab06723a37a4abf61466">planeIntersect</a>(pl1));</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;                    <a class="code" href="a02791.html">vector</a> featureNormal = r.dir() / <a class="code" href="a10733.html#a929da2a3fdcf3dacbbe0487d3a330dae">mag</a>(r.dir());</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;                    <span class="keywordflow">if</span> (<a class="code" href="a10733.html#a929da2a3fdcf3dacbbe0487d3a330dae">mag</a>(fSNormal&amp;featureNormal) &gt;= 0.001)</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;                    {</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;                        <a class="code" href="a01858.html">plane</a> pl3(pt, fSNormal);</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;                        <a class="code" href="a02791.html">point</a> p013(pl0.<a class="code" href="a01858.html#a20158d89e149ca638d4b63470e420781">planePlaneIntersect</a>(pl1, pl3));</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;                        <span class="keywordflow">if</span> (<a class="code" href="a10733.html#a929da2a3fdcf3dacbbe0487d3a330dae">mag</a>(p012-p013) &gt; snapDist[pointI])</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;                        {</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;                            <span class="comment">// Different feature point</span></div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;                            surfacePoints.<a class="code" href="a00603.html#a7b67b42af715604376ad63a681dee6d8">append</a>(pt);</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;                            faceToNormalBin[i] = surfaceNormals.<a class="code" href="a01364.html#a8a5f6fa29bd4b500caf186f60245b384">size</a>();</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;                            surfaceNormals.<a class="code" href="a00603.html#a7b67b42af715604376ad63a681dee6d8">append</a>(fSNormal);</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;                        }</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;                    }</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;                }</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;            }</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;        }</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;    }</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;    <span class="keyword">const</span> <a class="code" href="a02791.html">point</a>&amp; pt = pp.<a class="code" href="a01972.html#a180aa335ba66b3224df33de8eb29b3bf">localPoints</a>()[pointI];</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;    <span class="comment">// Check the number of directions</span></div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;    <span class="keywordflow">if</span> (surfaceNormals.<a class="code" href="a01364.html#a8a5f6fa29bd4b500caf186f60245b384">size</a>() == 1)</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;    {</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;        <span class="comment">// Normal distance to plane</span></div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;        <a class="code" href="a02791.html">vector</a> d =</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;            ((surfacePoints[0]-pt) &amp; surfaceNormals[0])</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;           *surfaceNormals[0];</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;        <span class="comment">// Trim to snap distance</span></div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="a10733.html#ae6fff2c6981e6d9618aa5038e69def6e">magSqr</a>(d) &gt; <a class="code" href="a10733.html#a277dc11c581d53826ab5090b08f3b17b">sqr</a>(snapDist[pointI]))</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;        {</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;            d *= <a class="code" href="a10733.html#a8616bd62eebf2342a80222fecb1bda71">Foam::sqrt</a>(<a class="code" href="a10733.html#a277dc11c581d53826ab5090b08f3b17b">sqr</a>(snapDist[pointI])/<a class="code" href="a10733.html#ae6fff2c6981e6d9618aa5038e69def6e">magSqr</a>(d));</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;        }</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;        patchAttraction = d;</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;        <span class="comment">// Store constraints</span></div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;        patchConstraint.<a class="code" href="a01871.html#a1c47e7042699d937ffa928bbdcf19556">applyConstraint</a>(surfaceNormals[0]);</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;    }</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (surfaceNormals.<a class="code" href="a01364.html#a8a5f6fa29bd4b500caf186f60245b384">size</a>() == 2)</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;    {</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;        <a class="code" href="a01858.html">plane</a> pl0(surfacePoints[0], surfaceNormals[0]);</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;        <a class="code" href="a01858.html">plane</a> pl1(surfacePoints[1], surfaceNormals[1]);</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;        <a class="code" href="a02078.html">plane::ray</a> r(pl0.<a class="code" href="a01858.html#aebd9283b52c2ab06723a37a4abf61466">planeIntersect</a>(pl1));</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;        <a class="code" href="a02791.html">vector</a> n = r.dir() / <a class="code" href="a10733.html#a929da2a3fdcf3dacbbe0487d3a330dae">mag</a>(r.dir());</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;        <span class="comment">// Get nearest point on infinite ray</span></div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;        <a class="code" href="a02791.html">vector</a> d = r.refPoint()-pt;</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;        d -= (d&amp;<a class="code" href="a07006.html#a830e93cc5b8d859299d1a788c12be8ac">n</a>)*n;</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;        <span class="comment">// Trim to snap distance</span></div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="a10733.html#ae6fff2c6981e6d9618aa5038e69def6e">magSqr</a>(d) &gt; <a class="code" href="a10733.html#a277dc11c581d53826ab5090b08f3b17b">sqr</a>(snapDist[pointI]))</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;        {</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;            d *= <a class="code" href="a10733.html#a8616bd62eebf2342a80222fecb1bda71">Foam::sqrt</a>(<a class="code" href="a10733.html#a277dc11c581d53826ab5090b08f3b17b">sqr</a>(snapDist[pointI])/<a class="code" href="a10733.html#ae6fff2c6981e6d9618aa5038e69def6e">magSqr</a>(d));</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;        }</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;        patchAttraction = d;</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;        <span class="comment">// Store constraints</span></div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;        patchConstraint.<a class="code" href="a01871.html#a1c47e7042699d937ffa928bbdcf19556">applyConstraint</a>(surfaceNormals[0]);</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;        patchConstraint.<a class="code" href="a01871.html#a1c47e7042699d937ffa928bbdcf19556">applyConstraint</a>(surfaceNormals[1]);</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;    }</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (surfaceNormals.<a class="code" href="a01364.html#a8a5f6fa29bd4b500caf186f60245b384">size</a>() == 3)</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;    {</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;        <span class="comment">// Calculate point from the faces.</span></div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;        <a class="code" href="a01858.html">plane</a> pl0(surfacePoints[0], surfaceNormals[0]);</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;        <a class="code" href="a01858.html">plane</a> pl1(surfacePoints[1], surfaceNormals[1]);</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;        <a class="code" href="a01858.html">plane</a> pl2(surfacePoints[2], surfaceNormals[2]);</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;        <a class="code" href="a02791.html">point</a> cornerPt(pl0.<a class="code" href="a01858.html#a20158d89e149ca638d4b63470e420781">planePlaneIntersect</a>(pl1, pl2));</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;        <a class="code" href="a02791.html">vector</a> d = cornerPt - pt;</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;        <span class="comment">// Trim to snap distance</span></div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="a10733.html#ae6fff2c6981e6d9618aa5038e69def6e">magSqr</a>(d) &gt; <a class="code" href="a10733.html#a277dc11c581d53826ab5090b08f3b17b">sqr</a>(snapDist[pointI]))</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;        {</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;            d *= <a class="code" href="a10733.html#a8616bd62eebf2342a80222fecb1bda71">Foam::sqrt</a>(<a class="code" href="a10733.html#a277dc11c581d53826ab5090b08f3b17b">sqr</a>(snapDist[pointI])/<a class="code" href="a10733.html#ae6fff2c6981e6d9618aa5038e69def6e">magSqr</a>(d));</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;        }</div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;        patchAttraction = d;</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;        <span class="comment">// Store constraints</span></div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;        patchConstraint.<a class="code" href="a01871.html#a1c47e7042699d937ffa928bbdcf19556">applyConstraint</a>(surfaceNormals[0]);</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;        patchConstraint.<a class="code" href="a01871.html#a1c47e7042699d937ffa928bbdcf19556">applyConstraint</a>(surfaceNormals[1]);</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;        patchConstraint.<a class="code" href="a01871.html#a1c47e7042699d937ffa928bbdcf19556">applyConstraint</a>(surfaceNormals[2]);</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;    }</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;}</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;<span class="comment">// Special version that calculates attraction in one go</span></div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;<span class="keywordtype">void</span> Foam::autoSnapDriver::featureAttractionUsingReconstruction</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;(</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;    <span class="keyword">const</span> <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> iter,</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> avoidSnapProblems,</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;    <span class="keyword">const</span> scalar featureCos,</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;    <span class="keyword">const</span> <a class="code" href="a01972.html">indirectPrimitivePatch</a>&amp; pp,</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;    <span class="keyword">const</span> <a class="code" href="a00754.html">scalarField</a>&amp; snapDist,</div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;    <span class="keyword">const</span> <a class="code" href="a00754.html">vectorField</a>&amp; nearestDisp,</div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;    <span class="keyword">const</span> <a class="code" href="a01364.html">List</a>&lt;<a class="code" href="a01364.html">List&lt;point&gt;</a>&gt;&amp; pointFaceSurfNormals,</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;    <span class="keyword">const</span> <a class="code" href="a01364.html">List</a>&lt;<a class="code" href="a01364.html">List&lt;point&gt;</a>&gt;&amp; pointFaceDisp,</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;    <span class="keyword">const</span> <a class="code" href="a01364.html">List</a>&lt;<a class="code" href="a01364.html">List&lt;point&gt;</a>&gt;&amp; pointFaceCentres,</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;    <span class="keyword">const</span> <a class="code" href="a01364.html">labelListList</a>&amp; pointFacePatchID,</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;    <a class="code" href="a00754.html">vectorField</a>&amp; patchAttraction,</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;    <a class="code" href="a01364.html">List&lt;pointConstraint&gt;</a>&amp; patchConstraints</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;)<span class="keyword"> const</span></div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;    <a class="code" href="a00087.html">autoPtr&lt;OBJstream&gt;</a> feStr;</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;    <a class="code" href="a00087.html">autoPtr&lt;OBJstream&gt;</a> fpStr;</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;    <span class="keywordflow">if</span> (debug&amp;<a class="code" href="a01470.html#a92dc814ea7fd34acae287945426740d3a42750666a219d68f9028ca726fe4fa71">meshRefinement::ATTRACTION</a>)</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;    {</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;        feStr.<a class="code" href="a00087.html#ab46a1bc64c9af6414376c6c18d3bee62">reset</a></div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;        (</div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;            <span class="keyword">new</span> <a class="code" href="a01692.html">OBJstream</a></div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;            (</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;                meshRefiner_.mesh().time().path()</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;              / <span class="stringliteral">&quot;implicitFeatureEdge_&quot;</span> + <a class="code" href="a10733.html#adcb0df2bd4953cb6bb390272d8263c3a">name</a>(iter) + <span class="stringliteral">&quot;.obj&quot;</span></div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;            )</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;        );</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;        <a class="code" href="a10733.html#a501e80d1e14c94973e82f1555e7eb711">Info</a>&lt;&lt; <span class="stringliteral">&quot;Dumping implicit feature-edge direction to &quot;</span></div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;            &lt;&lt; feStr().name() &lt;&lt; <a class="code" href="a10733.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;        fpStr.<a class="code" href="a00087.html#ab46a1bc64c9af6414376c6c18d3bee62">reset</a></div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;        (</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;            <span class="keyword">new</span> <a class="code" href="a01692.html">OBJstream</a></div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;            (</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;                meshRefiner_.mesh().time().path()</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;              / <span class="stringliteral">&quot;implicitFeaturePoint_&quot;</span> + <a class="code" href="a10733.html#adcb0df2bd4953cb6bb390272d8263c3a">name</a>(iter) + <span class="stringliteral">&quot;.obj&quot;</span></div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;            )</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;        );</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;        <a class="code" href="a10733.html#a501e80d1e14c94973e82f1555e7eb711">Info</a>&lt;&lt; <span class="stringliteral">&quot;Dumping implicit feature-point direction to &quot;</span></div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;            &lt;&lt; fpStr().name() &lt;&lt; <a class="code" href="a10733.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;    }</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;    <a class="code" href="a00603.html">DynamicList&lt;point&gt;</a> surfacePoints(4);</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;    <a class="code" href="a00603.html">DynamicList&lt;vector&gt;</a> surfaceNormals(4);</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;    <a class="code" href="a01364.html">labelList</a> faceToNormalBin;</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;    <a class="code" href="a07669.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(pp.<a class="code" href="a01972.html#a180aa335ba66b3224df33de8eb29b3bf">localPoints</a>(), pointI)</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;    {</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;        <a class="code" href="a02791.html">vector</a> attraction = <a class="code" href="a02791.html#ac3b79445511a1e3a6443b59ac93c394a">vector::zero</a>;</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;        <a class="code" href="a01871.html">pointConstraint</a> constraint;</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;        featureAttractionUsingReconstruction</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;        (</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;            iter,</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;            featureCos,</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;            pp,</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;            snapDist,</div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;            nearestDisp,</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;            pointI,</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;            pointFaceSurfNormals,</div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;            pointFaceDisp,</div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;            pointFaceCentres,</div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;            pointFacePatchID,</div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;</div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;            surfacePoints,</div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;            surfaceNormals,</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;            faceToNormalBin,</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;            attraction,</div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;            constraint</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;        );</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;        <span class="keywordflow">if</span></div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;        (</div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;            (constraint.<a class="code" href="a02695.html#a6bc9dc0330d36f5f75e816ddc4ec213e">first</a>() &gt; patchConstraints[pointI].<a class="code" href="a02735.html#a1c9828bc3de9502754d944c95a2ce0d9">first</a>())</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;         || (</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;                (constraint.<a class="code" href="a02695.html#a6bc9dc0330d36f5f75e816ddc4ec213e">first</a>() == patchConstraints[pointI].<a class="code" href="a02735.html#a1c9828bc3de9502754d944c95a2ce0d9">first</a>())</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;             &amp;&amp; (<a class="code" href="a10733.html#ae6fff2c6981e6d9618aa5038e69def6e">magSqr</a>(attraction) &lt; <a class="code" href="a10733.html#ae6fff2c6981e6d9618aa5038e69def6e">magSqr</a>(patchAttraction[pointI]))</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;            )</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;        )</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;        {</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;            patchAttraction[pointI] = attraction;</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;            patchConstraints[pointI] = constraint;</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;            <span class="keyword">const</span> <a class="code" href="a02791.html">point</a>&amp; pt = pp.<a class="code" href="a01972.html#a180aa335ba66b3224df33de8eb29b3bf">localPoints</a>()[pointI];</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;            <span class="keywordflow">if</span> (patchConstraints[pointI].first() == 2 &amp;&amp; feStr.<a class="code" href="a00087.html#a8d985300b138b6c5556ab17ed4df3b38">valid</a>())</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;            {</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;                feStr().write(<a class="code" href="a10733.html#a2e0318a3a140a9ee64174b45fbfd45f0">linePointRef</a>(pt, pt+patchAttraction[pointI]));</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;            }</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (patchConstraints[pointI].first() == 3 &amp;&amp; fpStr.<a class="code" href="a00087.html#a8d985300b138b6c5556ab17ed4df3b38">valid</a>())</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;            {</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;                fpStr().write(<a class="code" href="a10733.html#a2e0318a3a140a9ee64174b45fbfd45f0">linePointRef</a>(pt, pt+patchAttraction[pointI]));</div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;            }</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;        }</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;    }</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;}</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;</div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;<span class="keywordtype">void</span> Foam::autoSnapDriver::stringFeatureEdges</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;(</div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;    <span class="keyword">const</span> <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> iter,</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;    <span class="keyword">const</span> scalar featureCos,</div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;    <span class="keyword">const</span> <a class="code" href="a01972.html">indirectPrimitivePatch</a>&amp; pp,</div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;    <span class="keyword">const</span> <a class="code" href="a00754.html">scalarField</a>&amp; snapDist,</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;    <span class="keyword">const</span> <a class="code" href="a00754.html">vectorField</a>&amp; rawPatchAttraction,</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;    <span class="keyword">const</span> <a class="code" href="a01364.html">List&lt;pointConstraint&gt;</a>&amp; rawPatchConstraints,</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;    <a class="code" href="a00754.html">vectorField</a>&amp; patchAttraction,</div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;    <a class="code" href="a01364.html">List&lt;pointConstraint&gt;</a>&amp; patchConstraints</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;)<span class="keyword"> const</span></div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;    <span class="comment">// Snap edges to feature edges</span></div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;    <span class="comment">// ~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;    <span class="comment">// Walk existing edges and snap remaining ones (that are marked as</span></div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;    <span class="comment">// feature edges in rawPatchConstraints)</span></div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;</div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;    <span class="comment">// What this does is fill in any faces where not all points</span></div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;    <span class="comment">// on the face are being attracted:</span></div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;<span class="comment">           +</span></div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;<span class="comment">          / \</span></div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;<span class="comment">         /   \</span></div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;<span class="comment">      ---+    +---</span></div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;<span class="comment">         \   /</span></div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;<span class="comment">          \ /</span></div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;<span class="comment">           +</span></div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;    <span class="comment">// so the top and bottom will never get attracted since the nearest</span></div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;    <span class="comment">// back from the feature edge will always be one of the left or right</span></div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;    <span class="comment">// points since the face is diamond like. So here we walk the feature edges</span></div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;    <span class="comment">// and add any non-attracted points.</span></div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;    <span class="keywordflow">while</span> (<span class="keyword">true</span>)</div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;    {</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;        <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> nChanged = 0;</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;</div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;        <span class="keyword">const</span> <a class="code" href="a01364.html">labelListList</a>&amp; pointEdges = pp.<a class="code" href="a01972.html#a9372e15b6f50db75f39f33f24d4887a4">pointEdges</a>();</div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;        <a class="code" href="a07669.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(pointEdges, pointI)</div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;        {</div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;            <span class="keywordflow">if</span> (patchConstraints[pointI].first() == 2)</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;            {</div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;                <span class="keyword">const</span> <a class="code" href="a02791.html">point</a>&amp; pt = pp.<a class="code" href="a01972.html#a180aa335ba66b3224df33de8eb29b3bf">localPoints</a>()[pointI];</div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;                <span class="keyword">const</span> <a class="code" href="a01364.html">labelList</a>&amp; pEdges = pointEdges[pointI];</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;                <span class="keyword">const</span> <a class="code" href="a02791.html">vector</a>&amp; featVec = patchConstraints[pointI].second();</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;                <span class="comment">// Detect whether there are edges in both directions.</span></div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;                <span class="comment">// (direction along the feature edge that is)</span></div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;                <span class="keywordtype">bool</span> hasPos = <span class="keyword">false</span>;</div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;                <span class="keywordtype">bool</span> hasNeg = <span class="keyword">false</span>;</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;                <a class="code" href="a07669.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(pEdges, pEdgeI)</div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;                {</div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;                    <span class="keyword">const</span> <a class="code" href="a00611.html">edge</a>&amp; <a class="code" href="a10733.html#a4225a7492f7d468ad5b985282c8ee7b1">e</a> = pp.<a class="code" href="a01972.html#aae82d34fe433288eb6b1f9dea53675c8">edges</a>()[pEdges[pEdgeI]];</div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;                    <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> nbrPointI = e.<a class="code" href="a00611.html#ab53e2468b3b9d33c35dc8be5c6867e0f">otherVertex</a>(pointI);</div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;</div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;                    <span class="keywordflow">if</span> (patchConstraints[nbrPointI].first() &gt; 1)</div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;                    {</div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;                        <span class="keyword">const</span> <a class="code" href="a02791.html">point</a>&amp; nbrPt = pp.<a class="code" href="a01972.html#a180aa335ba66b3224df33de8eb29b3bf">localPoints</a>()[nbrPointI];</div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;                        <span class="keyword">const</span> <a class="code" href="a02791.html">point</a> featPt =</div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;                            nbrPt + patchAttraction[nbrPointI];</div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;                        <span class="keyword">const</span> scalar cosAngle = (featVec &amp; (featPt-pt));</div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;</div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;                        <span class="keywordflow">if</span> (cosAngle &gt; 0)</div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;                        {</div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;                            hasPos = <span class="keyword">true</span>;</div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;                        }</div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;                        <span class="keywordflow">else</span></div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;                        {</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;                            hasNeg = <span class="keyword">true</span>;</div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;                        }</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;                    }</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;                }</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;                <span class="keywordflow">if</span> (!hasPos || !hasNeg)</div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;                {</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;                    <span class="comment">//Pout&lt;&lt; &quot;**Detected feature string end at  &quot;</span></div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;                    <span class="comment">//    &lt;&lt; pp.localPoints()[pointI] &lt;&lt; endl;</span></div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;                    <span class="comment">// No string. Assign best choice on either side</span></div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;                    <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> bestPosPointI = -1;</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;                    scalar minPosDistSqr = GREAT;</div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;                    <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> bestNegPointI = -1;</div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;                    scalar minNegDistSqr = GREAT;</div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;</div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;                    <a class="code" href="a07669.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(pEdges, pEdgeI)</div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;                    {</div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;                        <span class="keyword">const</span> <a class="code" href="a00611.html">edge</a>&amp; <a class="code" href="a10733.html#a4225a7492f7d468ad5b985282c8ee7b1">e</a> = pp.<a class="code" href="a01972.html#aae82d34fe433288eb6b1f9dea53675c8">edges</a>()[pEdges[pEdgeI]];</div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;                        <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> nbrPointI = e.<a class="code" href="a00611.html#ab53e2468b3b9d33c35dc8be5c6867e0f">otherVertex</a>(pointI);</div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;                        <span class="keywordflow">if</span></div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;                        (</div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;                            patchConstraints[nbrPointI].first() &lt;= 1</div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;                         &amp;&amp; rawPatchConstraints[nbrPointI].first() &gt; 1</div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;                        )</div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;                        {</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;                            <span class="keyword">const</span> <a class="code" href="a02791.html">vector</a>&amp; nbrFeatVec =</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;                                rawPatchConstraints[pointI].second();</div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;</div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;                            <span class="keywordflow">if</span> (<a class="code" href="a10733.html#a929da2a3fdcf3dacbbe0487d3a330dae">mag</a>(featVec&amp;nbrFeatVec) &gt; featureCos)</div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;                            {</div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;                                <span class="comment">// nbrPointI attracted to sameish feature</span></div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;                                <span class="comment">// Note: also check on position.</span></div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;</div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;                                scalar d2 = <a class="code" href="a10733.html#ae6fff2c6981e6d9618aa5038e69def6e">magSqr</a></div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;                                (</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;                                    rawPatchAttraction[nbrPointI]</div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;                                );</div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;                                <span class="keyword">const</span> <a class="code" href="a02791.html">point</a> featPt =</div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;                                    pp.<a class="code" href="a01972.html#a180aa335ba66b3224df33de8eb29b3bf">localPoints</a>()[nbrPointI]</div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;                                  + rawPatchAttraction[nbrPointI];</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;                                <span class="keyword">const</span> scalar cosAngle =</div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;                                    (featVec &amp; (featPt-pt));</div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;</div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;                                <span class="keywordflow">if</span> (cosAngle &gt; 0)</div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;                                {</div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;                                    <span class="keywordflow">if</span> (!hasPos &amp;&amp; d2 &lt; minPosDistSqr)</div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;                                    {</div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;                                        minPosDistSqr = d2;</div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;                                        bestPosPointI = nbrPointI;</div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;                                    }</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;                                }</div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;                                <span class="keywordflow">else</span></div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;                                {</div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;                                    <span class="keywordflow">if</span> (!hasNeg &amp;&amp; d2 &lt; minNegDistSqr)</div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;                                    {</div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;                                        minNegDistSqr = d2;</div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;                                        bestNegPointI = nbrPointI;</div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;                                    }</div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;                                }</div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;                            }</div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;                        }</div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;                    }</div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;</div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;                    <span class="keywordflow">if</span> (bestPosPointI != -1)</div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;                    {</div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;                        <span class="comment">// Use reconstructed-feature attraction. Use only</span></div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;                        <span class="comment">// part of it since not sure...</span></div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;                        <span class="comment">//const point&amp; bestPt =</span></div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;                        <span class="comment">//    pp.localPoints()[bestPosPointI];</span></div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;                        <span class="comment">//Pout&lt;&lt; &quot;**Overriding point &quot; &lt;&lt; bestPt</span></div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;                        <span class="comment">//    &lt;&lt; &quot; on reconstructed feature edge at &quot;</span></div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;                        <span class="comment">//    &lt;&lt; rawPatchAttraction[bestPosPointI]+bestPt</span></div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;                        <span class="comment">//    &lt;&lt; &quot; to attracted-to-feature-edge.&quot; &lt;&lt; endl;</span></div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;                        patchAttraction[bestPosPointI] =</div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;                            0.5*rawPatchAttraction[bestPosPointI];</div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;                        patchConstraints[bestPosPointI] =</div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;                            rawPatchConstraints[bestPosPointI];</div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;</div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;                        nChanged++;</div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;                    }</div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;                    <span class="keywordflow">if</span> (bestNegPointI != -1)</div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;                    {</div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;                        <span class="comment">// Use reconstructed-feature attraction. Use only</span></div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;                        <span class="comment">// part of it since not sure...</span></div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;                        <span class="comment">//const point&amp; bestPt =</span></div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;                        <span class="comment">//    pp.localPoints()[bestNegPointI];</span></div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;                        <span class="comment">//Pout&lt;&lt; &quot;**Overriding point &quot; &lt;&lt; bestPt</span></div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;                        <span class="comment">//    &lt;&lt; &quot; on reconstructed feature edge at &quot;</span></div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;                        <span class="comment">//    &lt;&lt; rawPatchAttraction[bestNegPointI]+bestPt</span></div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;                        <span class="comment">//    &lt;&lt; &quot; to attracted-to-feature-edge.&quot; &lt;&lt; endl;</span></div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;                        patchAttraction[bestNegPointI] =</div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;                            0.5*rawPatchAttraction[bestNegPointI];</div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;                        patchConstraints[bestNegPointI] =</div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;                            rawPatchConstraints[bestNegPointI];</div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;</div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;                        nChanged++;</div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;                    }</div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;                }</div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;            }</div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;        }</div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;</div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;</div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;        <a class="code" href="a10733.html#a7ffd6af4acc2eb9ba72ee296b5ecda23">reduce</a>(nChanged, <a class="code" href="a02469.html">sumOp&lt;label&gt;</a>());</div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;        <a class="code" href="a10733.html#a501e80d1e14c94973e82f1555e7eb711">Info</a>&lt;&lt; <span class="stringliteral">&quot;Stringing feature edges : changed &quot;</span> &lt;&lt; nChanged &lt;&lt; <span class="stringliteral">&quot; points&quot;</span></div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;            &lt;&lt; <a class="code" href="a10733.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;        <span class="keywordflow">if</span> (nChanged == 0)</div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;        {</div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;        }</div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;    }</div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;}</div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;</div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;</div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;<span class="keywordtype">void</span> Foam::autoSnapDriver::releasePointsNextToMultiPatch</div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;(</div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;    <span class="keyword">const</span> <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> iter,</div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;    <span class="keyword">const</span> scalar featureCos,</div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;</div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;    <span class="keyword">const</span> <a class="code" href="a01972.html">indirectPrimitivePatch</a>&amp; pp,</div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;    <span class="keyword">const</span> <a class="code" href="a00754.html">scalarField</a>&amp; snapDist,</div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;</div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;    <span class="keyword">const</span> <a class="code" href="a01364.html">List</a>&lt;<a class="code" href="a01364.html">List&lt;point&gt;</a>&gt;&amp; pointFaceCentres,</div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;    <span class="keyword">const</span> <a class="code" href="a01364.html">labelListList</a>&amp; pointFacePatchID,</div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;</div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;    <span class="keyword">const</span> <a class="code" href="a00754.html">vectorField</a>&amp; rawPatchAttraction,</div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;    <span class="keyword">const</span> <a class="code" href="a01364.html">List&lt;pointConstraint&gt;</a>&amp; rawPatchConstraints,</div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;</div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;    <a class="code" href="a00754.html">vectorField</a>&amp; patchAttraction,</div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;    <a class="code" href="a01364.html">List&lt;pointConstraint&gt;</a>&amp; patchConstraints</div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;)<span class="keyword"> const</span></div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;    <a class="code" href="a00087.html">autoPtr&lt;OBJstream&gt;</a> multiPatchStr;</div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;    <span class="keywordflow">if</span> (debug&amp;<a class="code" href="a01470.html#a92dc814ea7fd34acae287945426740d3a42750666a219d68f9028ca726fe4fa71">meshRefinement::ATTRACTION</a>)</div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;    {</div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;        multiPatchStr.<a class="code" href="a00087.html#ab46a1bc64c9af6414376c6c18d3bee62">reset</a></div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;        (</div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;            <span class="keyword">new</span> <a class="code" href="a01692.html">OBJstream</a></div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;            (</div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;                meshRefiner_.mesh().time().path()</div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;              / <span class="stringliteral">&quot;multiPatch_&quot;</span> + <a class="code" href="a10733.html#adcb0df2bd4953cb6bb390272d8263c3a">name</a>(iter) + <span class="stringliteral">&quot;.obj&quot;</span></div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;            )</div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;        );</div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;        <a class="code" href="a10733.html#a501e80d1e14c94973e82f1555e7eb711">Info</a>&lt;&lt; <span class="stringliteral">&quot;Dumping removed constraints due to same-face&quot;</span></div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; multi-patch points to &quot;</span></div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;            &lt;&lt; multiPatchStr().name() &lt;&lt; <a class="code" href="a10733.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;    }</div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;</div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;</div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;    <span class="comment">// 1. Mark points on multiple patches</span></div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;    <a class="code" href="a01756.html">PackedBoolList</a> isMultiPatchPoint(pp.size());</div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;</div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;    <a class="code" href="a07669.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(pointFacePatchID, pointI)</div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;    {</div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;        <a class="code" href="a01885.html">pointIndexHit</a> multiPatchPt = findMultiPatchPoint</div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;        (</div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;            pp.<a class="code" href="a01972.html#a180aa335ba66b3224df33de8eb29b3bf">localPoints</a>()[pointI],</div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;            pointFacePatchID[pointI],</div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;            pointFaceCentres[pointI]</div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;        );</div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;        isMultiPatchPoint[pointI] = multiPatchPt.<a class="code" href="a01885.html#ad963d38a624b8bf8b37c210109dba03c">hit</a>();</div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;    }</div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;</div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;    <span class="comment">// 2. Make sure multi-patch points are also attracted</span></div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;    <a class="code" href="a07669.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(isMultiPatchPoint, pointI)</div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;    {</div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;        <span class="keywordflow">if</span> (isMultiPatchPoint[pointI])</div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;        {</div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;            <span class="keywordflow">if</span></div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;            (</div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;                patchConstraints[pointI].first() &lt;= 1</div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;             &amp;&amp; rawPatchConstraints[pointI].first() &gt; 1</div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;            )</div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;            {</div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;                patchAttraction[pointI] = rawPatchAttraction[pointI];</div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;                patchConstraints[pointI] = rawPatchConstraints[pointI];</div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;</div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;                <span class="comment">//if (multiPatchStr.valid())</span></div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;                <span class="comment">//{</span></div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;                <span class="comment">//    Pout&lt;&lt; &quot;Adding constraint on multiPatchPoint:&quot;</span></div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;                <span class="comment">//        &lt;&lt; pp.localPoints()[pointI]</span></div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;                <span class="comment">//        &lt;&lt; &quot; constraint:&quot; &lt;&lt; patchConstraints[pointI]</span></div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;                <span class="comment">//        &lt;&lt; &quot; attraction:&quot; &lt;&lt; patchAttraction[pointI]</span></div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;                <span class="comment">//        &lt;&lt; endl;</span></div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;                <span class="comment">//}</span></div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;            }</div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;        }</div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;    }</div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;</div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;    <span class="comment">// Up to here it is all parallel ok.</span></div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;</div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;</div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;    <span class="comment">// 3. Knock out any attraction on faces with multi-patch points</span></div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;    <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> nChanged = 0;</div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;    <a class="code" href="a07669.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(pp.<a class="code" href="a01972.html#af5aca3ce69275c80366bc8d5c0584da2">localFaces</a>(), faceI)</div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;    {</div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;        <span class="keyword">const</span> <a class="code" href="a00714.html">face</a>&amp; <a class="code" href="a03926.html#a888be93833ac7a23170555c69c690288">f</a> = pp.<a class="code" href="a01972.html#af5aca3ce69275c80366bc8d5c0584da2">localFaces</a>()[faceI];</div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;</div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;        <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> nMultiPatchPoints = 0;</div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;        <a class="code" href="a07669.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(f, fp)</div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;        {</div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;            <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> pointI = f[fp];</div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;            <span class="keywordflow">if</span></div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;            (</div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;                isMultiPatchPoint[pointI]</div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;             &amp;&amp; patchConstraints[pointI].first() &gt; 1</div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;            )</div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;            {</div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;                nMultiPatchPoints++;</div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;            }</div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;        }</div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;</div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;        <span class="keywordflow">if</span> (nMultiPatchPoints &gt; 0)</div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;        {</div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;            <a class="code" href="a07669.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(f, fp)</div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;            {</div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;                <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> pointI = f[fp];</div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;                <span class="keywordflow">if</span></div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;                (</div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;                   !isMultiPatchPoint[pointI]</div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;                 &amp;&amp; patchConstraints[pointI].first() &gt; 1</div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;                )</div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;                {</div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;                    <span class="comment">//Pout&lt;&lt; &quot;Knocking out constraint&quot;</span></div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;                    <span class="comment">//    &lt;&lt; &quot; on non-multiPatchPoint:&quot;</span></div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;                    <span class="comment">//    &lt;&lt; pp.localPoints()[pointI] &lt;&lt; endl;</span></div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;                    patchAttraction[pointI] = <a class="code" href="a02791.html#ac3b79445511a1e3a6443b59ac93c394a">vector::zero</a>;</div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;                    patchConstraints[pointI] = <a class="code" href="a01871.html">pointConstraint</a>();</div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;                    nChanged++;</div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;</div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;                    <span class="keywordflow">if</span> (multiPatchStr.<a class="code" href="a00087.html#a8d985300b138b6c5556ab17ed4df3b38">valid</a>())</div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;                    {</div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;                        multiPatchStr().write(pp.<a class="code" href="a01972.html#a180aa335ba66b3224df33de8eb29b3bf">localPoints</a>()[pointI]);</div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;                    }</div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;                }</div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;            }</div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;        }</div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;    }</div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;</div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;    <a class="code" href="a10733.html#a7ffd6af4acc2eb9ba72ee296b5ecda23">reduce</a>(nChanged, <a class="code" href="a02469.html">sumOp&lt;label&gt;</a>());</div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;    <a class="code" href="a10733.html#a501e80d1e14c94973e82f1555e7eb711">Info</a>&lt;&lt; <span class="stringliteral">&quot;Removing constraints near multi-patch points : changed &quot;</span></div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;        &lt;&lt; nChanged &lt;&lt; <span class="stringliteral">&quot; points&quot;</span> &lt;&lt; <a class="code" href="a10733.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;}</div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;</div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;</div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;<span class="comment">// If only two attractions and across face return the face indices</span></div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;<a class="code" href="a01760.html">Foam::labelPair</a> Foam::autoSnapDriver::findDiagonalAttraction</div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;(</div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;    <span class="keyword">const</span> <a class="code" href="a01972.html">indirectPrimitivePatch</a>&amp; pp,</div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;    <span class="keyword">const</span> <a class="code" href="a00754.html">vectorField</a>&amp; patchAttraction,</div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;    <span class="keyword">const</span> <a class="code" href="a01364.html">List&lt;pointConstraint&gt;</a>&amp; patchConstraints,</div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;    <span class="keyword">const</span> <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> faceI</div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;)<span class="keyword"> const</span></div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;    <span class="keyword">const</span> <a class="code" href="a00714.html">face</a>&amp; <a class="code" href="a03926.html#a888be93833ac7a23170555c69c690288">f</a> = pp.<a class="code" href="a01972.html#af5aca3ce69275c80366bc8d5c0584da2">localFaces</a>()[faceI];</div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;    <span class="comment">// For now just detect any attraction. Improve this to look at</span></div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;    <span class="comment">// actual attraction position and orientation</span></div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;</div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;    <a class="code" href="a01760.html">labelPair</a> attractIndices(-1, -1);</div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;</div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;    <span class="keywordflow">if</span> (f.<a class="code" href="a01364.html#a8a5f6fa29bd4b500caf186f60245b384">size</a>() &gt;= 4)</div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;    {</div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;        <a class="code" href="a07669.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(f, fp)</div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;        {</div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;            <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> pointI = f[fp];</div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;            <span class="keywordflow">if</span> (patchConstraints[pointI].first() &gt;= 2)</div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;            {</div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;                <span class="comment">// Attract to feature edge or point</span></div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;                <span class="keywordflow">if</span> (attractIndices[0] == -1)</div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;                {</div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;                    <span class="comment">// First attraction. Store</span></div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;                    attractIndices[0] = fp;</div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;                }</div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (attractIndices[1] == -1)</div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;                {</div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;                    <span class="comment">// Second attraction. Check if not consecutive to first</span></div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;                    <span class="comment">// attraction</span></div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;                    <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> fp0 = attractIndices[0];</div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;                    <span class="keywordflow">if</span> (f.<a class="code" href="a02735.html#af4d05e19e6cdc80f0c7acd5bbe250f69">fcIndex</a>(fp0) == fp || f.<a class="code" href="a02735.html#af4d05e19e6cdc80f0c7acd5bbe250f69">fcIndex</a>(fp) == fp0)</div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;                    {</div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;                        <span class="comment">// Consecutive. Skip.</span></div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;                        attractIndices = <a class="code" href="a10733.html#a123bf349eca926d6984b23e5e067d8b9">labelPair</a>(-1, -1);</div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;                    }</div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;                    <span class="keywordflow">else</span></div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;                    {</div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;                        attractIndices[1] = fp;</div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;                    }</div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;                }</div><div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;                <span class="keywordflow">else</span></div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;                {</div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;                    <span class="comment">// More than two attractions. Skip.</span></div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;                    attractIndices = <a class="code" href="a10733.html#a123bf349eca926d6984b23e5e067d8b9">labelPair</a>(-1, -1);</div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;                    <span class="keywordflow">break</span>;</div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;                }</div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;            }</div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;        }</div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;</div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;</div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;        <span class="keywordflow">if</span> (attractIndices[1] == -1)</div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;        {</div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;            <span class="comment">// Found only one attraction. Skip.</span></div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;            attractIndices = <a class="code" href="a10733.html#a123bf349eca926d6984b23e5e067d8b9">labelPair</a>(-1, -1);</div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;        }</div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;    }</div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;    <span class="keywordflow">return</span> attractIndices;</div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;}</div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;</div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;</div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;<span class="keywordtype">void</span> Foam::autoSnapDriver::avoidDiagonalAttraction</div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;(</div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;    <span class="keyword">const</span> <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> iter,</div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;    <span class="keyword">const</span> scalar featureCos,</div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;</div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;    <span class="keyword">const</span> <a class="code" href="a01972.html">indirectPrimitivePatch</a>&amp; pp,</div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;</div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;    <a class="code" href="a00754.html">vectorField</a>&amp; patchAttraction,</div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;    <a class="code" href="a01364.html">List&lt;pointConstraint&gt;</a>&amp; patchConstraints</div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;)<span class="keyword"> const</span></div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;    <a class="code" href="a07669.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(pp.<a class="code" href="a01972.html#af5aca3ce69275c80366bc8d5c0584da2">localFaces</a>(), faceI)</div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;    {</div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;        <span class="keyword">const</span> <a class="code" href="a00714.html">face</a>&amp; <a class="code" href="a03926.html#a888be93833ac7a23170555c69c690288">f</a> = pp.<a class="code" href="a01972.html#af5aca3ce69275c80366bc8d5c0584da2">localFaces</a>()[faceI];</div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;</div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;        <a class="code" href="a01760.html">labelPair</a> <a class="code" href="a10733.html#a8cdb0ba0633c91ed7041368519cd217c">diag</a> = findDiagonalAttraction</div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;        (</div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;            pp,</div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;            patchAttraction,</div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;            patchConstraints,</div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;            faceI</div><div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;        );</div><div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;</div><div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;        <span class="keywordflow">if</span> (diag[0] != -1 &amp;&amp; diag[1] != -1)</div><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;        {</div><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;            <span class="comment">// Found two diagonal points that being attracted.</span></div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;            <span class="comment">// For now just attract my one to the average of those.</span></div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;            <span class="keyword">const</span> <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> i0 = f[diag[0]];</div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;            <span class="keyword">const</span> <a class="code" href="a02791.html">point</a> pt0 =</div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;                pp.<a class="code" href="a01972.html#a180aa335ba66b3224df33de8eb29b3bf">localPoints</a>()[i0]+patchAttraction[i0];</div><div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;            <span class="keyword">const</span> <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> i1 = f[diag[1]];</div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;            <span class="keyword">const</span> <a class="code" href="a02791.html">point</a> pt1 =</div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;                pp.<a class="code" href="a01972.html#a180aa335ba66b3224df33de8eb29b3bf">localPoints</a>()[i1]+patchAttraction[i1];</div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;            <span class="keyword">const</span> <a class="code" href="a02791.html">point</a> mid = 0.5*(pt0+pt1);</div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;</div><div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;            <span class="keyword">const</span> scalar cosAngle = <a class="code" href="a10733.html#a929da2a3fdcf3dacbbe0487d3a330dae">mag</a></div><div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;            (</div><div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;                patchConstraints[i0].second()</div><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;              &amp; patchConstraints[i1].second()</div><div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;            );</div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;</div><div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;            <span class="comment">//Pout&lt;&lt; &quot;Found diagonal attraction at indices:&quot;</span></div><div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;            <span class="comment">//    &lt;&lt; diag[0]</span></div><div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;            <span class="comment">//    &lt;&lt; &quot; and &quot; &lt;&lt; diag[1]</span></div><div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;            <span class="comment">//    &lt;&lt; &quot; with cosAngle:&quot; &lt;&lt; cosAngle</span></div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;            <span class="comment">//    &lt;&lt; &quot; mid:&quot; &lt;&lt; mid &lt;&lt; endl;</span></div><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;</div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;            <span class="keywordflow">if</span> (cosAngle &gt; featureCos)</div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;            {</div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;                <span class="comment">// Add the nearest of the other two points as</span></div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;                <span class="comment">// attractor</span></div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;                <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> minFp = -1;</div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;                scalar minDistSqr = GREAT;</div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;                <a class="code" href="a07669.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(f, fp)</div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;                {</div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;                    <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> pointI = f[fp];</div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;                    <span class="keywordflow">if</span> (patchConstraints[pointI].first() &lt;= 1)</div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;                    {</div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;                        <span class="keyword">const</span> <a class="code" href="a02791.html">point</a>&amp; pt = pp.<a class="code" href="a01972.html#a180aa335ba66b3224df33de8eb29b3bf">localPoints</a>()[pointI];</div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;                        scalar distSqr = <a class="code" href="a10733.html#ae6fff2c6981e6d9618aa5038e69def6e">magSqr</a>(mid-pt);</div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;                        <span class="keywordflow">if</span> (distSqr &lt; minDistSqr)</div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;                        {</div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;                            distSqr = minDistSqr;</div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;                            minFp = fp;</div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;                        }</div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;                    }</div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;                }</div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;                <span class="keywordflow">if</span> (minFp != -1)</div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;                {</div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;                    <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> minPointI = f[minFp];</div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;                    patchAttraction[minPointI] =</div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;                        mid-pp.<a class="code" href="a01972.html#a180aa335ba66b3224df33de8eb29b3bf">localPoints</a>()[minPointI];</div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;                    patchConstraints[minPointI] =</div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;                        patchConstraints[f[diag[0]]];</div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;                }</div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;            }</div><div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;            {</div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;                <span class="comment">//Pout&lt;&lt; &quot;Diagonal attractors at&quot; &lt;&lt; nl</span></div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;                <span class="comment">//    &lt;&lt; &quot;    pt0:&quot; &lt;&lt; pt0</span></div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;                <span class="comment">//    &lt;&lt; &quot;    constraint:&quot;</span></div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;                <span class="comment">//    &lt;&lt; patchConstraints[i0].second() &lt;&lt; nl</span></div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;                <span class="comment">//    &lt;&lt; &quot;    pt1:&quot; &lt;&lt; pt1</span></div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;                <span class="comment">//    &lt;&lt; &quot;    constraint:&quot;</span></div><div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;                <span class="comment">//    &lt;&lt; patchConstraints[i1].second() &lt;&lt; nl</span></div><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;                <span class="comment">//    &lt;&lt; &quot;    make too large an angle:&quot;</span></div><div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;                <span class="comment">//    &lt;&lt;  mag</span></div><div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;                <span class="comment">//        (</span></div><div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;                <span class="comment">//            patchConstraints[i0].second()</span></div><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;                <span class="comment">//          &amp; patchConstraints[i1].second()</span></div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;                <span class="comment">//        )</span></div><div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;                <span class="comment">//    &lt;&lt; endl;</span></div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;            }</div><div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;        }</div><div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;    }</div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;}</div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;</div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;</div><div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;<a class="code" href="a02695.html">Foam::Tuple2&lt;Foam::label, Foam::pointIndexHit&gt;</a></div><div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;Foam::autoSnapDriver::findNearFeatureEdge</div><div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;(</div><div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> isRegionEdge,</div><div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;</div><div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;    <span class="keyword">const</span> <a class="code" href="a01972.html">indirectPrimitivePatch</a>&amp; pp,</div><div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;    <span class="keyword">const</span> <a class="code" href="a00754.html">scalarField</a>&amp; snapDist,</div><div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;    <span class="keyword">const</span> <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> pointI,</div><div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;    <span class="keyword">const</span> <a class="code" href="a02791.html">point</a>&amp; estimatedPt,</div><div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;</div><div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;    <a class="code" href="a01364.html">List</a>&lt;<a class="code" href="a01364.html">List</a>&lt;<a class="code" href="a00603.html">DynamicList&lt;point&gt;</a>&gt;&gt;&amp; edgeAttractors,</div><div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;    <a class="code" href="a01364.html">List</a>&lt;<a class="code" href="a01364.html">List</a>&lt;<a class="code" href="a00603.html">DynamicList&lt;pointConstraint&gt;</a>&gt;&gt;&amp; edgeConstraints,</div><div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;    <a class="code" href="a00754.html">vectorField</a>&amp; patchAttraction,</div><div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;    <a class="code" href="a01364.html">List&lt;pointConstraint&gt;</a>&amp; patchConstraints</div><div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;)<span class="keyword"> const</span></div><div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;    <span class="keyword">const</span> <a class="code" href="a02113.html">refinementFeatures</a>&amp; features = meshRefiner_.features();</div><div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;</div><div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;    <a class="code" href="a01364.html">labelList</a> nearEdgeFeat;</div><div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;    <a class="code" href="a01364.html">List&lt;pointIndexHit&gt;</a> nearEdgeInfo;</div><div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;    <a class="code" href="a00754.html">vectorField</a> nearNormal;</div><div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;</div><div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;    <span class="keywordflow">if</span> (isRegionEdge)</div><div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;    {</div><div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;        features.<a class="code" href="a02113.html#a3c1594dfe7daf51065b42d9a71f2305d">findNearestRegionEdge</a></div><div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;        (</div><div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;            <a class="code" href="a10733.html#a5997a67f2e85a15c0e13a1724273aa5f">pointField</a>(1, estimatedPt),</div><div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;            <a class="code" href="a10733.html#a6e363d070e971ead1a4c40475084e584">scalarField</a>(1, <a class="code" href="a10733.html#a277dc11c581d53826ab5090b08f3b17b">sqr</a>(snapDist[pointI])),</div><div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;            nearEdgeFeat,</div><div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;            nearEdgeInfo,</div><div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;            nearNormal</div><div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;        );</div><div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;    }</div><div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;    {</div><div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;        features.<a class="code" href="a02113.html#a54a38a30d12368aeb05534de2e216f3d">findNearestEdge</a></div><div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;        (</div><div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;            <a class="code" href="a10733.html#a5997a67f2e85a15c0e13a1724273aa5f">pointField</a>(1, estimatedPt),</div><div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;            <a class="code" href="a10733.html#a6e363d070e971ead1a4c40475084e584">scalarField</a>(1, <a class="code" href="a10733.html#a277dc11c581d53826ab5090b08f3b17b">sqr</a>(snapDist[pointI])),</div><div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;            nearEdgeFeat,</div><div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;            nearEdgeInfo,</div><div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;            nearNormal</div><div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;        );</div><div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;    }</div><div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;</div><div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;    <span class="keyword">const</span> <a class="code" href="a01885.html">pointIndexHit</a>&amp; <a class="code" href="a02695.html">nearInfo</a> = nearEdgeInfo[0];</div><div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;    <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> featI = nearEdgeFeat[0];</div><div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;</div><div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;    <span class="keywordflow">if</span> (nearInfo.<a class="code" href="a01885.html#ad963d38a624b8bf8b37c210109dba03c">hit</a>())</div><div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;    {</div><div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;        <span class="comment">// So we have a point on the feature edge. Use this</span></div><div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;        <span class="comment">// instead of our estimate from planes.</span></div><div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;        edgeAttractors[featI][nearInfo.<a class="code" href="a01885.html#a7d1e8acadb27bd2b4e61457d47b71b6f">index</a>()].<a class="code" href="a01364.html#a399dd2bf0d9a32016717dc90126f016b">append</a></div><div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;        (</div><div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;            nearInfo.<a class="code" href="a01885.html#a0c448cd4b96e9ea9ba38c62c019a8bce">hitPoint</a>()</div><div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;        );</div><div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;        <a class="code" href="a01871.html">pointConstraint</a> <a class="code" href="a10749.html#a8d66fa4b7d96f0523ff86522f1d01c6f">c</a>(<a class="code" href="a02695.html">Tuple2&lt;label, vector&gt;</a>(2, nearNormal[0]));</div><div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;        edgeConstraints[featI][nearInfo.<a class="code" href="a01885.html#a7d1e8acadb27bd2b4e61457d47b71b6f">index</a>()].append(c);</div><div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;</div><div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;        <span class="comment">// Store for later use</span></div><div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;        patchAttraction[pointI] =</div><div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;            nearInfo.<a class="code" href="a01885.html#a0c448cd4b96e9ea9ba38c62c019a8bce">hitPoint</a>()-pp.<a class="code" href="a01972.html#a180aa335ba66b3224df33de8eb29b3bf">localPoints</a>()[pointI];</div><div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;        patchConstraints[pointI] = <a class="code" href="a10749.html#a8d66fa4b7d96f0523ff86522f1d01c6f">c</a>;</div><div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;    }</div><div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="a02695.html">Tuple2&lt;label, pointIndexHit&gt;</a>(featI, <a class="code" href="a10733.html#a86079a031eeab35048e976435c8d4bae">nearInfo</a>);</div><div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;}</div><div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;</div><div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;</div><div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;<a class="code" href="a02695.html">Foam::Tuple2&lt;Foam::label, Foam::pointIndexHit&gt;</a></div><div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;Foam::autoSnapDriver::findNearFeaturePoint</div><div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;(</div><div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> isRegionPoint,</div><div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;</div><div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;    <span class="keyword">const</span> <a class="code" href="a01972.html">indirectPrimitivePatch</a>&amp; pp,</div><div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;    <span class="keyword">const</span> <a class="code" href="a00754.html">scalarField</a>&amp; snapDist,</div><div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;    <span class="keyword">const</span> <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> pointI,</div><div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;    <span class="keyword">const</span> <a class="code" href="a02791.html">point</a>&amp; estimatedPt,</div><div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;</div><div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;    <span class="comment">// Feature-point to pp point</span></div><div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;    <a class="code" href="a01364.html">List&lt;labelList&gt;</a>&amp; pointAttractor,</div><div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;    <a class="code" href="a01364.html">List</a>&lt;<a class="code" href="a01364.html">List&lt;pointConstraint&gt;</a>&gt;&amp; <a class="code" href="a01872.html">pointConstraints</a>,</div><div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;    <span class="comment">// Feature-edge to pp point</span></div><div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;    <a class="code" href="a01364.html">List</a>&lt;<a class="code" href="a01364.html">List</a>&lt;<a class="code" href="a00603.html">DynamicList&lt;point&gt;</a>&gt;&gt;&amp; edgeAttractors,</div><div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;    <a class="code" href="a01364.html">List</a>&lt;<a class="code" href="a01364.html">List</a>&lt;<a class="code" href="a00603.html">DynamicList&lt;pointConstraint&gt;</a>&gt;&gt;&amp; edgeConstraints,</div><div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;    <span class="comment">// pp point to nearest feature</span></div><div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;    <a class="code" href="a00754.html">vectorField</a>&amp; patchAttraction,</div><div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;    <a class="code" href="a01364.html">List&lt;pointConstraint&gt;</a>&amp; patchConstraints</div><div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;)<span class="keyword"> const</span></div><div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;    <span class="keyword">const</span> <a class="code" href="a02113.html">refinementFeatures</a>&amp; features = meshRefiner_.features();</div><div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;</div><div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;    <a class="code" href="a01364.html">labelList</a> nearFeat;</div><div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;    <a class="code" href="a01364.html">List&lt;pointIndexHit&gt;</a> <a class="code" href="a10733.html#a86079a031eeab35048e976435c8d4bae">nearInfo</a>;</div><div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;    features.<a class="code" href="a02113.html#af325395e896cf5a85e7d72a0c8c34735">findNearestPoint</a></div><div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;    (</div><div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;        <a class="code" href="a10733.html#a5997a67f2e85a15c0e13a1724273aa5f">pointField</a>(1, estimatedPt),</div><div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;        <a class="code" href="a10733.html#a6e363d070e971ead1a4c40475084e584">scalarField</a>(1, <a class="code" href="a10733.html#a277dc11c581d53826ab5090b08f3b17b">sqr</a>(snapDist[pointI])),</div><div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;        nearFeat,</div><div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;        nearInfo</div><div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;    );</div><div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;</div><div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;    <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> featI = nearFeat[0];</div><div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;</div><div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;    <span class="keywordflow">if</span> (featI != -1)</div><div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;    {</div><div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;        <span class="keyword">const</span> <a class="code" href="a02791.html">point</a>&amp; pt = pp.<a class="code" href="a01972.html#a180aa335ba66b3224df33de8eb29b3bf">localPoints</a>()[pointI];</div><div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;</div><div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;        <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> featPointI = nearInfo[0].index();</div><div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;        <span class="keyword">const</span> <a class="code" href="a02791.html">point</a>&amp; featPt = nearInfo[0].hitPoint();</div><div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;        scalar distSqr = <a class="code" href="a10733.html#ae6fff2c6981e6d9618aa5038e69def6e">magSqr</a>(featPt-pt);</div><div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;</div><div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;        <span class="comment">// Check if already attracted</span></div><div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;        <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> oldPointI = pointAttractor[featI][featPointI];</div><div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;</div><div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;        <span class="keywordflow">if</span> (oldPointI != -1)</div><div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;        {</div><div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;            <span class="comment">// Check distance</span></div><div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;            <span class="keywordflow">if</span> (distSqr &gt;= <a class="code" href="a10733.html#ae6fff2c6981e6d9618aa5038e69def6e">magSqr</a>(featPt-pp.<a class="code" href="a01972.html#a180aa335ba66b3224df33de8eb29b3bf">localPoints</a>()[oldPointI]))</div><div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;            {</div><div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;                <span class="comment">// oldPointI nearest. Keep.</span></div><div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;                featI = -1;</div><div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;                featPointI = -1;</div><div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;            }</div><div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;            {</div><div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;                <span class="comment">// Current pointI nearer.</span></div><div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;                pointAttractor[featI][featPointI] = pointI;</div><div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;                <a class="code" href="a01872.html">pointConstraints</a>[featI][featPointI].first() = 3;</div><div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;                <a class="code" href="a01872.html">pointConstraints</a>[featI][featPointI].second() = <a class="code" href="a02791.html#ac3b79445511a1e3a6443b59ac93c394a">vector::zero</a>;</div><div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;</div><div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;                <span class="comment">// Store for later use</span></div><div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;                patchAttraction[pointI] = featPt-pt;</div><div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;                patchConstraints[pointI] =</div><div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;                    <a class="code" href="a01872.html">pointConstraints</a>[featI][featPointI];</div><div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;</div><div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;                <span class="comment">// Reset oldPointI to nearest on feature edge</span></div><div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;                patchAttraction[oldPointI] = <a class="code" href="a02791.html#ac3b79445511a1e3a6443b59ac93c394a">vector::zero</a>;</div><div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;                patchConstraints[oldPointI] = <a class="code" href="a01871.html">pointConstraint</a>();</div><div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;</div><div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;                findNearFeatureEdge</div><div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;                (</div><div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;                    isRegionPoint,      <span class="comment">// search region edges only</span></div><div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;</div><div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;                    pp,</div><div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;                    snapDist,</div><div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;                    oldPointI,</div><div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;                    pp.<a class="code" href="a01972.html#a180aa335ba66b3224df33de8eb29b3bf">localPoints</a>()[oldPointI],</div><div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;</div><div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;                    edgeAttractors,</div><div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;                    edgeConstraints,</div><div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;                    patchAttraction,</div><div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;                    patchConstraints</div><div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;                );</div><div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;            }</div><div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;        }</div><div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;        {</div><div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;            <span class="comment">// Current pointI nearer.</span></div><div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;            pointAttractor[featI][featPointI] = pointI;</div><div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;            <a class="code" href="a01872.html">pointConstraints</a>[featI][featPointI].first() = 3;</div><div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;            <a class="code" href="a01872.html">pointConstraints</a>[featI][featPointI].second() = <a class="code" href="a02791.html#ac3b79445511a1e3a6443b59ac93c394a">vector::zero</a>;</div><div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;</div><div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;            <span class="comment">// Store for later use</span></div><div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;            patchAttraction[pointI] = featPt-pt;</div><div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;            patchConstraints[pointI] = <a class="code" href="a01872.html">pointConstraints</a>[featI][featPointI];</div><div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;        }</div><div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;    }</div><div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;</div><div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="a02695.html">Tuple2&lt;label, pointIndexHit&gt;</a>(featI, nearInfo[0]);</div><div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;}</div><div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;</div><div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;</div><div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;<span class="comment">// Determines for every pp point - that is on multiple faces that form</span></div><div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;<span class="comment">// a feature - the nearest feature edge/point.</span></div><div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;<span class="keywordtype">void</span> Foam::autoSnapDriver::determineFeatures</div><div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;(</div><div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;    <span class="keyword">const</span> <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> iter,</div><div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;    <span class="keyword">const</span> scalar featureCos,</div><div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> multiRegionFeatureSnap,</div><div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;</div><div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;    <span class="keyword">const</span> <a class="code" href="a01972.html">indirectPrimitivePatch</a>&amp; pp,</div><div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;    <span class="keyword">const</span> <a class="code" href="a00754.html">scalarField</a>&amp; snapDist,</div><div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;    <span class="keyword">const</span> <a class="code" href="a00754.html">vectorField</a>&amp; nearestDisp,</div><div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;</div><div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;    <span class="keyword">const</span> <a class="code" href="a01364.html">List</a>&lt;<a class="code" href="a01364.html">List&lt;point&gt;</a>&gt;&amp; pointFaceSurfNormals,</div><div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;    <span class="keyword">const</span> <a class="code" href="a01364.html">List</a>&lt;<a class="code" href="a01364.html">List&lt;point&gt;</a>&gt;&amp; pointFaceDisp,</div><div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;    <span class="keyword">const</span> <a class="code" href="a01364.html">List</a>&lt;<a class="code" href="a01364.html">List&lt;point&gt;</a>&gt;&amp; pointFaceCentres,</div><div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;    <span class="keyword">const</span> <a class="code" href="a01364.html">labelListList</a>&amp; pointFacePatchID,</div><div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;</div><div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;    <span class="comment">// Feature-point to pp point</span></div><div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;    <a class="code" href="a01364.html">List&lt;labelList&gt;</a>&amp; pointAttractor,</div><div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;    <a class="code" href="a01364.html">List</a>&lt;<a class="code" href="a01364.html">List&lt;pointConstraint&gt;</a>&gt;&amp; <a class="code" href="a01872.html">pointConstraints</a>,</div><div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;    <span class="comment">// Feature-edge to pp point</span></div><div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;    <a class="code" href="a01364.html">List</a>&lt;<a class="code" href="a01364.html">List</a>&lt;<a class="code" href="a00603.html">DynamicList&lt;point&gt;</a>&gt;&gt;&amp; edgeAttractors,</div><div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;    <a class="code" href="a01364.html">List</a>&lt;<a class="code" href="a01364.html">List</a>&lt;<a class="code" href="a00603.html">DynamicList&lt;pointConstraint&gt;</a>&gt;&gt;&amp; edgeConstraints,</div><div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;    <span class="comment">// pp point to nearest feature</span></div><div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;    <a class="code" href="a00754.html">vectorField</a>&amp; patchAttraction,</div><div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;    <a class="code" href="a01364.html">List&lt;pointConstraint&gt;</a>&amp; patchConstraints</div><div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;)<span class="keyword"> const</span></div><div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;    <a class="code" href="a00087.html">autoPtr&lt;OBJstream&gt;</a> featureEdgeStr;</div><div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;    <a class="code" href="a00087.html">autoPtr&lt;OBJstream&gt;</a> missedEdgeStr;</div><div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;    <a class="code" href="a00087.html">autoPtr&lt;OBJstream&gt;</a> featurePointStr;</div><div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;</div><div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;    <span class="keywordflow">if</span> (debug&amp;<a class="code" href="a01470.html#a92dc814ea7fd34acae287945426740d3a42750666a219d68f9028ca726fe4fa71">meshRefinement::ATTRACTION</a>)</div><div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;    {</div><div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;        featureEdgeStr.<a class="code" href="a00087.html#ab46a1bc64c9af6414376c6c18d3bee62">reset</a></div><div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;        (</div><div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;            <span class="keyword">new</span> <a class="code" href="a01692.html">OBJstream</a></div><div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;            (</div><div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;                meshRefiner_.mesh().time().path()</div><div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;              / <span class="stringliteral">&quot;featureEdge_&quot;</span> + <a class="code" href="a10733.html#adcb0df2bd4953cb6bb390272d8263c3a">name</a>(iter) + <span class="stringliteral">&quot;.obj&quot;</span></div><div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;            )</div><div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;        );</div><div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;        <a class="code" href="a10733.html#a501e80d1e14c94973e82f1555e7eb711">Info</a>&lt;&lt; <span class="stringliteral">&quot;Dumping feature-edge sampling to &quot;</span></div><div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;            &lt;&lt; featureEdgeStr().name() &lt;&lt; <a class="code" href="a10733.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div><div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;</div><div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;        missedEdgeStr.<a class="code" href="a00087.html#ab46a1bc64c9af6414376c6c18d3bee62">reset</a></div><div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;        (</div><div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;            <span class="keyword">new</span> <a class="code" href="a01692.html">OBJstream</a></div><div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;            (</div><div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;                meshRefiner_.mesh().time().path()</div><div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;              / <span class="stringliteral">&quot;missedFeatureEdge_&quot;</span> + <a class="code" href="a10733.html#adcb0df2bd4953cb6bb390272d8263c3a">name</a>(iter) + <span class="stringliteral">&quot;.obj&quot;</span></div><div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;            )</div><div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;        );</div><div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;        <a class="code" href="a10733.html#a501e80d1e14c94973e82f1555e7eb711">Info</a>&lt;&lt; <span class="stringliteral">&quot;Dumping feature-edges that are too far away to &quot;</span></div><div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;            &lt;&lt; missedEdgeStr().name() &lt;&lt; <a class="code" href="a10733.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div><div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;</div><div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;        featurePointStr.<a class="code" href="a00087.html#ab46a1bc64c9af6414376c6c18d3bee62">reset</a></div><div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;        (</div><div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;            <span class="keyword">new</span> <a class="code" href="a01692.html">OBJstream</a></div><div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;            (</div><div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;                meshRefiner_.mesh().time().path()</div><div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;              / <span class="stringliteral">&quot;featurePoint_&quot;</span> + <a class="code" href="a10733.html#adcb0df2bd4953cb6bb390272d8263c3a">name</a>(iter) + <span class="stringliteral">&quot;.obj&quot;</span></div><div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;            )</div><div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;        );</div><div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;        <a class="code" href="a10733.html#a501e80d1e14c94973e82f1555e7eb711">Info</a>&lt;&lt; <span class="stringliteral">&quot;Dumping feature-point sampling to &quot;</span></div><div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;            &lt;&lt; featurePointStr().name() &lt;&lt; <a class="code" href="a10733.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div><div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;    }</div><div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;</div><div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;</div><div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;    <a class="code" href="a00603.html">DynamicList&lt;point&gt;</a> surfacePoints(4);</div><div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;    <a class="code" href="a00603.html">DynamicList&lt;vector&gt;</a> surfaceNormals(4);</div><div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;    <a class="code" href="a01364.html">labelList</a> faceToNormalBin;</div><div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;</div><div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;    <a class="code" href="a07669.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(pp.<a class="code" href="a01972.html#a180aa335ba66b3224df33de8eb29b3bf">localPoints</a>(), pointI)</div><div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;    {</div><div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;        <span class="keyword">const</span> <a class="code" href="a02791.html">point</a>&amp; pt = pp.<a class="code" href="a01972.html#a180aa335ba66b3224df33de8eb29b3bf">localPoints</a>()[pointI];</div><div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;</div><div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;        <a class="code" href="a02791.html">vector</a> attraction = <a class="code" href="a02791.html#ac3b79445511a1e3a6443b59ac93c394a">vector::zero</a>;</div><div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;        <a class="code" href="a01871.html">pointConstraint</a> constraint;</div><div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;</div><div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;        featureAttractionUsingReconstruction</div><div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;        (</div><div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;            iter,</div><div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;            featureCos,</div><div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;</div><div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;            pp,</div><div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;            snapDist,</div><div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;            nearestDisp,</div><div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;</div><div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;            pointI,</div><div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;</div><div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;            pointFaceSurfNormals,</div><div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;            pointFaceDisp,</div><div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;            pointFaceCentres,</div><div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;            pointFacePatchID,</div><div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;</div><div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;            surfacePoints,</div><div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;            surfaceNormals,</div><div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;            faceToNormalBin,</div><div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;</div><div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;            attraction,</div><div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;            constraint</div><div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;        );</div><div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;</div><div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;</div><div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;        <span class="keywordflow">if</span></div><div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;        (</div><div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;            (constraint.<a class="code" href="a02695.html#a6bc9dc0330d36f5f75e816ddc4ec213e">first</a>() &gt; patchConstraints[pointI].<a class="code" href="a02735.html#a1c9828bc3de9502754d944c95a2ce0d9">first</a>())</div><div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;         || (</div><div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;                (constraint.<a class="code" href="a02695.html#a6bc9dc0330d36f5f75e816ddc4ec213e">first</a>() == patchConstraints[pointI].<a class="code" href="a02735.html#a1c9828bc3de9502754d944c95a2ce0d9">first</a>())</div><div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;             &amp;&amp; (<a class="code" href="a10733.html#ae6fff2c6981e6d9618aa5038e69def6e">magSqr</a>(attraction) &lt; <a class="code" href="a10733.html#ae6fff2c6981e6d9618aa5038e69def6e">magSqr</a>(patchAttraction[pointI]))</div><div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;            )</div><div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;        )</div><div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;        {</div><div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;            patchAttraction[pointI] = attraction;</div><div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;            patchConstraints[pointI] = constraint;</div><div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;</div><div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;            <span class="comment">// Check the number of directions</span></div><div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;            <span class="keywordflow">if</span> (patchConstraints[pointI].first() == 1)</div><div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;            {</div><div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;                <span class="comment">// Flat surface. Check for different patchIDs</span></div><div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;                <span class="keywordflow">if</span> (multiRegionFeatureSnap)</div><div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;                {</div><div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;                    <span class="keyword">const</span> <a class="code" href="a02791.html">point</a> estimatedPt(pt + nearestDisp[pointI]);</div><div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;                    <a class="code" href="a01885.html">pointIndexHit</a> multiPatchPt</div><div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;                    (</div><div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;                        findMultiPatchPoint</div><div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;                        (</div><div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;                            estimatedPt,</div><div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;                            pointFacePatchID[pointI],</div><div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;                            surfaceNormals,</div><div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;                            faceToNormalBin</div><div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;                        )</div><div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;                    );</div><div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;</div><div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;                    <span class="keywordflow">if</span> (multiPatchPt.<a class="code" href="a01885.html#ad963d38a624b8bf8b37c210109dba03c">hit</a>())</div><div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;                    {</div><div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;                        <span class="comment">// Behave like when having two surface normals so</span></div><div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;                        <span class="comment">// attract to nearest feature edge (with a guess for</span></div><div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;                        <span class="comment">// the multipatch point as starting point)</span></div><div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;                        <a class="code" href="a02695.html">Tuple2&lt;label, pointIndexHit&gt;</a> <a class="code" href="a02695.html">nearInfo</a> =</div><div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;                        findNearFeatureEdge</div><div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;                        (</div><div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;                            <span class="keyword">true</span>,                       <span class="comment">// isRegionPoint</span></div><div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;                            pp,</div><div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;                            snapDist,</div><div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;                            pointI,</div><div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;                            multiPatchPt.<a class="code" href="a01885.html#a0c448cd4b96e9ea9ba38c62c019a8bce">hitPoint</a>(),    <span class="comment">// estimatedPt</span></div><div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;</div><div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;                            edgeAttractors,</div><div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;                            edgeConstraints,</div><div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;</div><div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;                            patchAttraction,</div><div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;                            patchConstraints</div><div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;                        );</div><div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;</div><div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;                        <span class="keyword">const</span> <a class="code" href="a01885.html">pointIndexHit</a>&amp; info = nearInfo.<a class="code" href="a02695.html#a5d570a89988f907024eede54003b8a79">second</a>();</div><div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;                        <span class="keywordflow">if</span> (info.hit())</div><div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;                        {</div><div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;                            <span class="comment">// Dump</span></div><div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;                            <span class="keywordflow">if</span> (featureEdgeStr.<a class="code" href="a00087.html#a8d985300b138b6c5556ab17ed4df3b38">valid</a>())</div><div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;                            {</div><div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;                                featureEdgeStr().write</div><div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;                                (</div><div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;                                    <a class="code" href="a10733.html#a2e0318a3a140a9ee64174b45fbfd45f0">linePointRef</a>(pt, info.hitPoint())</div><div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;                                );</div><div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;                            }</div><div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;                        }</div><div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;                        <span class="keywordflow">else</span></div><div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;                        {</div><div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;                            <span class="keywordflow">if</span> (missedEdgeStr.<a class="code" href="a00087.html#a8d985300b138b6c5556ab17ed4df3b38">valid</a>())</div><div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;                            {</div><div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;                                missedEdgeStr().write</div><div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;                                (</div><div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;                                    <a class="code" href="a10733.html#a2e0318a3a140a9ee64174b45fbfd45f0">linePointRef</a>(pt, info.missPoint())</div><div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;                                );</div><div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;                            }</div><div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;                        }</div><div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;                    }</div><div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;                }</div><div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;            }</div><div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (patchConstraints[pointI].first() == 2)</div><div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;            {</div><div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;                <span class="comment">// Mark point on the nearest feature edge. Note that we</span></div><div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;                <span class="comment">// only search within the surrounding since the plane</span></div><div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;                <span class="comment">// reconstruction might find a feature where there isn&#39;t one.</span></div><div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;                <span class="keyword">const</span> <a class="code" href="a02791.html">point</a> estimatedPt(pt + patchAttraction[pointI]);</div><div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;</div><div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;                <a class="code" href="a02695.html">Tuple2&lt;label, pointIndexHit&gt;</a> <a class="code" href="a10733.html#a86079a031eeab35048e976435c8d4bae">nearInfo</a>(-1, <a class="code" href="a10733.html#a29558ed008131ebedb6c3b965e9f4175">pointIndexHit</a>());</div><div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;</div><div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;                <span class="comment">// Geometric feature edge. Check for different patchIDs</span></div><div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;                <span class="keywordtype">bool</span> hasSnapped = <span class="keyword">false</span>;</div><div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;                <span class="keywordflow">if</span> (multiRegionFeatureSnap)</div><div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;                {</div><div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;                    <a class="code" href="a01885.html">pointIndexHit</a> multiPatchPt</div><div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;                    (</div><div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;                        findMultiPatchPoint</div><div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;                        (</div><div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;                            estimatedPt,</div><div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;                            pointFacePatchID[pointI],</div><div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;                            surfaceNormals,</div><div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;                            faceToNormalBin</div><div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;                        )</div><div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;                    );</div><div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;                    <span class="keywordflow">if</span> (multiPatchPt.<a class="code" href="a01885.html#ad963d38a624b8bf8b37c210109dba03c">hit</a>())</div><div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;                    {</div><div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;                        <span class="keywordflow">if</span> (multiPatchPt.<a class="code" href="a01885.html#a7d1e8acadb27bd2b4e61457d47b71b6f">index</a>() == 0)</div><div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;                        {</div><div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;                            <span class="comment">// Geometric feature edge is also region edge</span></div><div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;                            nearInfo = findNearFeatureEdge</div><div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;                            (</div><div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;                                <span class="keyword">true</span>,               <span class="comment">// isRegionPoint</span></div><div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;                                pp,</div><div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;                                snapDist,</div><div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;                                pointI,</div><div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;                                estimatedPt,</div><div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;</div><div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;                                edgeAttractors,</div><div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;                                edgeConstraints,</div><div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;</div><div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;                                patchAttraction,</div><div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;                                patchConstraints</div><div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;                            );</div><div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;                            hasSnapped = <span class="keyword">true</span>;</div><div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;                        }</div><div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;                        <span class="keywordflow">else</span></div><div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;                        {</div><div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;                            <span class="comment">// One of planes of feature contains multiple</span></div><div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;                            <span class="comment">// regions</span></div><div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;                            nearInfo = findNearFeaturePoint</div><div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;                            (</div><div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;                                <span class="keyword">true</span>,           <span class="comment">// isRegionPoint</span></div><div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;                                pp,</div><div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;                                snapDist,</div><div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;                                pointI,</div><div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;                                estimatedPt,</div><div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;</div><div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;                                <span class="comment">// Feature-point to pp point</span></div><div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;                                pointAttractor,</div><div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;                                <a class="code" href="a01872.html">pointConstraints</a>,</div><div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;                                <span class="comment">// Feature-edge to pp point</span></div><div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;                                edgeAttractors,</div><div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;                                edgeConstraints,</div><div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;                                <span class="comment">// pp point to nearest feature</span></div><div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;                                patchAttraction,</div><div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;                                patchConstraints</div><div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;                            );</div><div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;                            hasSnapped = <span class="keyword">true</span>;</div><div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;                        }</div><div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;                    }</div><div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;                }</div><div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;</div><div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;                <span class="keywordflow">if</span> (!hasSnapped)</div><div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;                {</div><div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;                    <span class="comment">// Determine nearest point on feature edge. Store</span></div><div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;                    <span class="comment">// constraint</span></div><div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;                    <span class="comment">// (calculated from feature edge, alternative would be to</span></div><div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;                    <span class="comment">//  use constraint calculated from both surfaceNormals)</span></div><div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;                    nearInfo = findNearFeatureEdge</div><div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;                    (</div><div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;                        <span class="keyword">false</span>,      <span class="comment">// isRegionPoint</span></div><div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;                        pp,</div><div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;                        snapDist,</div><div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;                        pointI,</div><div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;                        estimatedPt,</div><div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;</div><div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;                        edgeAttractors,</div><div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;                        edgeConstraints,</div><div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;</div><div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;                        patchAttraction,</div><div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;                        patchConstraints</div><div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;                    );</div><div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;                    hasSnapped = <span class="keyword">true</span>;</div><div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;                }</div><div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;</div><div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;                <span class="comment">// Dump to obj</span></div><div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;                <span class="keyword">const</span> <a class="code" href="a01885.html">pointIndexHit</a>&amp; info = nearInfo.<a class="code" href="a02695.html#a5d570a89988f907024eede54003b8a79">second</a>();</div><div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;                <span class="keywordflow">if</span> (info.<a class="code" href="a01885.html#ad963d38a624b8bf8b37c210109dba03c">hit</a>())</div><div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;                {</div><div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;                    <span class="keywordflow">if</span></div><div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;                    (</div><div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;                        patchConstraints[pointI].first() == 3</div><div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;                     &amp;&amp; featurePointStr.<a class="code" href="a00087.html#a8d985300b138b6c5556ab17ed4df3b38">valid</a>()</div><div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;                    )</div><div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;                    {</div><div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;                        featurePointStr().write</div><div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;                        (</div><div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;                            <a class="code" href="a10733.html#a2e0318a3a140a9ee64174b45fbfd45f0">linePointRef</a>(pt, info.<a class="code" href="a01885.html#a0c448cd4b96e9ea9ba38c62c019a8bce">hitPoint</a>())</div><div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;                        );</div><div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;                    }</div><div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;                    <span class="keywordflow">else</span> <span class="keywordflow">if</span></div><div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;                    (</div><div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;                        patchConstraints[pointI].first() == 2</div><div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;                     &amp;&amp; featureEdgeStr.<a class="code" href="a00087.html#a8d985300b138b6c5556ab17ed4df3b38">valid</a>()</div><div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;                    )</div><div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;                    {</div><div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;                        featureEdgeStr().write</div><div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;                        (</div><div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;                            <a class="code" href="a10733.html#a2e0318a3a140a9ee64174b45fbfd45f0">linePointRef</a>(pt, info.<a class="code" href="a01885.html#a0c448cd4b96e9ea9ba38c62c019a8bce">hitPoint</a>())</div><div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;                        );</div><div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;                    }</div><div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;                }</div><div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;                <span class="keywordflow">else</span></div><div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;                {</div><div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;                    <span class="keywordflow">if</span> (missedEdgeStr.<a class="code" href="a00087.html#a8d985300b138b6c5556ab17ed4df3b38">valid</a>())</div><div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;                    {</div><div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;                        missedEdgeStr().write</div><div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;                        (</div><div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;                            <a class="code" href="a10733.html#a2e0318a3a140a9ee64174b45fbfd45f0">linePointRef</a>(pt, info.<a class="code" href="a01885.html#afd573313da8eac9d8e6c3064ba18ea8f">missPoint</a>())</div><div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;                        );</div><div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;                    }</div><div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;                }</div><div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;            }</div><div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (patchConstraints[pointI].first() == 3)</div><div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;            {</div><div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;                <span class="comment">// Mark point on the nearest feature point.</span></div><div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;                <span class="keyword">const</span> <a class="code" href="a02791.html">point</a> estimatedPt(pt + patchAttraction[pointI]);</div><div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;</div><div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;                <a class="code" href="a02695.html">Tuple2&lt;label, pointIndexHit&gt;</a> <a class="code" href="a10733.html#a86079a031eeab35048e976435c8d4bae">nearInfo</a>(-1, <a class="code" href="a10733.html#a29558ed008131ebedb6c3b965e9f4175">pointIndexHit</a>());</div><div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;</div><div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;                <span class="keywordflow">if</span> (multiRegionFeatureSnap)</div><div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;                {</div><div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;                    <a class="code" href="a01885.html">pointIndexHit</a> multiPatchPt</div><div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;                    (</div><div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;                        findMultiPatchPoint</div><div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;                        (</div><div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;                            estimatedPt,</div><div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;                            pointFacePatchID[pointI],</div><div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;                            surfaceNormals,</div><div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;                            faceToNormalBin</div><div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;                        )</div><div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;                    );</div><div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;                    <span class="keywordflow">if</span> (multiPatchPt.<a class="code" href="a01885.html#ad963d38a624b8bf8b37c210109dba03c">hit</a>())</div><div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;                    {</div><div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;                        <span class="comment">// Multiple regions</span></div><div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;                        nearInfo = findNearFeaturePoint</div><div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;                        (</div><div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;                            <span class="keyword">true</span>,           <span class="comment">// isRegionPoint</span></div><div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;                            pp,</div><div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;                            snapDist,</div><div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;                            pointI,</div><div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;                            estimatedPt,</div><div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;</div><div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;                            <span class="comment">// Feature-point to pp point</span></div><div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;                            pointAttractor,</div><div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;                            <a class="code" href="a01872.html">pointConstraints</a>,</div><div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;                            <span class="comment">// Feature-edge to pp point</span></div><div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;                            edgeAttractors,</div><div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;                            edgeConstraints,</div><div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;                            <span class="comment">// pp point to nearest feature</span></div><div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;                            patchAttraction,</div><div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;                            patchConstraints</div><div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;                        );</div><div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;                    }</div><div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;                    <span class="keywordflow">else</span></div><div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;                    {</div><div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;                        nearInfo = findNearFeaturePoint</div><div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;                        (</div><div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;                            <span class="keyword">false</span>,              <span class="comment">// isRegionPoint</span></div><div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;                            pp,</div><div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;                            snapDist,</div><div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;                            pointI,</div><div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;                            estimatedPt,</div><div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;</div><div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;                            <span class="comment">// Feature-point to pp point</span></div><div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;                            pointAttractor,</div><div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;                            <a class="code" href="a01872.html">pointConstraints</a>,</div><div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;                            <span class="comment">// Feature-edge to pp point</span></div><div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;                            edgeAttractors,</div><div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;                            edgeConstraints,</div><div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;                            <span class="comment">// pp point to nearest feature</span></div><div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;                            patchAttraction,</div><div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;                            patchConstraints</div><div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;                        );</div><div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;                    }</div><div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;                }</div><div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;                <span class="keywordflow">else</span></div><div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;                {</div><div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;                    <span class="comment">// No multi-patch snapping</span></div><div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;                    nearInfo = findNearFeaturePoint</div><div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;                    (</div><div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;                        <span class="keyword">false</span>,              <span class="comment">// isRegionPoint</span></div><div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;                        pp,</div><div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;                        snapDist,</div><div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;                        pointI,</div><div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;                        estimatedPt,</div><div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;</div><div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;                        <span class="comment">// Feature-point to pp point</span></div><div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;                        pointAttractor,</div><div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;                        <a class="code" href="a01872.html">pointConstraints</a>,</div><div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;                        <span class="comment">// Feature-edge to pp point</span></div><div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;                        edgeAttractors,</div><div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;                        edgeConstraints,</div><div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;                        <span class="comment">// pp point to nearest feature</span></div><div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;                        patchAttraction,</div><div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;                        patchConstraints</div><div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;                    );</div><div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;                }</div><div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;</div><div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;                <span class="keyword">const</span> <a class="code" href="a01885.html">pointIndexHit</a>&amp; info = nearInfo.<a class="code" href="a02695.html#a5d570a89988f907024eede54003b8a79">second</a>();</div><div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;                <span class="keywordflow">if</span> (info.<a class="code" href="a01885.html#ad963d38a624b8bf8b37c210109dba03c">hit</a>() &amp;&amp; featurePointStr.<a class="code" href="a00087.html#a8d985300b138b6c5556ab17ed4df3b38">valid</a>())</div><div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;                {</div><div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;                    featurePointStr().write</div><div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;                    (</div><div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;                        <a class="code" href="a10733.html#a2e0318a3a140a9ee64174b45fbfd45f0">linePointRef</a>(pt, info.<a class="code" href="a01885.html#a0c448cd4b96e9ea9ba38c62c019a8bce">hitPoint</a>())</div><div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;                    );</div><div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;                }</div><div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;            }</div><div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;        }</div><div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;    }</div><div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;}</div><div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;</div><div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;</div><div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;<span class="comment">// Baffle handling</span></div><div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;<span class="comment">// ~~~~~~~~~~~~~~~</span></div><div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;<span class="comment">// Override pointAttractor, edgeAttractor, patchAttration etc. to</span></div><div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;<span class="comment">// implement &#39;baffle&#39; handling.</span></div><div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;<span class="comment">// Baffle: the mesh pp point originates from a loose standing</span></div><div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;<span class="comment">// baffle.</span></div><div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;<span class="comment">// Sampling the surface with the surrounding face-centres only picks up</span></div><div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;<span class="comment">// a single triangle normal so above determineFeatures will not have</span></div><div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;<span class="comment">// detected anything. So explicitly pick up feature edges on the pp</span></div><div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;<span class="comment">// (after duplicating points &amp; smoothing so will already have been</span></div><div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;<span class="comment">// expanded) and match these to the features.</span></div><div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;<span class="keywordtype">void</span> Foam::autoSnapDriver::determineBaffleFeatures</div><div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;(</div><div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;    <span class="keyword">const</span> <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> iter,</div><div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;    <span class="keyword">const</span> scalar featureCos,</div><div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;</div><div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;    <span class="keyword">const</span> <a class="code" href="a01972.html">indirectPrimitivePatch</a>&amp; pp,</div><div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;    <span class="keyword">const</span> <a class="code" href="a00754.html">scalarField</a>&amp; snapDist,</div><div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;</div><div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;    <span class="comment">// Feature-point to pp point</span></div><div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;    <a class="code" href="a01364.html">List&lt;labelList&gt;</a>&amp; pointAttractor,</div><div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;    <a class="code" href="a01364.html">List</a>&lt;<a class="code" href="a01364.html">List&lt;pointConstraint&gt;</a>&gt;&amp; <a class="code" href="a01872.html">pointConstraints</a>,</div><div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;    <span class="comment">// Feature-edge to pp point</span></div><div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;    <a class="code" href="a01364.html">List</a>&lt;<a class="code" href="a01364.html">List</a>&lt;<a class="code" href="a00603.html">DynamicList&lt;point&gt;</a>&gt;&gt;&amp; edgeAttractors,</div><div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;    <a class="code" href="a01364.html">List</a>&lt;<a class="code" href="a01364.html">List</a>&lt;<a class="code" href="a00603.html">DynamicList&lt;pointConstraint&gt;</a>&gt;&gt;&amp; edgeConstraints,</div><div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;    <span class="comment">// pp point to nearest feature</span></div><div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;    <a class="code" href="a00754.html">vectorField</a>&amp; patchAttraction,</div><div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;    <a class="code" href="a01364.html">List&lt;pointConstraint&gt;</a>&amp; patchConstraints</div><div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;)<span class="keyword"> const</span></div><div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;    <span class="keyword">const</span> <a class="code" href="a00876.html">fvMesh</a>&amp; <a class="code" href="a04729.html#a4c1de256df6b3d186a85745b3149394a">mesh</a> = meshRefiner_.mesh();</div><div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;    <span class="keyword">const</span> <a class="code" href="a02113.html">refinementFeatures</a>&amp; features = meshRefiner_.features();</div><div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;</div><div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;    <span class="comment">// Calculate edge-faces</span></div><div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;    <a class="code" href="a01364.html">List&lt;List&lt;point&gt;</a>&gt; edgeFaceNormals(pp.<a class="code" href="a01972.html#a1db9478309c639504a743b7b194226f4">nEdges</a>());</div><div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;</div><div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;    <span class="comment">// Fill local data</span></div><div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;    <a class="code" href="a07669.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(pp.<a class="code" href="a01972.html#ab456054a1e7e1a07261799f50167916f">edgeFaces</a>(), edgeI)</div><div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;    {</div><div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;        <span class="keyword">const</span> <a class="code" href="a01364.html">labelList</a>&amp; eFaces = pp.<a class="code" href="a01972.html#ab456054a1e7e1a07261799f50167916f">edgeFaces</a>()[edgeI];</div><div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;        <a class="code" href="a01364.html">List&lt;point&gt;</a>&amp; eFc = edgeFaceNormals[edgeI];</div><div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;        eFc.<a class="code" href="a01364.html#aedb985ffeaf1bdbfeccc2a8730405703">setSize</a>(eFaces.<a class="code" href="a01364.html#a8a5f6fa29bd4b500caf186f60245b384">size</a>());</div><div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;        <a class="code" href="a07669.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(eFaces, i)</div><div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;        {</div><div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;            <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> faceI = eFaces[i];</div><div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;            eFc[i] = pp.<a class="code" href="a01972.html#aa454c45ea89f03f5d0bd92ea2f38d85a">faceNormals</a>()[faceI];</div><div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;        }</div><div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;    }</div><div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;</div><div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;    {</div><div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;        <span class="comment">// Precalculate mesh edges for pp.edges.</span></div><div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;        <span class="keyword">const</span> <a class="code" href="a01364.html">labelList</a> meshEdges</div><div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;        (</div><div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;            pp.<a class="code" href="a01972.html#ac19048ef57f6dd80e2dec2e69709e82d">meshEdges</a>(mesh.<a class="code" href="a01969.html#aae82d34fe433288eb6b1f9dea53675c8">edges</a>(), mesh.<a class="code" href="a01969.html#a9372e15b6f50db75f39f33f24d4887a4">pointEdges</a>())</div><div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;        );</div><div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;        <a class="code" href="a02545.html#a5ed3e64d2ef89e3823674727ea1b3d58">syncTools::syncEdgeList</a></div><div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;        (</div><div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;            mesh,</div><div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;            meshEdges,</div><div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;            edgeFaceNormals,</div><div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;            <a class="code" href="a01368.html">listPlusEqOp&lt;point&gt;</a>(),</div><div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;            <a class="code" href="a01364.html">List&lt;point&gt;</a>(),</div><div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;            <a class="code" href="a02663.html">mapDistribute::transform</a>()</div><div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;        );</div><div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;    }</div><div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;</div><div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;    <span class="comment">// Detect baffle edges. Assume initial mesh will have 0,90 or 180</span></div><div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;    <span class="comment">// (baffle) degree angles so smoothing should make 0,90</span></div><div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;    <span class="comment">// to be less than 90.</span></div><div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;    <span class="keyword">const</span> scalar baffleFeatureCos = <a class="code" href="a10733.html#aebb41a148f7cf44b63e12f69e487e49f">Foam::cos</a>(<a class="code" href="a10733.html#af706f965be4d1457b0f1e7fade1c0118">degToRad</a>(91));</div><div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;</div><div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;</div><div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;    <a class="code" href="a00087.html">autoPtr&lt;OBJstream&gt;</a> baffleEdgeStr;</div><div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;    <span class="keywordflow">if</span> (debug&amp;<a class="code" href="a01470.html#a92dc814ea7fd34acae287945426740d3a42750666a219d68f9028ca726fe4fa71">meshRefinement::ATTRACTION</a>)</div><div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;    {</div><div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;        baffleEdgeStr.<a class="code" href="a00087.html#ab46a1bc64c9af6414376c6c18d3bee62">reset</a></div><div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;        (</div><div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;            <span class="keyword">new</span> <a class="code" href="a01692.html">OBJstream</a></div><div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;            (</div><div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;                meshRefiner_.mesh().time().path()</div><div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;              / <span class="stringliteral">&quot;baffleEdge_&quot;</span> + <a class="code" href="a10733.html#adcb0df2bd4953cb6bb390272d8263c3a">name</a>(iter) + <span class="stringliteral">&quot;.obj&quot;</span></div><div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;            )</div><div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;        );</div><div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;        <a class="code" href="a10733.html#a501e80d1e14c94973e82f1555e7eb711">Info</a>&lt;&lt; <a class="code" href="a10733.html#ae53117a9770efe95d2d01bb5cc2c99ef">nl</a> &lt;&lt; <span class="stringliteral">&quot;Dumping baffle-edges to &quot;</span></div><div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;            &lt;&lt; baffleEdgeStr().name() &lt;&lt; <a class="code" href="a10733.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div><div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;    }</div><div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;</div><div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;</div><div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;    <span class="comment">// Is edge on baffle</span></div><div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;    <a class="code" href="a01756.html">PackedBoolList</a> isBaffleEdge(pp.<a class="code" href="a01972.html#a1db9478309c639504a743b7b194226f4">nEdges</a>());</div><div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;    <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> nBaffleEdges = 0;</div><div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;    <span class="comment">// Is point on</span></div><div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;    <span class="comment">//  0 : baffle-edge (0)</span></div><div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;    <span class="comment">//  1 : baffle-feature-point (1)</span></div><div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;    <span class="comment">// -1 : rest</span></div><div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;    <a class="code" href="a01364.html">labelList</a> pointStatus(pp.<a class="code" href="a01972.html#a9927abeba2c8506177084d644b6e573a">nPoints</a>(), -1);</div><div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;</div><div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;    <a class="code" href="a07669.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(edgeFaceNormals, edgeI)</div><div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;    {</div><div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;        <span class="keyword">const</span> <a class="code" href="a01364.html">List&lt;point&gt;</a>&amp; efn = edgeFaceNormals[edgeI];</div><div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;</div><div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;        <span class="keywordflow">if</span> (efn.<a class="code" href="a01364.html#a8a5f6fa29bd4b500caf186f60245b384">size</a>() == 2 &amp;&amp; (efn[0]&amp;efn[1]) &lt; baffleFeatureCos)</div><div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;        {</div><div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;            isBaffleEdge[edgeI] = <span class="keyword">true</span>;</div><div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;            nBaffleEdges++;</div><div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;            <span class="keyword">const</span> <a class="code" href="a00611.html">edge</a>&amp; <a class="code" href="a10733.html#a4225a7492f7d468ad5b985282c8ee7b1">e</a> = pp.<a class="code" href="a01972.html#aae82d34fe433288eb6b1f9dea53675c8">edges</a>()[edgeI];</div><div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;            pointStatus[e[0]] = 0;</div><div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;            pointStatus[e[1]] = 0;</div><div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;</div><div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;            <span class="keywordflow">if</span> (baffleEdgeStr.<a class="code" href="a00087.html#a8d985300b138b6c5556ab17ed4df3b38">valid</a>())</div><div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;            {</div><div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;                <span class="keyword">const</span> <a class="code" href="a02791.html">point</a>&amp; p0 = pp.<a class="code" href="a01972.html#a180aa335ba66b3224df33de8eb29b3bf">localPoints</a>()[e[0]];</div><div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;                <span class="keyword">const</span> <a class="code" href="a02791.html">point</a>&amp; p1 = pp.<a class="code" href="a01972.html#a180aa335ba66b3224df33de8eb29b3bf">localPoints</a>()[e[1]];</div><div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;                baffleEdgeStr().write(<a class="code" href="a10733.html#a2e0318a3a140a9ee64174b45fbfd45f0">linePointRef</a>(p0, p1));</div><div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;            }</div><div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;        }</div><div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;    }</div><div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;</div><div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;    <a class="code" href="a10733.html#a501e80d1e14c94973e82f1555e7eb711">Info</a>&lt;&lt; <span class="stringliteral">&quot;Detected &quot;</span></div><div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;        &lt;&lt; <a class="code" href="a10733.html#a8d528a67d2a9c6fe4fb94bc86872624b">returnReduce</a>(nBaffleEdges, <a class="code" href="a02469.html">sumOp&lt;label&gt;</a>())</div><div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;        &lt;&lt; <span class="stringliteral">&quot; baffle edges out of &quot;</span></div><div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;        &lt;&lt; <a class="code" href="a10733.html#a8d528a67d2a9c6fe4fb94bc86872624b">returnReduce</a>(pp.<a class="code" href="a01972.html#a1db9478309c639504a743b7b194226f4">nEdges</a>(), <a class="code" href="a02469.html">sumOp&lt;label&gt;</a>())</div><div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;        &lt;&lt; <span class="stringliteral">&quot; edges.&quot;</span> &lt;&lt; <a class="code" href="a10733.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div><div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;</div><div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;</div><div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;    <a class="code" href="a07669.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(pp.<a class="code" href="a01972.html#a9372e15b6f50db75f39f33f24d4887a4">pointEdges</a>(), pointI)</div><div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;    {</div><div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;        <span class="keywordflow">if</span></div><div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;        (</div><div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;            isFeaturePoint</div><div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;            (</div><div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;                featureCos,</div><div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;                pp,</div><div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;                isBaffleEdge,</div><div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;                pointI</div><div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;            )</div><div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;        )</div><div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;        {</div><div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;            <span class="comment">//Pout&lt;&lt; &quot;Detected feature point:&quot; &lt;&lt; pp.localPoints()[pointI]</span></div><div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;            <span class="comment">//    &lt;&lt; endl;</span></div><div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;            <span class="comment">//-TEMPORARILY DISABLED:</span></div><div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;            <span class="comment">//pointStatus[pointI] = 1;</span></div><div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;        }</div><div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;    }</div><div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;</div><div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;</div><div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;    <a class="code" href="a07669.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(pointStatus, pointI)</div><div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;    {</div><div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;        <span class="keyword">const</span> <a class="code" href="a02791.html">point</a>&amp; pt = pp.<a class="code" href="a01972.html#a180aa335ba66b3224df33de8eb29b3bf">localPoints</a>()[pointI];</div><div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;</div><div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;        <span class="keywordflow">if</span> (pointStatus[pointI] == 0)   <span class="comment">// baffle edge</span></div><div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;        {</div><div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;            <a class="code" href="a02695.html">Tuple2&lt;label, pointIndexHit&gt;</a> <a class="code" href="a02695.html">nearInfo</a> = findNearFeatureEdge</div><div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;            (</div><div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;                <span class="keyword">false</span>,          <span class="comment">// isRegionPoint?</span></div><div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;                pp,</div><div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;                snapDist,</div><div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;                pointI,</div><div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;                pt,</div><div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;</div><div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;                edgeAttractors,</div><div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;                edgeConstraints,</div><div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;                patchAttraction,</div><div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;                patchConstraints</div><div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;            );</div><div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;</div><div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;            <span class="keywordflow">if</span> (!nearInfo.<a class="code" href="a02695.html#a5d570a89988f907024eede54003b8a79">second</a>().hit())</div><div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;            {</div><div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;                <span class="comment">//Pout&lt;&lt; &quot;*** Failed to find close edge to point &quot; &lt;&lt; pt</span></div><div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;                <span class="comment">//    &lt;&lt; endl;</span></div><div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;            }</div><div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;        }</div><div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pointStatus[pointI] == 1)   <span class="comment">// baffle point</span></div><div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;        {</div><div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;            <a class="code" href="a01364.html">labelList</a> nearFeat;</div><div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;            <a class="code" href="a01364.html">List&lt;pointIndexHit&gt;</a> <a class="code" href="a10733.html#a86079a031eeab35048e976435c8d4bae">nearInfo</a>;</div><div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;            features.<a class="code" href="a02113.html#af325395e896cf5a85e7d72a0c8c34735">findNearestPoint</a></div><div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;            (</div><div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;                <a class="code" href="a10733.html#a5997a67f2e85a15c0e13a1724273aa5f">pointField</a>(1, pt),</div><div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;                <a class="code" href="a10733.html#a6e363d070e971ead1a4c40475084e584">scalarField</a>(1, <a class="code" href="a10733.html#a277dc11c581d53826ab5090b08f3b17b">sqr</a>(snapDist[pointI])),</div><div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;                nearFeat,</div><div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;                nearInfo</div><div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;            );</div><div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;</div><div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;            <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> featI = nearFeat[0];</div><div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;</div><div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;            <span class="keywordflow">if</span> (featI != -1)</div><div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;            {</div><div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;                <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> featPointI = nearInfo[0].index();</div><div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;                <span class="keyword">const</span> <a class="code" href="a02791.html">point</a>&amp; featPt = nearInfo[0].hitPoint();</div><div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;                scalar distSqr = <a class="code" href="a10733.html#ae6fff2c6981e6d9618aa5038e69def6e">magSqr</a>(featPt-pt);</div><div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;</div><div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;                <span class="comment">// Check if already attracted</span></div><div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;                <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> oldPointI = pointAttractor[featI][featPointI];</div><div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;</div><div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;                <span class="keywordflow">if</span></div><div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;                (</div><div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;                    oldPointI == -1</div><div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;                 || (</div><div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;                        distSqr</div><div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;                      &lt; <a class="code" href="a10733.html#ae6fff2c6981e6d9618aa5038e69def6e">magSqr</a>(featPt-pp.<a class="code" href="a01972.html#a180aa335ba66b3224df33de8eb29b3bf">localPoints</a>()[oldPointI])</div><div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;                    )</div><div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;                )</div><div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;                {</div><div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;                    pointAttractor[featI][featPointI] = pointI;</div><div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;                    <a class="code" href="a01872.html">pointConstraints</a>[featI][featPointI].first() = 3;</div><div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;                    <a class="code" href="a01872.html">pointConstraints</a>[featI][featPointI].second() =</div><div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;                        <a class="code" href="a02791.html#ac3b79445511a1e3a6443b59ac93c394a">vector::zero</a>;</div><div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;</div><div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;                    <span class="comment">// Store for later use</span></div><div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;                    patchAttraction[pointI] = featPt-pt;</div><div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;                    patchConstraints[pointI] =</div><div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;                        <a class="code" href="a01872.html">pointConstraints</a>[featI][featPointI];</div><div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;</div><div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;                    <span class="keywordflow">if</span> (oldPointI != -1)</div><div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;                    {</div><div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;                        <span class="comment">// The current point is closer so wins. Reset</span></div><div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;                        <span class="comment">// the old point to attract to nearest edge</span></div><div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;                        <span class="comment">// instead.</span></div><div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;                        findNearFeatureEdge</div><div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;                        (</div><div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;                            <span class="keyword">false</span>,              <span class="comment">// isRegionPoint</span></div><div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;                            pp,</div><div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;                            snapDist,</div><div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;                            oldPointI,</div><div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;                            pp.<a class="code" href="a01972.html#a180aa335ba66b3224df33de8eb29b3bf">localPoints</a>()[oldPointI],</div><div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;</div><div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;                            edgeAttractors,</div><div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;                            edgeConstraints,</div><div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;                            patchAttraction,</div><div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;                            patchConstraints</div><div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;                        );</div><div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;                    }</div><div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;                }</div><div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;                <span class="keywordflow">else</span></div><div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;                {</div><div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;                    <span class="comment">// Make it fall through to check below</span></div><div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;                    featI = -1;</div><div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;                }</div><div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;            }</div><div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;</div><div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;            <span class="comment">// Not found a feature point or another point is already</span></div><div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;            <span class="comment">// closer to that feature</span></div><div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;            <span class="keywordflow">if</span> (featI == -1)</div><div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;            {</div><div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;                <span class="comment">//Pout&lt;&lt; &quot;*** Falling back to finding nearest feature&quot;</span></div><div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;                <span class="comment">//    &lt;&lt; &quot; edge&quot;</span></div><div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;                <span class="comment">//    &lt;&lt; &quot; for baffle-feature-point &quot; &lt;&lt; pt</span></div><div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;                <span class="comment">//    &lt;&lt; endl;</span></div><div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;</div><div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;                findNearFeatureEdge</div><div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;                (</div><div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;                    <span class="keyword">false</span>,                  <span class="comment">// isRegionPoint</span></div><div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;                    pp,</div><div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;                    snapDist,</div><div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;                    pointI,</div><div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;                    pt,                     <span class="comment">// starting point</span></div><div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;</div><div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;                    edgeAttractors,</div><div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;                    edgeConstraints,</div><div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;                    patchAttraction,</div><div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;                    patchConstraints</div><div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;                );</div><div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;            }</div><div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;        }</div><div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;    }</div><div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;}</div><div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;</div><div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;</div><div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;<span class="keywordtype">void</span> Foam::autoSnapDriver::reverseAttractMeshPoints</div><div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;(</div><div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;    <span class="keyword">const</span> <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> iter,</div><div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;</div><div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;    <span class="keyword">const</span> <a class="code" href="a01972.html">indirectPrimitivePatch</a>&amp; pp,</div><div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;    <span class="keyword">const</span> <a class="code" href="a00754.html">scalarField</a>&amp; snapDist,</div><div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;</div><div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;    <span class="comment">// Feature-point to pp point</span></div><div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;    <span class="keyword">const</span> <a class="code" href="a01364.html">List&lt;labelList&gt;</a>&amp; pointAttractor,</div><div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;    <span class="keyword">const</span> <a class="code" href="a01364.html">List</a>&lt;<a class="code" href="a01364.html">List&lt;pointConstraint&gt;</a>&gt;&amp; <a class="code" href="a01872.html">pointConstraints</a>,</div><div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;    <span class="comment">// Feature-edge to pp point</span></div><div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;    <span class="keyword">const</span> <a class="code" href="a01364.html">List</a>&lt;<a class="code" href="a01364.html">List</a>&lt;<a class="code" href="a00603.html">DynamicList&lt;point&gt;</a>&gt;&gt;&amp; edgeAttractors,</div><div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;    <span class="keyword">const</span> <a class="code" href="a01364.html">List</a>&lt;<a class="code" href="a01364.html">List</a>&lt;<a class="code" href="a00603.html">DynamicList&lt;pointConstraint&gt;</a>&gt;&gt;&amp; edgeConstraints,</div><div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;</div><div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;    <span class="keyword">const</span> <a class="code" href="a00754.html">vectorField</a>&amp; rawPatchAttraction,</div><div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;    <span class="keyword">const</span> <a class="code" href="a01364.html">List&lt;pointConstraint&gt;</a>&amp; rawPatchConstraints,</div><div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;</div><div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;    <span class="comment">// pp point to nearest feature</span></div><div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;    <a class="code" href="a00754.html">vectorField</a>&amp; patchAttraction,</div><div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;    <a class="code" href="a01364.html">List&lt;pointConstraint&gt;</a>&amp; patchConstraints</div><div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;)<span class="keyword"> const</span></div><div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;    <span class="keyword">const</span> <a class="code" href="a02113.html">refinementFeatures</a>&amp; features = meshRefiner_.features();</div><div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;</div><div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;    <span class="comment">// Find nearest mesh point to feature edge</span></div><div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;    <span class="comment">// ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></div><div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;    <span class="comment">// Reverse lookup : go through all edgeAttractors and find the</span></div><div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;    <span class="comment">// nearest point on pp</span></div><div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;</div><div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;    <span class="comment">// Get search domain and extend it a bit</span></div><div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;    <a class="code" href="a02671.html">treeBoundBox</a> bb(pp.<a class="code" href="a01972.html#a180aa335ba66b3224df33de8eb29b3bf">localPoints</a>());</div><div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;    {</div><div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;        <span class="comment">// Random number generator. Bit dodgy since not exactly random ;-)</span></div><div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;        <a class="code" href="a02064.html">Random</a> <a class="code" href="a04428.html#a5131998e20f3c5a8bd03cf9b48cc76c7">rndGen</a>(65431);</div><div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;</div><div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;        <span class="comment">// Slightly extended bb. Slightly off-centred just so on symmetric</span></div><div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;        <span class="comment">// geometry there are less face/edge aligned items.</span></div><div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;        bb = bb.extend(rndGen, 1<a class="code" href="a10733.html#a4225a7492f7d468ad5b985282c8ee7b1">e</a>-4);</div><div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;        bb.min() -= <a class="code" href="a10733.html#a643590f4015338d12714af03d61a0ac9">point</a>(ROOTVSMALL, ROOTVSMALL, ROOTVSMALL);</div><div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;        bb.max() += <a class="code" href="a10733.html#a643590f4015338d12714af03d61a0ac9">point</a>(ROOTVSMALL, ROOTVSMALL, ROOTVSMALL);</div><div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;    }</div><div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;</div><div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;    <span class="comment">// Collect candidate points for attraction</span></div><div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;    <a class="code" href="a00603.html">DynamicList&lt;label&gt;</a> attractPoints(pp.<a class="code" href="a01972.html#a9927abeba2c8506177084d644b6e573a">nPoints</a>());</div><div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;    {</div><div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;        <span class="keyword">const</span> <a class="code" href="a00876.html">fvMesh</a>&amp; <a class="code" href="a04729.html#a4c1de256df6b3d186a85745b3149394a">mesh</a> = meshRefiner_.mesh();</div><div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;</div><div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;        <a class="code" href="a01364.html">boolList</a> isFeatureEdgeOrPoint(pp.<a class="code" href="a01972.html#a9927abeba2c8506177084d644b6e573a">nPoints</a>(), <span class="keyword">false</span>);</div><div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;        <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> nFeats = 0;</div><div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;        <a class="code" href="a07669.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(rawPatchConstraints, pointI)</div><div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;        {</div><div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;            <span class="keywordflow">if</span> (rawPatchConstraints[pointI].first() &gt;= 2)</div><div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;            {</div><div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;                isFeatureEdgeOrPoint[pointI] = <span class="keyword">true</span>;</div><div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;                nFeats++;</div><div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;            }</div><div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;        }</div><div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;</div><div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;        <a class="code" href="a10733.html#a501e80d1e14c94973e82f1555e7eb711">Info</a>&lt;&lt; <span class="stringliteral">&quot;Initially selected &quot;</span> &lt;&lt; <a class="code" href="a10733.html#a8d528a67d2a9c6fe4fb94bc86872624b">returnReduce</a>(nFeats, <a class="code" href="a02469.html">sumOp&lt;label&gt;</a>())</div><div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; points out of &quot;</span> &lt;&lt; <a class="code" href="a10733.html#a8d528a67d2a9c6fe4fb94bc86872624b">returnReduce</a>(pp.<a class="code" href="a01972.html#a9927abeba2c8506177084d644b6e573a">nPoints</a>(), <a class="code" href="a02469.html">sumOp&lt;label&gt;</a>())</div><div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; for reverse attraction.&quot;</span> &lt;&lt; <a class="code" href="a10733.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div><div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;</div><div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;        <span class="comment">// Make sure is synchronised (note: check if constraint is already</span></div><div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;        <span class="comment">// synced in which case this is not needed here)</span></div><div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;        <a class="code" href="a02545.html#a197ed77a9101bdfb37253bd3f507c017">syncTools::syncPointList</a></div><div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;        (</div><div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;            mesh,</div><div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;            pp.<a class="code" href="a01972.html#ae4935f85c38392518565dd7c666e3caf">meshPoints</a>(),</div><div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;            isFeatureEdgeOrPoint,</div><div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;            <a class="code" href="a01720.html">orEqOp&lt;bool&gt;</a>(),         <span class="comment">// combine op</span></div><div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;            <span class="keyword">false</span></div><div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;        );</div><div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;</div><div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> nGrow = 0; nGrow &lt; 1; nGrow++)</div><div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;        {</div><div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;            <a class="code" href="a01364.html">boolList</a> newIsFeatureEdgeOrPoint(isFeatureEdgeOrPoint);</div><div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;</div><div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;            <a class="code" href="a07669.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(pp.<a class="code" href="a01972.html#af5aca3ce69275c80366bc8d5c0584da2">localFaces</a>(), faceI)</div><div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;            {</div><div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;                <span class="keyword">const</span> <a class="code" href="a00714.html">face</a>&amp; <a class="code" href="a03926.html#a888be93833ac7a23170555c69c690288">f</a> = pp.<a class="code" href="a01972.html#af5aca3ce69275c80366bc8d5c0584da2">localFaces</a>()[faceI];</div><div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;</div><div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;                <a class="code" href="a07669.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(f, fp)</div><div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;                {</div><div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;                    <span class="keywordflow">if</span> (isFeatureEdgeOrPoint[f[fp]])</div><div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;                    {</div><div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;                        <span class="comment">// Mark all points on face</span></div><div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;                        <a class="code" href="a07669.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(f, fp)</div><div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;                        {</div><div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;                            newIsFeatureEdgeOrPoint[f[fp]] = <span class="keyword">true</span>;</div><div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;                        }</div><div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;                    }</div><div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;                }</div><div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;            }</div><div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;</div><div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;            isFeatureEdgeOrPoint = newIsFeatureEdgeOrPoint;</div><div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;</div><div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;            <a class="code" href="a02545.html#a197ed77a9101bdfb37253bd3f507c017">syncTools::syncPointList</a></div><div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;            (</div><div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;                mesh,</div><div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;                pp.<a class="code" href="a01972.html#ae4935f85c38392518565dd7c666e3caf">meshPoints</a>(),</div><div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;                isFeatureEdgeOrPoint,</div><div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;                <a class="code" href="a01720.html">orEqOp&lt;bool&gt;</a>(),         <span class="comment">// combine op</span></div><div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;                <span class="keyword">false</span></div><div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;            );</div><div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;        }</div><div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;</div><div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;</div><div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;        <span class="comment">// Collect attractPoints</span></div><div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;        <a class="code" href="a07669.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(isFeatureEdgeOrPoint, pointI)</div><div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;        {</div><div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;            <span class="keywordflow">if</span> (isFeatureEdgeOrPoint[pointI])</div><div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;            {</div><div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;                attractPoints.append(pointI);</div><div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;            }</div><div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;        }</div><div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;</div><div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160;        <a class="code" href="a10733.html#a501e80d1e14c94973e82f1555e7eb711">Info</a>&lt;&lt; <span class="stringliteral">&quot;Selected &quot;</span></div><div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;            &lt;&lt; <a class="code" href="a10733.html#a8d528a67d2a9c6fe4fb94bc86872624b">returnReduce</a>(attractPoints.size(), <a class="code" href="a02469.html">sumOp&lt;label&gt;</a>())</div><div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; points out of &quot;</span> &lt;&lt; <a class="code" href="a10733.html#a8d528a67d2a9c6fe4fb94bc86872624b">returnReduce</a>(pp.<a class="code" href="a01972.html#a9927abeba2c8506177084d644b6e573a">nPoints</a>(), <a class="code" href="a02469.html">sumOp&lt;label&gt;</a>())</div><div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; for reverse attraction.&quot;</span> &lt;&lt; <a class="code" href="a10733.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div><div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;    }</div><div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;</div><div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;</div><div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;    <a class="code" href="a01054.html">indexedOctree&lt;treeDataPoint&gt;</a> ppTree</div><div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;    (</div><div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;        <a class="code" href="a02675.html">treeDataPoint</a>(pp.<a class="code" href="a01972.html#a180aa335ba66b3224df33de8eb29b3bf">localPoints</a>(), attractPoints),</div><div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;        bb,                             <span class="comment">// overall search domain</span></div><div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;        8,                              <span class="comment">// maxLevel</span></div><div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;        10,                             <span class="comment">// leafsize</span></div><div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;        3.0                             <span class="comment">// duplicity</span></div><div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160;    );</div><div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;</div><div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160;    <span class="comment">// Per mesh point the point on nearest feature edge.</span></div><div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;    patchAttraction.<a class="code" href="a01364.html#aedb985ffeaf1bdbfeccc2a8730405703">setSize</a>(pp.<a class="code" href="a01972.html#a9927abeba2c8506177084d644b6e573a">nPoints</a>());</div><div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160;    patchAttraction = <a class="code" href="a02791.html#ac3b79445511a1e3a6443b59ac93c394a">vector::zero</a>;</div><div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;    patchConstraints.<a class="code" href="a01364.html#aedb985ffeaf1bdbfeccc2a8730405703">setSize</a>(pp.<a class="code" href="a01972.html#a9927abeba2c8506177084d644b6e573a">nPoints</a>());</div><div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;    patchConstraints = <a class="code" href="a01871.html">pointConstraint</a>();</div><div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160;</div><div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;    <a class="code" href="a07669.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(edgeAttractors, featI)</div><div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160;    {</div><div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;        <span class="keyword">const</span> <a class="code" href="a01364.html">List&lt;DynamicList&lt;point&gt;</a>&gt;&amp; edgeAttr = edgeAttractors[featI];</div><div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160;        <span class="keyword">const</span> <a class="code" href="a01364.html">List&lt;DynamicList&lt;pointConstraint&gt;</a>&gt;&amp; edgeConstr =</div><div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;            edgeConstraints[featI];</div><div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;</div><div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;        <a class="code" href="a07669.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(edgeAttr, featEdgeI)</div><div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160;        {</div><div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;            <span class="keyword">const</span> <a class="code" href="a00603.html">DynamicList&lt;point&gt;</a>&amp; attr = edgeAttr[featEdgeI];</div><div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160;            <a class="code" href="a07669.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(attr, i)</div><div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;            {</div><div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;                <span class="comment">// Find nearest pp point</span></div><div class="line"><a name="l02607"></a><span class="lineno"> 2607</span>&#160;                <span class="keyword">const</span> <a class="code" href="a02791.html">point</a>&amp; featPt = attr[i];</div><div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160;                <a class="code" href="a01885.html">pointIndexHit</a> <a class="code" href="a02695.html">nearInfo</a> = ppTree.findNearest</div><div class="line"><a name="l02609"></a><span class="lineno"> 2609</span>&#160;                (</div><div class="line"><a name="l02610"></a><span class="lineno"> 2610</span>&#160;                    featPt,</div><div class="line"><a name="l02611"></a><span class="lineno"> 2611</span>&#160;                    <a class="code" href="a10733.html#a277dc11c581d53826ab5090b08f3b17b">sqr</a>(GREAT)</div><div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160;                );</div><div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;</div><div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;                <span class="keywordflow">if</span> (nearInfo.<a class="code" href="a01885.html#ad963d38a624b8bf8b37c210109dba03c">hit</a>())</div><div class="line"><a name="l02615"></a><span class="lineno"> 2615</span>&#160;                {</div><div class="line"><a name="l02616"></a><span class="lineno"> 2616</span>&#160;                    <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> pointI =</div><div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160;                        ppTree.<a class="code" href="a01054.html#abd186b2cbd8c6def61dc033a4892b847">shapes</a>().pointLabels()[nearInfo.<a class="code" href="a01885.html#a7d1e8acadb27bd2b4e61457d47b71b6f">index</a>()];</div><div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;                    <span class="keyword">const</span> <a class="code" href="a02791.html">point</a> attraction = featPt-pp.<a class="code" href="a01972.html#a180aa335ba66b3224df33de8eb29b3bf">localPoints</a>()[pointI];</div><div class="line"><a name="l02619"></a><span class="lineno"> 2619</span>&#160;</div><div class="line"><a name="l02620"></a><span class="lineno"> 2620</span>&#160;                    <span class="comment">// Check if this point is already being attracted. If so</span></div><div class="line"><a name="l02621"></a><span class="lineno"> 2621</span>&#160;                    <span class="comment">// override it only if nearer.</span></div><div class="line"><a name="l02622"></a><span class="lineno"> 2622</span>&#160;                    <span class="keywordflow">if</span></div><div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160;                    (</div><div class="line"><a name="l02624"></a><span class="lineno"> 2624</span>&#160;                        patchConstraints[pointI].first() &lt;= 1</div><div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160;                     || <a class="code" href="a10733.html#ae6fff2c6981e6d9618aa5038e69def6e">magSqr</a>(attraction) &lt; <a class="code" href="a10733.html#ae6fff2c6981e6d9618aa5038e69def6e">magSqr</a>(patchAttraction[pointI])</div><div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160;                    )</div><div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;                    {</div><div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;                        patchAttraction[pointI] = attraction;</div><div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160;                        patchConstraints[pointI] = edgeConstr[featEdgeI][i];</div><div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160;                    }</div><div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160;                }</div><div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160;                <span class="keywordflow">else</span></div><div class="line"><a name="l02633"></a><span class="lineno"> 2633</span>&#160;                {</div><div class="line"><a name="l02634"></a><span class="lineno"> 2634</span>&#160;                    <a class="code" href="a07728.html#a58548a3fc67fb931bc4e99f94d5f41b8">WarningInFunction</a></div><div class="line"><a name="l02635"></a><span class="lineno"> 2635</span>&#160;                        &lt;&lt; <span class="stringliteral">&quot;Did not find pp point near &quot;</span> &lt;&lt; featPt</div><div class="line"><a name="l02636"></a><span class="lineno"> 2636</span>&#160;                        &lt;&lt; <a class="code" href="a10733.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div><div class="line"><a name="l02637"></a><span class="lineno"> 2637</span>&#160;                }</div><div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160;            }</div><div class="line"><a name="l02639"></a><span class="lineno"> 2639</span>&#160;        }</div><div class="line"><a name="l02640"></a><span class="lineno"> 2640</span>&#160;    }</div><div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160;</div><div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160;</div><div class="line"><a name="l02643"></a><span class="lineno"> 2643</span>&#160;    <span class="comment">// Different procs might have different patchAttraction,patchConstraints</span></div><div class="line"><a name="l02644"></a><span class="lineno"> 2644</span>&#160;    <span class="comment">// however these only contain geometric information, no topology</span></div><div class="line"><a name="l02645"></a><span class="lineno"> 2645</span>&#160;    <span class="comment">// so as long as we synchronise after overriding with feature points</span></div><div class="line"><a name="l02646"></a><span class="lineno"> 2646</span>&#160;    <span class="comment">// there is no problem, just possibly a small error.</span></div><div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160;</div><div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160;</div><div class="line"><a name="l02649"></a><span class="lineno"> 2649</span>&#160;    <span class="comment">// Find nearest mesh point to feature point</span></div><div class="line"><a name="l02650"></a><span class="lineno"> 2650</span>&#160;    <span class="comment">// ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></div><div class="line"><a name="l02651"></a><span class="lineno"> 2651</span>&#160;    <span class="comment">// (overrides attraction to feature edge)</span></div><div class="line"><a name="l02652"></a><span class="lineno"> 2652</span>&#160;    <a class="code" href="a07669.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(pointAttractor, featI)</div><div class="line"><a name="l02653"></a><span class="lineno"> 2653</span>&#160;    {</div><div class="line"><a name="l02654"></a><span class="lineno"> 2654</span>&#160;        <span class="keyword">const</span> <a class="code" href="a01364.html">labelList</a>&amp; pointAttr = pointAttractor[featI];</div><div class="line"><a name="l02655"></a><span class="lineno"> 2655</span>&#160;        <span class="keyword">const</span> <a class="code" href="a01364.html">List&lt;pointConstraint&gt;</a>&amp; pointConstr = <a class="code" href="a01872.html">pointConstraints</a>[featI];</div><div class="line"><a name="l02656"></a><span class="lineno"> 2656</span>&#160;</div><div class="line"><a name="l02657"></a><span class="lineno"> 2657</span>&#160;        <a class="code" href="a07669.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(pointAttr, featPointI)</div><div class="line"><a name="l02658"></a><span class="lineno"> 2658</span>&#160;        {</div><div class="line"><a name="l02659"></a><span class="lineno"> 2659</span>&#160;            <span class="keywordflow">if</span> (pointAttr[featPointI] != -1)</div><div class="line"><a name="l02660"></a><span class="lineno"> 2660</span>&#160;            {</div><div class="line"><a name="l02661"></a><span class="lineno"> 2661</span>&#160;                <span class="keyword">const</span> <a class="code" href="a02791.html">point</a>&amp; featPt = features[featI].points()</div><div class="line"><a name="l02662"></a><span class="lineno"> 2662</span>&#160;                [</div><div class="line"><a name="l02663"></a><span class="lineno"> 2663</span>&#160;                    featPointI</div><div class="line"><a name="l02664"></a><span class="lineno"> 2664</span>&#160;                ];</div><div class="line"><a name="l02665"></a><span class="lineno"> 2665</span>&#160;</div><div class="line"><a name="l02666"></a><span class="lineno"> 2666</span>&#160;                <span class="comment">// Find nearest pp point</span></div><div class="line"><a name="l02667"></a><span class="lineno"> 2667</span>&#160;                <a class="code" href="a01885.html">pointIndexHit</a> <a class="code" href="a02695.html">nearInfo</a> = ppTree.findNearest</div><div class="line"><a name="l02668"></a><span class="lineno"> 2668</span>&#160;                (</div><div class="line"><a name="l02669"></a><span class="lineno"> 2669</span>&#160;                    featPt,</div><div class="line"><a name="l02670"></a><span class="lineno"> 2670</span>&#160;                    <a class="code" href="a10733.html#a277dc11c581d53826ab5090b08f3b17b">sqr</a>(GREAT)</div><div class="line"><a name="l02671"></a><span class="lineno"> 2671</span>&#160;                );</div><div class="line"><a name="l02672"></a><span class="lineno"> 2672</span>&#160;</div><div class="line"><a name="l02673"></a><span class="lineno"> 2673</span>&#160;                <span class="keywordflow">if</span> (nearInfo.<a class="code" href="a01885.html#ad963d38a624b8bf8b37c210109dba03c">hit</a>())</div><div class="line"><a name="l02674"></a><span class="lineno"> 2674</span>&#160;                {</div><div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160;                    <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> pointI =</div><div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160;                        ppTree.<a class="code" href="a01054.html#abd186b2cbd8c6def61dc033a4892b847">shapes</a>().pointLabels()[nearInfo.<a class="code" href="a01885.html#a7d1e8acadb27bd2b4e61457d47b71b6f">index</a>()];</div><div class="line"><a name="l02677"></a><span class="lineno"> 2677</span>&#160;</div><div class="line"><a name="l02678"></a><span class="lineno"> 2678</span>&#160;                    <span class="keyword">const</span> <a class="code" href="a02791.html">point</a>&amp; pt = pp.<a class="code" href="a01972.html#a180aa335ba66b3224df33de8eb29b3bf">localPoints</a>()[pointI];</div><div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160;                    <span class="keyword">const</span> <a class="code" href="a02791.html">point</a> attraction = featPt-pt;</div><div class="line"><a name="l02680"></a><span class="lineno"> 2680</span>&#160;</div><div class="line"><a name="l02681"></a><span class="lineno"> 2681</span>&#160;                    <span class="comment">// - already attracted to feature edge : point always wins</span></div><div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160;                    <span class="comment">// - already attracted to feature point: nearest wins</span></div><div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160;</div><div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160;                    <span class="keywordflow">if</span> (patchConstraints[pointI].first() &lt;= 1)</div><div class="line"><a name="l02685"></a><span class="lineno"> 2685</span>&#160;                    {</div><div class="line"><a name="l02686"></a><span class="lineno"> 2686</span>&#160;                        patchAttraction[pointI] = attraction;</div><div class="line"><a name="l02687"></a><span class="lineno"> 2687</span>&#160;                        patchConstraints[pointI] = pointConstr[featPointI];</div><div class="line"><a name="l02688"></a><span class="lineno"> 2688</span>&#160;                    }</div><div class="line"><a name="l02689"></a><span class="lineno"> 2689</span>&#160;                    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (patchConstraints[pointI].first() == 2)</div><div class="line"><a name="l02690"></a><span class="lineno"> 2690</span>&#160;                    {</div><div class="line"><a name="l02691"></a><span class="lineno"> 2691</span>&#160;                        patchAttraction[pointI] = attraction;</div><div class="line"><a name="l02692"></a><span class="lineno"> 2692</span>&#160;                        patchConstraints[pointI] = pointConstr[featPointI];</div><div class="line"><a name="l02693"></a><span class="lineno"> 2693</span>&#160;                    }</div><div class="line"><a name="l02694"></a><span class="lineno"> 2694</span>&#160;                    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (patchConstraints[pointI].first() == 3)</div><div class="line"><a name="l02695"></a><span class="lineno"> 2695</span>&#160;                    {</div><div class="line"><a name="l02696"></a><span class="lineno"> 2696</span>&#160;                        <span class="comment">// Only if nearer</span></div><div class="line"><a name="l02697"></a><span class="lineno"> 2697</span>&#160;                        <span class="keywordflow">if</span></div><div class="line"><a name="l02698"></a><span class="lineno"> 2698</span>&#160;                        (</div><div class="line"><a name="l02699"></a><span class="lineno"> 2699</span>&#160;                            <a class="code" href="a10733.html#ae6fff2c6981e6d9618aa5038e69def6e">magSqr</a>(attraction)</div><div class="line"><a name="l02700"></a><span class="lineno"> 2700</span>&#160;                          &lt; <a class="code" href="a10733.html#ae6fff2c6981e6d9618aa5038e69def6e">magSqr</a>(patchAttraction[pointI])</div><div class="line"><a name="l02701"></a><span class="lineno"> 2701</span>&#160;                        )</div><div class="line"><a name="l02702"></a><span class="lineno"> 2702</span>&#160;                        {</div><div class="line"><a name="l02703"></a><span class="lineno"> 2703</span>&#160;                            patchAttraction[pointI] = attraction;</div><div class="line"><a name="l02704"></a><span class="lineno"> 2704</span>&#160;                            patchConstraints[pointI] =</div><div class="line"><a name="l02705"></a><span class="lineno"> 2705</span>&#160;                                pointConstr[featPointI];</div><div class="line"><a name="l02706"></a><span class="lineno"> 2706</span>&#160;                        }</div><div class="line"><a name="l02707"></a><span class="lineno"> 2707</span>&#160;                    }</div><div class="line"><a name="l02708"></a><span class="lineno"> 2708</span>&#160;                }</div><div class="line"><a name="l02709"></a><span class="lineno"> 2709</span>&#160;            }</div><div class="line"><a name="l02710"></a><span class="lineno"> 2710</span>&#160;        }</div><div class="line"><a name="l02711"></a><span class="lineno"> 2711</span>&#160;    }</div><div class="line"><a name="l02712"></a><span class="lineno"> 2712</span>&#160;}</div><div class="line"><a name="l02713"></a><span class="lineno"> 2713</span>&#160;</div><div class="line"><a name="l02714"></a><span class="lineno"> 2714</span>&#160;</div><div class="line"><a name="l02715"></a><span class="lineno"> 2715</span>&#160;<span class="keywordtype">void</span> Foam::autoSnapDriver::featureAttractionUsingFeatureEdges</div><div class="line"><a name="l02716"></a><span class="lineno"> 2716</span>&#160;(</div><div class="line"><a name="l02717"></a><span class="lineno"> 2717</span>&#160;    <span class="keyword">const</span> <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> iter,</div><div class="line"><a name="l02718"></a><span class="lineno"> 2718</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> avoidSnapProblems,</div><div class="line"><a name="l02719"></a><span class="lineno"> 2719</span>&#160;    <span class="keyword">const</span> scalar featureCos,</div><div class="line"><a name="l02720"></a><span class="lineno"> 2720</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> multiRegionFeatureSnap,</div><div class="line"><a name="l02721"></a><span class="lineno"> 2721</span>&#160;</div><div class="line"><a name="l02722"></a><span class="lineno"> 2722</span>&#160;    <span class="keyword">const</span> <a class="code" href="a01972.html">indirectPrimitivePatch</a>&amp; pp,</div><div class="line"><a name="l02723"></a><span class="lineno"> 2723</span>&#160;    <span class="keyword">const</span> <a class="code" href="a00754.html">scalarField</a>&amp; snapDist,</div><div class="line"><a name="l02724"></a><span class="lineno"> 2724</span>&#160;    <span class="keyword">const</span> <a class="code" href="a00754.html">vectorField</a>&amp; nearestDisp,</div><div class="line"><a name="l02725"></a><span class="lineno"> 2725</span>&#160;</div><div class="line"><a name="l02726"></a><span class="lineno"> 2726</span>&#160;    <span class="keyword">const</span> <a class="code" href="a01364.html">List</a>&lt;<a class="code" href="a01364.html">List&lt;point&gt;</a>&gt;&amp; pointFaceSurfNormals,</div><div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160;    <span class="keyword">const</span> <a class="code" href="a01364.html">List</a>&lt;<a class="code" href="a01364.html">List&lt;point&gt;</a>&gt;&amp; pointFaceDisp,</div><div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160;    <span class="keyword">const</span> <a class="code" href="a01364.html">List</a>&lt;<a class="code" href="a01364.html">List&lt;point&gt;</a>&gt;&amp; pointFaceCentres,</div><div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>&#160;    <span class="keyword">const</span> <a class="code" href="a01364.html">labelListList</a>&amp; pointFacePatchID,</div><div class="line"><a name="l02730"></a><span class="lineno"> 2730</span>&#160;</div><div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>&#160;    <a class="code" href="a00754.html">vectorField</a>&amp; patchAttraction,</div><div class="line"><a name="l02732"></a><span class="lineno"> 2732</span>&#160;    <a class="code" href="a01364.html">List&lt;pointConstraint&gt;</a>&amp; patchConstraints</div><div class="line"><a name="l02733"></a><span class="lineno"> 2733</span>&#160;)<span class="keyword"> const</span></div><div class="line"><a name="l02734"></a><span class="lineno"> 2734</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l02735"></a><span class="lineno"> 2735</span>&#160;    <span class="keyword">const</span> <a class="code" href="a02113.html">refinementFeatures</a>&amp; features = meshRefiner_.features();</div><div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;</div><div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160;    <span class="comment">// Collect ordered attractions on feature edges</span></div><div class="line"><a name="l02738"></a><span class="lineno"> 2738</span>&#160;    <span class="comment">// ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></div><div class="line"><a name="l02739"></a><span class="lineno"> 2739</span>&#160;</div><div class="line"><a name="l02740"></a><span class="lineno"> 2740</span>&#160;    <span class="comment">// Per feature, per feature-edge a list of attraction points and their</span></div><div class="line"><a name="l02741"></a><span class="lineno"> 2741</span>&#160;    <span class="comment">// originating vertex.</span></div><div class="line"><a name="l02742"></a><span class="lineno"> 2742</span>&#160;    <a class="code" href="a01364.html">List&lt;List&lt;DynamicList&lt;point&gt;</a>&gt;&gt; edgeAttractors(features.<a class="code" href="a02033.html#a723361dc2020160f5492e8fe2d09fa44">size</a>());</div><div class="line"><a name="l02743"></a><span class="lineno"> 2743</span>&#160;    <a class="code" href="a01364.html">List&lt;List&lt;DynamicList&lt;pointConstraint&gt;</a>&gt;&gt; edgeConstraints</div><div class="line"><a name="l02744"></a><span class="lineno"> 2744</span>&#160;    (</div><div class="line"><a name="l02745"></a><span class="lineno"> 2745</span>&#160;        features.<a class="code" href="a02033.html#a723361dc2020160f5492e8fe2d09fa44">size</a>()</div><div class="line"><a name="l02746"></a><span class="lineno"> 2746</span>&#160;    );</div><div class="line"><a name="l02747"></a><span class="lineno"> 2747</span>&#160;    <a class="code" href="a07669.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(features, featI)</div><div class="line"><a name="l02748"></a><span class="lineno"> 2748</span>&#160;    {</div><div class="line"><a name="l02749"></a><span class="lineno"> 2749</span>&#160;        <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> nFeatEdges = features[featI].edges().<a class="code" href="a02033.html#a723361dc2020160f5492e8fe2d09fa44">size</a>();</div><div class="line"><a name="l02750"></a><span class="lineno"> 2750</span>&#160;        edgeAttractors[featI].setSize(nFeatEdges);</div><div class="line"><a name="l02751"></a><span class="lineno"> 2751</span>&#160;        edgeConstraints[featI].setSize(nFeatEdges);</div><div class="line"><a name="l02752"></a><span class="lineno"> 2752</span>&#160;    }</div><div class="line"><a name="l02753"></a><span class="lineno"> 2753</span>&#160;</div><div class="line"><a name="l02754"></a><span class="lineno"> 2754</span>&#160;    <span class="comment">// Per feature, per feature-point the pp point that is attracted to it.</span></div><div class="line"><a name="l02755"></a><span class="lineno"> 2755</span>&#160;    <span class="comment">// This list is only used to subset the feature-points that are actually</span></div><div class="line"><a name="l02756"></a><span class="lineno"> 2756</span>&#160;    <span class="comment">// used.</span></div><div class="line"><a name="l02757"></a><span class="lineno"> 2757</span>&#160;    <a class="code" href="a01364.html">List&lt;labelList&gt;</a> pointAttractor(features.<a class="code" href="a02033.html#a723361dc2020160f5492e8fe2d09fa44">size</a>());</div><div class="line"><a name="l02758"></a><span class="lineno"> 2758</span>&#160;    <a class="code" href="a01364.html">List&lt;List&lt;pointConstraint&gt;</a>&gt; <a class="code" href="a01872.html">pointConstraints</a>(features.<a class="code" href="a02033.html#a723361dc2020160f5492e8fe2d09fa44">size</a>());</div><div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160;    <a class="code" href="a07669.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(features, featI)</div><div class="line"><a name="l02760"></a><span class="lineno"> 2760</span>&#160;    {</div><div class="line"><a name="l02761"></a><span class="lineno"> 2761</span>&#160;        <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> nFeatPoints = features[featI].points().<a class="code" href="a02033.html#a723361dc2020160f5492e8fe2d09fa44">size</a>();</div><div class="line"><a name="l02762"></a><span class="lineno"> 2762</span>&#160;        pointAttractor[featI].<a class="code" href="a01364.html#aedb985ffeaf1bdbfeccc2a8730405703">setSize</a>(nFeatPoints, -1);</div><div class="line"><a name="l02763"></a><span class="lineno"> 2763</span>&#160;        <a class="code" href="a01872.html">pointConstraints</a>[featI].setSize(nFeatPoints);</div><div class="line"><a name="l02764"></a><span class="lineno"> 2764</span>&#160;    }</div><div class="line"><a name="l02765"></a><span class="lineno"> 2765</span>&#160;</div><div class="line"><a name="l02766"></a><span class="lineno"> 2766</span>&#160;    <span class="comment">// Reverse: from pp point to nearest feature</span></div><div class="line"><a name="l02767"></a><span class="lineno"> 2767</span>&#160;    <a class="code" href="a00754.html">vectorField</a> rawPatchAttraction(pp.<a class="code" href="a01972.html#a9927abeba2c8506177084d644b6e573a">nPoints</a>(), <a class="code" href="a02791.html#ac3b79445511a1e3a6443b59ac93c394a">vector::zero</a>);</div><div class="line"><a name="l02768"></a><span class="lineno"> 2768</span>&#160;    <a class="code" href="a01364.html">List&lt;pointConstraint&gt;</a> rawPatchConstraints(pp.<a class="code" href="a01972.html#a9927abeba2c8506177084d644b6e573a">nPoints</a>());</div><div class="line"><a name="l02769"></a><span class="lineno"> 2769</span>&#160;</div><div class="line"><a name="l02770"></a><span class="lineno"> 2770</span>&#160;    determineFeatures</div><div class="line"><a name="l02771"></a><span class="lineno"> 2771</span>&#160;    (</div><div class="line"><a name="l02772"></a><span class="lineno"> 2772</span>&#160;        iter,</div><div class="line"><a name="l02773"></a><span class="lineno"> 2773</span>&#160;        featureCos,</div><div class="line"><a name="l02774"></a><span class="lineno"> 2774</span>&#160;        multiRegionFeatureSnap,</div><div class="line"><a name="l02775"></a><span class="lineno"> 2775</span>&#160;</div><div class="line"><a name="l02776"></a><span class="lineno"> 2776</span>&#160;        pp,</div><div class="line"><a name="l02777"></a><span class="lineno"> 2777</span>&#160;        snapDist,               <span class="comment">// per point max distance and nearest surface</span></div><div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160;        nearestDisp,</div><div class="line"><a name="l02779"></a><span class="lineno"> 2779</span>&#160;</div><div class="line"><a name="l02780"></a><span class="lineno"> 2780</span>&#160;        pointFaceSurfNormals,   <span class="comment">// per face nearest surface</span></div><div class="line"><a name="l02781"></a><span class="lineno"> 2781</span>&#160;        pointFaceDisp,</div><div class="line"><a name="l02782"></a><span class="lineno"> 2782</span>&#160;        pointFaceCentres,</div><div class="line"><a name="l02783"></a><span class="lineno"> 2783</span>&#160;        pointFacePatchID,</div><div class="line"><a name="l02784"></a><span class="lineno"> 2784</span>&#160;</div><div class="line"><a name="l02785"></a><span class="lineno"> 2785</span>&#160;        <span class="comment">// Feature-point to pp point</span></div><div class="line"><a name="l02786"></a><span class="lineno"> 2786</span>&#160;        pointAttractor,</div><div class="line"><a name="l02787"></a><span class="lineno"> 2787</span>&#160;        <a class="code" href="a01872.html">pointConstraints</a>,</div><div class="line"><a name="l02788"></a><span class="lineno"> 2788</span>&#160;        <span class="comment">// Feature-edge to pp point</span></div><div class="line"><a name="l02789"></a><span class="lineno"> 2789</span>&#160;        edgeAttractors,</div><div class="line"><a name="l02790"></a><span class="lineno"> 2790</span>&#160;        edgeConstraints,</div><div class="line"><a name="l02791"></a><span class="lineno"> 2791</span>&#160;        <span class="comment">// pp point to nearest feature</span></div><div class="line"><a name="l02792"></a><span class="lineno"> 2792</span>&#160;        rawPatchAttraction,</div><div class="line"><a name="l02793"></a><span class="lineno"> 2793</span>&#160;        rawPatchConstraints</div><div class="line"><a name="l02794"></a><span class="lineno"> 2794</span>&#160;    );</div><div class="line"><a name="l02795"></a><span class="lineno"> 2795</span>&#160;</div><div class="line"><a name="l02796"></a><span class="lineno"> 2796</span>&#160;</div><div class="line"><a name="l02797"></a><span class="lineno"> 2797</span>&#160;</div><div class="line"><a name="l02798"></a><span class="lineno"> 2798</span>&#160;    <span class="comment">// Baffle handling</span></div><div class="line"><a name="l02799"></a><span class="lineno"> 2799</span>&#160;    <span class="comment">// ~~~~~~~~~~~~~~~</span></div><div class="line"><a name="l02800"></a><span class="lineno"> 2800</span>&#160;    <span class="comment">// Override pointAttractor, edgeAttractor, rawPatchAttration etc. to</span></div><div class="line"><a name="l02801"></a><span class="lineno"> 2801</span>&#160;    <span class="comment">// implement &#39;baffle&#39; handling.</span></div><div class="line"><a name="l02802"></a><span class="lineno"> 2802</span>&#160;    <span class="comment">// Baffle: the mesh pp point originates from a loose standing</span></div><div class="line"><a name="l02803"></a><span class="lineno"> 2803</span>&#160;    <span class="comment">// baffle.</span></div><div class="line"><a name="l02804"></a><span class="lineno"> 2804</span>&#160;    <span class="comment">// Sampling the surface with the surrounding face-centres only picks up</span></div><div class="line"><a name="l02805"></a><span class="lineno"> 2805</span>&#160;    <span class="comment">// a single triangle normal so above determineFeatures will not have</span></div><div class="line"><a name="l02806"></a><span class="lineno"> 2806</span>&#160;    <span class="comment">// detected anything. So explicitly pick up feature edges on the pp</span></div><div class="line"><a name="l02807"></a><span class="lineno"> 2807</span>&#160;    <span class="comment">// (after duplicating points &amp; smoothing so will already have been</span></div><div class="line"><a name="l02808"></a><span class="lineno"> 2808</span>&#160;    <span class="comment">// expanded) and match these to the features.</span></div><div class="line"><a name="l02809"></a><span class="lineno"> 2809</span>&#160;    determineBaffleFeatures</div><div class="line"><a name="l02810"></a><span class="lineno"> 2810</span>&#160;    (</div><div class="line"><a name="l02811"></a><span class="lineno"> 2811</span>&#160;        iter,</div><div class="line"><a name="l02812"></a><span class="lineno"> 2812</span>&#160;        featureCos,</div><div class="line"><a name="l02813"></a><span class="lineno"> 2813</span>&#160;</div><div class="line"><a name="l02814"></a><span class="lineno"> 2814</span>&#160;        pp,</div><div class="line"><a name="l02815"></a><span class="lineno"> 2815</span>&#160;        snapDist,</div><div class="line"><a name="l02816"></a><span class="lineno"> 2816</span>&#160;</div><div class="line"><a name="l02817"></a><span class="lineno"> 2817</span>&#160;        <span class="comment">// Feature-point to pp point</span></div><div class="line"><a name="l02818"></a><span class="lineno"> 2818</span>&#160;        pointAttractor,</div><div class="line"><a name="l02819"></a><span class="lineno"> 2819</span>&#160;        <a class="code" href="a01872.html">pointConstraints</a>,</div><div class="line"><a name="l02820"></a><span class="lineno"> 2820</span>&#160;        <span class="comment">// Feature-edge to pp point</span></div><div class="line"><a name="l02821"></a><span class="lineno"> 2821</span>&#160;        edgeAttractors,</div><div class="line"><a name="l02822"></a><span class="lineno"> 2822</span>&#160;        edgeConstraints,</div><div class="line"><a name="l02823"></a><span class="lineno"> 2823</span>&#160;        <span class="comment">// pp point to nearest feature</span></div><div class="line"><a name="l02824"></a><span class="lineno"> 2824</span>&#160;        rawPatchAttraction,</div><div class="line"><a name="l02825"></a><span class="lineno"> 2825</span>&#160;        rawPatchConstraints</div><div class="line"><a name="l02826"></a><span class="lineno"> 2826</span>&#160;    );</div><div class="line"><a name="l02827"></a><span class="lineno"> 2827</span>&#160;</div><div class="line"><a name="l02828"></a><span class="lineno"> 2828</span>&#160;</div><div class="line"><a name="l02829"></a><span class="lineno"> 2829</span>&#160;</div><div class="line"><a name="l02830"></a><span class="lineno"> 2830</span>&#160;    <span class="comment">// Reverse lookup: Find nearest mesh point to feature edge</span></div><div class="line"><a name="l02831"></a><span class="lineno"> 2831</span>&#160;    <span class="comment">// ~~~~~~~~~~~~~~~~----------------~~~~~~~~~~~~~~~~~~~~~~~</span></div><div class="line"><a name="l02832"></a><span class="lineno"> 2832</span>&#160;    <span class="comment">// go through all edgeAttractors and find the nearest point on pp</span></div><div class="line"><a name="l02833"></a><span class="lineno"> 2833</span>&#160;</div><div class="line"><a name="l02834"></a><span class="lineno"> 2834</span>&#160;    reverseAttractMeshPoints</div><div class="line"><a name="l02835"></a><span class="lineno"> 2835</span>&#160;    (</div><div class="line"><a name="l02836"></a><span class="lineno"> 2836</span>&#160;        iter,</div><div class="line"><a name="l02837"></a><span class="lineno"> 2837</span>&#160;</div><div class="line"><a name="l02838"></a><span class="lineno"> 2838</span>&#160;        pp,</div><div class="line"><a name="l02839"></a><span class="lineno"> 2839</span>&#160;        snapDist,</div><div class="line"><a name="l02840"></a><span class="lineno"> 2840</span>&#160;</div><div class="line"><a name="l02841"></a><span class="lineno"> 2841</span>&#160;        <span class="comment">// Feature-point to pp point</span></div><div class="line"><a name="l02842"></a><span class="lineno"> 2842</span>&#160;        pointAttractor,</div><div class="line"><a name="l02843"></a><span class="lineno"> 2843</span>&#160;        <a class="code" href="a01872.html">pointConstraints</a>,</div><div class="line"><a name="l02844"></a><span class="lineno"> 2844</span>&#160;        <span class="comment">// Feature-edge to pp point</span></div><div class="line"><a name="l02845"></a><span class="lineno"> 2845</span>&#160;        edgeAttractors,</div><div class="line"><a name="l02846"></a><span class="lineno"> 2846</span>&#160;        edgeConstraints,</div><div class="line"><a name="l02847"></a><span class="lineno"> 2847</span>&#160;</div><div class="line"><a name="l02848"></a><span class="lineno"> 2848</span>&#160;        <span class="comment">// Estimated feature point</span></div><div class="line"><a name="l02849"></a><span class="lineno"> 2849</span>&#160;        rawPatchAttraction,</div><div class="line"><a name="l02850"></a><span class="lineno"> 2850</span>&#160;        rawPatchConstraints,</div><div class="line"><a name="l02851"></a><span class="lineno"> 2851</span>&#160;</div><div class="line"><a name="l02852"></a><span class="lineno"> 2852</span>&#160;        <span class="comment">// pp point to nearest feature</span></div><div class="line"><a name="l02853"></a><span class="lineno"> 2853</span>&#160;        patchAttraction,</div><div class="line"><a name="l02854"></a><span class="lineno"> 2854</span>&#160;        patchConstraints</div><div class="line"><a name="l02855"></a><span class="lineno"> 2855</span>&#160;    );</div><div class="line"><a name="l02856"></a><span class="lineno"> 2856</span>&#160;</div><div class="line"><a name="l02857"></a><span class="lineno"> 2857</span>&#160;</div><div class="line"><a name="l02858"></a><span class="lineno"> 2858</span>&#160;    <span class="comment">// Dump</span></div><div class="line"><a name="l02859"></a><span class="lineno"> 2859</span>&#160;    <span class="keywordflow">if</span> (debug&amp;<a class="code" href="a01470.html#a92dc814ea7fd34acae287945426740d3a42750666a219d68f9028ca726fe4fa71">meshRefinement::ATTRACTION</a>)</div><div class="line"><a name="l02860"></a><span class="lineno"> 2860</span>&#160;    {</div><div class="line"><a name="l02861"></a><span class="lineno"> 2861</span>&#160;        <a class="code" href="a01692.html">OBJstream</a> featureEdgeStr</div><div class="line"><a name="l02862"></a><span class="lineno"> 2862</span>&#160;        (</div><div class="line"><a name="l02863"></a><span class="lineno"> 2863</span>&#160;            meshRefiner_.mesh().time().path()</div><div class="line"><a name="l02864"></a><span class="lineno"> 2864</span>&#160;          / <span class="stringliteral">&quot;edgeAttractors_&quot;</span> + <a class="code" href="a10733.html#adcb0df2bd4953cb6bb390272d8263c3a">name</a>(iter) + <span class="stringliteral">&quot;.obj&quot;</span></div><div class="line"><a name="l02865"></a><span class="lineno"> 2865</span>&#160;        );</div><div class="line"><a name="l02866"></a><span class="lineno"> 2866</span>&#160;        <a class="code" href="a10733.html#a501e80d1e14c94973e82f1555e7eb711">Info</a>&lt;&lt; <span class="stringliteral">&quot;Dumping feature-edge attraction to &quot;</span></div><div class="line"><a name="l02867"></a><span class="lineno"> 2867</span>&#160;            &lt;&lt; featureEdgeStr.name() &lt;&lt; <a class="code" href="a10733.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div><div class="line"><a name="l02868"></a><span class="lineno"> 2868</span>&#160;</div><div class="line"><a name="l02869"></a><span class="lineno"> 2869</span>&#160;        <a class="code" href="a01692.html">OBJstream</a> featurePointStr</div><div class="line"><a name="l02870"></a><span class="lineno"> 2870</span>&#160;        (</div><div class="line"><a name="l02871"></a><span class="lineno"> 2871</span>&#160;            meshRefiner_.mesh().time().path()</div><div class="line"><a name="l02872"></a><span class="lineno"> 2872</span>&#160;          / <span class="stringliteral">&quot;pointAttractors_&quot;</span> + <a class="code" href="a10733.html#adcb0df2bd4953cb6bb390272d8263c3a">name</a>(iter) + <span class="stringliteral">&quot;.obj&quot;</span></div><div class="line"><a name="l02873"></a><span class="lineno"> 2873</span>&#160;        );</div><div class="line"><a name="l02874"></a><span class="lineno"> 2874</span>&#160;        <a class="code" href="a10733.html#a501e80d1e14c94973e82f1555e7eb711">Info</a>&lt;&lt; <span class="stringliteral">&quot;Dumping feature-point attraction to &quot;</span></div><div class="line"><a name="l02875"></a><span class="lineno"> 2875</span>&#160;            &lt;&lt; featurePointStr.name() &lt;&lt; <a class="code" href="a10733.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div><div class="line"><a name="l02876"></a><span class="lineno"> 2876</span>&#160;</div><div class="line"><a name="l02877"></a><span class="lineno"> 2877</span>&#160;        <a class="code" href="a07669.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(patchConstraints, pointI)</div><div class="line"><a name="l02878"></a><span class="lineno"> 2878</span>&#160;        {</div><div class="line"><a name="l02879"></a><span class="lineno"> 2879</span>&#160;            <span class="keyword">const</span> <a class="code" href="a02791.html">point</a>&amp; pt = pp.<a class="code" href="a01972.html#a180aa335ba66b3224df33de8eb29b3bf">localPoints</a>()[pointI];</div><div class="line"><a name="l02880"></a><span class="lineno"> 2880</span>&#160;            <span class="keyword">const</span> <a class="code" href="a02791.html">vector</a>&amp; attr = patchAttraction[pointI];</div><div class="line"><a name="l02881"></a><span class="lineno"> 2881</span>&#160;</div><div class="line"><a name="l02882"></a><span class="lineno"> 2882</span>&#160;            <span class="keywordflow">if</span> (patchConstraints[pointI].first() == 2)</div><div class="line"><a name="l02883"></a><span class="lineno"> 2883</span>&#160;            {</div><div class="line"><a name="l02884"></a><span class="lineno"> 2884</span>&#160;                featureEdgeStr.write(<a class="code" href="a10733.html#a2e0318a3a140a9ee64174b45fbfd45f0">linePointRef</a>(pt, pt+attr));</div><div class="line"><a name="l02885"></a><span class="lineno"> 2885</span>&#160;            }</div><div class="line"><a name="l02886"></a><span class="lineno"> 2886</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (patchConstraints[pointI].first() == 3)</div><div class="line"><a name="l02887"></a><span class="lineno"> 2887</span>&#160;            {</div><div class="line"><a name="l02888"></a><span class="lineno"> 2888</span>&#160;                featurePointStr.write(<a class="code" href="a10733.html#a2e0318a3a140a9ee64174b45fbfd45f0">linePointRef</a>(pt, pt+attr));</div><div class="line"><a name="l02889"></a><span class="lineno"> 2889</span>&#160;            }</div><div class="line"><a name="l02890"></a><span class="lineno"> 2890</span>&#160;        }</div><div class="line"><a name="l02891"></a><span class="lineno"> 2891</span>&#160;    }</div><div class="line"><a name="l02892"></a><span class="lineno"> 2892</span>&#160;</div><div class="line"><a name="l02893"></a><span class="lineno"> 2893</span>&#160;</div><div class="line"><a name="l02894"></a><span class="lineno"> 2894</span>&#160;    <span class="keywordflow">if</span> (avoidSnapProblems)</div><div class="line"><a name="l02895"></a><span class="lineno"> 2895</span>&#160;    {</div><div class="line"><a name="l02896"></a><span class="lineno"> 2896</span>&#160;        <span class="comment">//MEJ: any faces that have multi-patch points only keep the multi-patch</span></div><div class="line"><a name="l02897"></a><span class="lineno"> 2897</span>&#160;        <span class="comment">//     points. The other points on the face will be dragged along</span></div><div class="line"><a name="l02898"></a><span class="lineno"> 2898</span>&#160;        <span class="comment">//     (hopefully)</span></div><div class="line"><a name="l02899"></a><span class="lineno"> 2899</span>&#160;        <span class="keywordflow">if</span> (multiRegionFeatureSnap)</div><div class="line"><a name="l02900"></a><span class="lineno"> 2900</span>&#160;        {</div><div class="line"><a name="l02901"></a><span class="lineno"> 2901</span>&#160;            releasePointsNextToMultiPatch</div><div class="line"><a name="l02902"></a><span class="lineno"> 2902</span>&#160;            (</div><div class="line"><a name="l02903"></a><span class="lineno"> 2903</span>&#160;                iter,</div><div class="line"><a name="l02904"></a><span class="lineno"> 2904</span>&#160;                featureCos,</div><div class="line"><a name="l02905"></a><span class="lineno"> 2905</span>&#160;</div><div class="line"><a name="l02906"></a><span class="lineno"> 2906</span>&#160;                pp,</div><div class="line"><a name="l02907"></a><span class="lineno"> 2907</span>&#160;                snapDist,</div><div class="line"><a name="l02908"></a><span class="lineno"> 2908</span>&#160;</div><div class="line"><a name="l02909"></a><span class="lineno"> 2909</span>&#160;                pointFaceCentres,</div><div class="line"><a name="l02910"></a><span class="lineno"> 2910</span>&#160;                pointFacePatchID,</div><div class="line"><a name="l02911"></a><span class="lineno"> 2911</span>&#160;</div><div class="line"><a name="l02912"></a><span class="lineno"> 2912</span>&#160;                rawPatchAttraction,</div><div class="line"><a name="l02913"></a><span class="lineno"> 2913</span>&#160;                rawPatchConstraints,</div><div class="line"><a name="l02914"></a><span class="lineno"> 2914</span>&#160;</div><div class="line"><a name="l02915"></a><span class="lineno"> 2915</span>&#160;                patchAttraction,</div><div class="line"><a name="l02916"></a><span class="lineno"> 2916</span>&#160;                patchConstraints</div><div class="line"><a name="l02917"></a><span class="lineno"> 2917</span>&#160;            );</div><div class="line"><a name="l02918"></a><span class="lineno"> 2918</span>&#160;        }</div><div class="line"><a name="l02919"></a><span class="lineno"> 2919</span>&#160;</div><div class="line"><a name="l02920"></a><span class="lineno"> 2920</span>&#160;</div><div class="line"><a name="l02921"></a><span class="lineno"> 2921</span>&#160;        <span class="comment">// Snap edges to feature edges</span></div><div class="line"><a name="l02922"></a><span class="lineno"> 2922</span>&#160;        <span class="comment">// ~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></div><div class="line"><a name="l02923"></a><span class="lineno"> 2923</span>&#160;        <span class="comment">// Walk existing edges and snap remaining ones (that are marked as</span></div><div class="line"><a name="l02924"></a><span class="lineno"> 2924</span>&#160;        <span class="comment">// feature edges in rawPatchConstraints)</span></div><div class="line"><a name="l02925"></a><span class="lineno"> 2925</span>&#160;</div><div class="line"><a name="l02926"></a><span class="lineno"> 2926</span>&#160;        stringFeatureEdges</div><div class="line"><a name="l02927"></a><span class="lineno"> 2927</span>&#160;        (</div><div class="line"><a name="l02928"></a><span class="lineno"> 2928</span>&#160;            iter,</div><div class="line"><a name="l02929"></a><span class="lineno"> 2929</span>&#160;            featureCos,</div><div class="line"><a name="l02930"></a><span class="lineno"> 2930</span>&#160;</div><div class="line"><a name="l02931"></a><span class="lineno"> 2931</span>&#160;            pp,</div><div class="line"><a name="l02932"></a><span class="lineno"> 2932</span>&#160;            snapDist,</div><div class="line"><a name="l02933"></a><span class="lineno"> 2933</span>&#160;</div><div class="line"><a name="l02934"></a><span class="lineno"> 2934</span>&#160;            rawPatchAttraction,</div><div class="line"><a name="l02935"></a><span class="lineno"> 2935</span>&#160;            rawPatchConstraints,</div><div class="line"><a name="l02936"></a><span class="lineno"> 2936</span>&#160;</div><div class="line"><a name="l02937"></a><span class="lineno"> 2937</span>&#160;            patchAttraction,</div><div class="line"><a name="l02938"></a><span class="lineno"> 2938</span>&#160;            patchConstraints</div><div class="line"><a name="l02939"></a><span class="lineno"> 2939</span>&#160;        );</div><div class="line"><a name="l02940"></a><span class="lineno"> 2940</span>&#160;</div><div class="line"><a name="l02941"></a><span class="lineno"> 2941</span>&#160;</div><div class="line"><a name="l02942"></a><span class="lineno"> 2942</span>&#160;        <span class="comment">// Avoid diagonal attraction</span></div><div class="line"><a name="l02943"></a><span class="lineno"> 2943</span>&#160;        <span class="comment">// ~~~~~~~~~~~~~~~~~~~~~~~~~</span></div><div class="line"><a name="l02944"></a><span class="lineno"> 2944</span>&#160;        <span class="comment">// Attract one of the non-diagonal points.</span></div><div class="line"><a name="l02945"></a><span class="lineno"> 2945</span>&#160;</div><div class="line"><a name="l02946"></a><span class="lineno"> 2946</span>&#160;        avoidDiagonalAttraction</div><div class="line"><a name="l02947"></a><span class="lineno"> 2947</span>&#160;        (</div><div class="line"><a name="l02948"></a><span class="lineno"> 2948</span>&#160;            iter,</div><div class="line"><a name="l02949"></a><span class="lineno"> 2949</span>&#160;            featureCos,</div><div class="line"><a name="l02950"></a><span class="lineno"> 2950</span>&#160;            pp,</div><div class="line"><a name="l02951"></a><span class="lineno"> 2951</span>&#160;            patchAttraction,</div><div class="line"><a name="l02952"></a><span class="lineno"> 2952</span>&#160;            patchConstraints</div><div class="line"><a name="l02953"></a><span class="lineno"> 2953</span>&#160;        );</div><div class="line"><a name="l02954"></a><span class="lineno"> 2954</span>&#160;    }</div><div class="line"><a name="l02955"></a><span class="lineno"> 2955</span>&#160;</div><div class="line"><a name="l02956"></a><span class="lineno"> 2956</span>&#160;    <span class="keywordflow">if</span> (debug&amp;meshRefinement::ATTRACTION)</div><div class="line"><a name="l02957"></a><span class="lineno"> 2957</span>&#160;    {</div><div class="line"><a name="l02958"></a><span class="lineno"> 2958</span>&#160;        dumpMove</div><div class="line"><a name="l02959"></a><span class="lineno"> 2959</span>&#160;        (</div><div class="line"><a name="l02960"></a><span class="lineno"> 2960</span>&#160;            meshRefiner_.mesh().time().path()</div><div class="line"><a name="l02961"></a><span class="lineno"> 2961</span>&#160;          / <span class="stringliteral">&quot;patchAttraction_&quot;</span> + <a class="code" href="a10733.html#adcb0df2bd4953cb6bb390272d8263c3a">name</a>(iter) + <span class="stringliteral">&quot;.obj&quot;</span>,</div><div class="line"><a name="l02962"></a><span class="lineno"> 2962</span>&#160;            pp.<a class="code" href="a01972.html#a180aa335ba66b3224df33de8eb29b3bf">localPoints</a>(),</div><div class="line"><a name="l02963"></a><span class="lineno"> 2963</span>&#160;            pp.<a class="code" href="a01972.html#a180aa335ba66b3224df33de8eb29b3bf">localPoints</a>() + patchAttraction</div><div class="line"><a name="l02964"></a><span class="lineno"> 2964</span>&#160;        );</div><div class="line"><a name="l02965"></a><span class="lineno"> 2965</span>&#160;    }</div><div class="line"><a name="l02966"></a><span class="lineno"> 2966</span>&#160;}</div><div class="line"><a name="l02967"></a><span class="lineno"> 2967</span>&#160;</div><div class="line"><a name="l02968"></a><span class="lineno"> 2968</span>&#160;</div><div class="line"><a name="l02969"></a><span class="lineno"> 2969</span>&#160;<span class="comment">// Correct for squeezing of face</span></div><div class="line"><a name="l02970"></a><span class="lineno"> 2970</span>&#160;<span class="keywordtype">void</span> Foam::autoSnapDriver::preventFaceSqueeze</div><div class="line"><a name="l02971"></a><span class="lineno"> 2971</span>&#160;(</div><div class="line"><a name="l02972"></a><span class="lineno"> 2972</span>&#160;    <span class="keyword">const</span> <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> iter,</div><div class="line"><a name="l02973"></a><span class="lineno"> 2973</span>&#160;    <span class="keyword">const</span> scalar featureCos,</div><div class="line"><a name="l02974"></a><span class="lineno"> 2974</span>&#160;</div><div class="line"><a name="l02975"></a><span class="lineno"> 2975</span>&#160;    <span class="keyword">const</span> <a class="code" href="a01972.html">indirectPrimitivePatch</a>&amp; pp,</div><div class="line"><a name="l02976"></a><span class="lineno"> 2976</span>&#160;    <span class="keyword">const</span> <a class="code" href="a00754.html">scalarField</a>&amp; snapDist,</div><div class="line"><a name="l02977"></a><span class="lineno"> 2977</span>&#160;</div><div class="line"><a name="l02978"></a><span class="lineno"> 2978</span>&#160;    <a class="code" href="a00754.html">vectorField</a>&amp; patchAttraction,</div><div class="line"><a name="l02979"></a><span class="lineno"> 2979</span>&#160;    <a class="code" href="a01364.html">List&lt;pointConstraint&gt;</a>&amp; patchConstraints</div><div class="line"><a name="l02980"></a><span class="lineno"> 2980</span>&#160;)<span class="keyword"> const</span></div><div class="line"><a name="l02981"></a><span class="lineno"> 2981</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l02982"></a><span class="lineno"> 2982</span>&#160;    <a class="code" href="a00754.html">pointField</a> <a class="code" href="a04278.html#a1adbc4c519b2cee284a47d6682036276">points</a>;</div><div class="line"><a name="l02983"></a><span class="lineno"> 2983</span>&#160;    <a class="code" href="a00714.html">face</a> singleF;</div><div class="line"><a name="l02984"></a><span class="lineno"> 2984</span>&#160;    <a class="code" href="a07669.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(pp.<a class="code" href="a01972.html#af5aca3ce69275c80366bc8d5c0584da2">localFaces</a>(), faceI)</div><div class="line"><a name="l02985"></a><span class="lineno"> 2985</span>&#160;    {</div><div class="line"><a name="l02986"></a><span class="lineno"> 2986</span>&#160;        <span class="keyword">const</span> <a class="code" href="a00714.html">face</a>&amp; <a class="code" href="a03926.html#a888be93833ac7a23170555c69c690288">f</a> = pp.<a class="code" href="a01972.html#af5aca3ce69275c80366bc8d5c0584da2">localFaces</a>()[faceI];</div><div class="line"><a name="l02987"></a><span class="lineno"> 2987</span>&#160;</div><div class="line"><a name="l02988"></a><span class="lineno"> 2988</span>&#160;        <span class="keywordflow">if</span> (f.<a class="code" href="a01364.html#a8a5f6fa29bd4b500caf186f60245b384">size</a>() != points.<a class="code" href="a01364.html#a8a5f6fa29bd4b500caf186f60245b384">size</a>())</div><div class="line"><a name="l02989"></a><span class="lineno"> 2989</span>&#160;        {</div><div class="line"><a name="l02990"></a><span class="lineno"> 2990</span>&#160;            points.<a class="code" href="a01364.html#aedb985ffeaf1bdbfeccc2a8730405703">setSize</a>(f.<a class="code" href="a01364.html#a8a5f6fa29bd4b500caf186f60245b384">size</a>());</div><div class="line"><a name="l02991"></a><span class="lineno"> 2991</span>&#160;            singleF.<a class="code" href="a01364.html#aedb985ffeaf1bdbfeccc2a8730405703">setSize</a>(f.<a class="code" href="a01364.html#a8a5f6fa29bd4b500caf186f60245b384">size</a>());</div><div class="line"><a name="l02992"></a><span class="lineno"> 2992</span>&#160;            <span class="keywordflow">for</span> (<a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> i = 0; i &lt; f.<a class="code" href="a01364.html#a8a5f6fa29bd4b500caf186f60245b384">size</a>(); i++)</div><div class="line"><a name="l02993"></a><span class="lineno"> 2993</span>&#160;            {</div><div class="line"><a name="l02994"></a><span class="lineno"> 2994</span>&#160;                singleF[i] = i;</div><div class="line"><a name="l02995"></a><span class="lineno"> 2995</span>&#160;            }</div><div class="line"><a name="l02996"></a><span class="lineno"> 2996</span>&#160;        }</div><div class="line"><a name="l02997"></a><span class="lineno"> 2997</span>&#160;        <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> nConstraints = 0;</div><div class="line"><a name="l02998"></a><span class="lineno"> 2998</span>&#160;        <a class="code" href="a07669.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(f, fp)</div><div class="line"><a name="l02999"></a><span class="lineno"> 2999</span>&#160;        {</div><div class="line"><a name="l03000"></a><span class="lineno"> 3000</span>&#160;            <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> pointI = f[fp];</div><div class="line"><a name="l03001"></a><span class="lineno"> 3001</span>&#160;            <span class="keyword">const</span> <a class="code" href="a02791.html">point</a>&amp; pt = pp.<a class="code" href="a01972.html#a180aa335ba66b3224df33de8eb29b3bf">localPoints</a>()[pointI];</div><div class="line"><a name="l03002"></a><span class="lineno"> 3002</span>&#160;</div><div class="line"><a name="l03003"></a><span class="lineno"> 3003</span>&#160;            <span class="keywordflow">if</span> (patchConstraints[pointI].first() &gt; 1)</div><div class="line"><a name="l03004"></a><span class="lineno"> 3004</span>&#160;            {</div><div class="line"><a name="l03005"></a><span class="lineno"> 3005</span>&#160;                points[fp] = pt + patchAttraction[pointI];</div><div class="line"><a name="l03006"></a><span class="lineno"> 3006</span>&#160;                nConstraints++;</div><div class="line"><a name="l03007"></a><span class="lineno"> 3007</span>&#160;            }</div><div class="line"><a name="l03008"></a><span class="lineno"> 3008</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l03009"></a><span class="lineno"> 3009</span>&#160;            {</div><div class="line"><a name="l03010"></a><span class="lineno"> 3010</span>&#160;                points[fp] = pt;</div><div class="line"><a name="l03011"></a><span class="lineno"> 3011</span>&#160;            }</div><div class="line"><a name="l03012"></a><span class="lineno"> 3012</span>&#160;        }</div><div class="line"><a name="l03013"></a><span class="lineno"> 3013</span>&#160;</div><div class="line"><a name="l03014"></a><span class="lineno"> 3014</span>&#160;        <span class="keywordflow">if</span> (nConstraints == f.<a class="code" href="a01364.html#a8a5f6fa29bd4b500caf186f60245b384">size</a>())</div><div class="line"><a name="l03015"></a><span class="lineno"> 3015</span>&#160;        {</div><div class="line"><a name="l03016"></a><span class="lineno"> 3016</span>&#160;            scalar oldArea = f.<a class="code" href="a00714.html#ac47b383852677ce70d239fc1c06b500d">mag</a>(pp.<a class="code" href="a01972.html#a180aa335ba66b3224df33de8eb29b3bf">localPoints</a>());</div><div class="line"><a name="l03017"></a><span class="lineno"> 3017</span>&#160;            scalar newArea = singleF.<a class="code" href="a00714.html#ac47b383852677ce70d239fc1c06b500d">mag</a>(points);</div><div class="line"><a name="l03018"></a><span class="lineno"> 3018</span>&#160;            <span class="keywordflow">if</span> (newArea &lt; 0.1*oldArea)</div><div class="line"><a name="l03019"></a><span class="lineno"> 3019</span>&#160;            {</div><div class="line"><a name="l03020"></a><span class="lineno"> 3020</span>&#160;                <span class="comment">// For now remove the point with largest distance</span></div><div class="line"><a name="l03021"></a><span class="lineno"> 3021</span>&#160;                <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> maxFp = -1;</div><div class="line"><a name="l03022"></a><span class="lineno"> 3022</span>&#160;                scalar maxS = -1;</div><div class="line"><a name="l03023"></a><span class="lineno"> 3023</span>&#160;                <a class="code" href="a07669.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(f, fp)</div><div class="line"><a name="l03024"></a><span class="lineno"> 3024</span>&#160;                {</div><div class="line"><a name="l03025"></a><span class="lineno"> 3025</span>&#160;                    scalar <a class="code" href="a04281.html#a6d6b99210a64ad23792eb7a3b0411c42">s</a> = <a class="code" href="a10733.html#ae6fff2c6981e6d9618aa5038e69def6e">magSqr</a>(patchAttraction[f[fp]]);</div><div class="line"><a name="l03026"></a><span class="lineno"> 3026</span>&#160;                    <span class="keywordflow">if</span> (s &gt; maxS)</div><div class="line"><a name="l03027"></a><span class="lineno"> 3027</span>&#160;                    {</div><div class="line"><a name="l03028"></a><span class="lineno"> 3028</span>&#160;                        maxS = <a class="code" href="a04281.html#a6d6b99210a64ad23792eb7a3b0411c42">s</a>;</div><div class="line"><a name="l03029"></a><span class="lineno"> 3029</span>&#160;                        maxFp = fp;</div><div class="line"><a name="l03030"></a><span class="lineno"> 3030</span>&#160;                    }</div><div class="line"><a name="l03031"></a><span class="lineno"> 3031</span>&#160;                }</div><div class="line"><a name="l03032"></a><span class="lineno"> 3032</span>&#160;                <span class="keywordflow">if</span> (maxFp != -1)</div><div class="line"><a name="l03033"></a><span class="lineno"> 3033</span>&#160;                {</div><div class="line"><a name="l03034"></a><span class="lineno"> 3034</span>&#160;                    <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> pointI = f[maxFp];</div><div class="line"><a name="l03035"></a><span class="lineno"> 3035</span>&#160;                    <span class="comment">// Lower attraction on pointI</span></div><div class="line"><a name="l03036"></a><span class="lineno"> 3036</span>&#160;                    patchAttraction[pointI] *= 0.5;</div><div class="line"><a name="l03037"></a><span class="lineno"> 3037</span>&#160;                }</div><div class="line"><a name="l03038"></a><span class="lineno"> 3038</span>&#160;            }</div><div class="line"><a name="l03039"></a><span class="lineno"> 3039</span>&#160;        }</div><div class="line"><a name="l03040"></a><span class="lineno"> 3040</span>&#160;    }</div><div class="line"><a name="l03041"></a><span class="lineno"> 3041</span>&#160;}</div><div class="line"><a name="l03042"></a><span class="lineno"> 3042</span>&#160;</div><div class="line"><a name="l03043"></a><span class="lineno"> 3043</span>&#160;</div><div class="line"><a name="l03044"></a><span class="lineno"> 3044</span>&#160;<a class="code" href="a00754.html">Foam::vectorField</a> Foam::autoSnapDriver::calcNearestSurfaceFeature</div><div class="line"><a name="l03045"></a><span class="lineno"> 3045</span>&#160;(</div><div class="line"><a name="l03046"></a><span class="lineno"> 3046</span>&#160;    <span class="keyword">const</span> <a class="code" href="a02362.html">snapParameters</a>&amp; snapParams,</div><div class="line"><a name="l03047"></a><span class="lineno"> 3047</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> avoidSnapProblems,</div><div class="line"><a name="l03048"></a><span class="lineno"> 3048</span>&#160;    <span class="keyword">const</span> <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> iter,</div><div class="line"><a name="l03049"></a><span class="lineno"> 3049</span>&#160;    <span class="keyword">const</span> scalar featureCos,</div><div class="line"><a name="l03050"></a><span class="lineno"> 3050</span>&#160;    <span class="keyword">const</span> scalar featureAttract,</div><div class="line"><a name="l03051"></a><span class="lineno"> 3051</span>&#160;    <span class="keyword">const</span> <a class="code" href="a00754.html">scalarField</a>&amp; snapDist,</div><div class="line"><a name="l03052"></a><span class="lineno"> 3052</span>&#160;    <span class="keyword">const</span> <a class="code" href="a00754.html">vectorField</a>&amp; nearestDisp,</div><div class="line"><a name="l03053"></a><span class="lineno"> 3053</span>&#160;    <a class="code" href="a01531.html">motionSmoother</a>&amp; meshMover,</div><div class="line"><a name="l03054"></a><span class="lineno"> 3054</span>&#160;    <a class="code" href="a00754.html">vectorField</a>&amp; patchAttraction,</div><div class="line"><a name="l03055"></a><span class="lineno"> 3055</span>&#160;    <a class="code" href="a01364.html">List&lt;pointConstraint&gt;</a>&amp; patchConstraints</div><div class="line"><a name="l03056"></a><span class="lineno"> 3056</span>&#160;)<span class="keyword"> const</span></div><div class="line"><a name="l03057"></a><span class="lineno"> 3057</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l03058"></a><span class="lineno"> 3058</span>&#160;    <span class="keyword">const</span> <a class="code" href="a02517.html">Switch</a> implicitFeatureAttraction = snapParams.<a class="code" href="a02362.html#a9beb196b6dd5025bfc4d4adad6eddce8">implicitFeatureSnap</a>();</div><div class="line"><a name="l03059"></a><span class="lineno"> 3059</span>&#160;    <span class="keyword">const</span> <a class="code" href="a02517.html">Switch</a> explicitFeatureAttraction = snapParams.<a class="code" href="a02362.html#a3296425edf549e49f202c712b2e7bc92">explicitFeatureSnap</a>();</div><div class="line"><a name="l03060"></a><span class="lineno"> 3060</span>&#160;    <span class="keyword">const</span> <a class="code" href="a02517.html">Switch</a> multiRegionFeatureSnap = snapParams.<a class="code" href="a02362.html#aadaf99e1219953afcef1749915d6a2cc">multiRegionFeatureSnap</a>();</div><div class="line"><a name="l03061"></a><span class="lineno"> 3061</span>&#160;</div><div class="line"><a name="l03062"></a><span class="lineno"> 3062</span>&#160;    <a class="code" href="a10733.html#a501e80d1e14c94973e82f1555e7eb711">Info</a>&lt;&lt; <span class="stringliteral">&quot;Overriding displacement on features :&quot;</span> &lt;&lt; <a class="code" href="a10733.html#ae53117a9770efe95d2d01bb5cc2c99ef">nl</a></div><div class="line"><a name="l03063"></a><span class="lineno"> 3063</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;   implicit features    : &quot;</span> &lt;&lt; implicitFeatureAttraction &lt;&lt; <a class="code" href="a10733.html#ae53117a9770efe95d2d01bb5cc2c99ef">nl</a></div><div class="line"><a name="l03064"></a><span class="lineno"> 3064</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;   explicit features    : &quot;</span> &lt;&lt; explicitFeatureAttraction &lt;&lt; <a class="code" href="a10733.html#ae53117a9770efe95d2d01bb5cc2c99ef">nl</a></div><div class="line"><a name="l03065"></a><span class="lineno"> 3065</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;   multi-patch features : &quot;</span> &lt;&lt; multiRegionFeatureSnap &lt;&lt; <a class="code" href="a10733.html#ae53117a9770efe95d2d01bb5cc2c99ef">nl</a></div><div class="line"><a name="l03066"></a><span class="lineno"> 3066</span>&#160;        &lt;&lt; <a class="code" href="a10733.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div><div class="line"><a name="l03067"></a><span class="lineno"> 3067</span>&#160;</div><div class="line"><a name="l03068"></a><span class="lineno"> 3068</span>&#160;</div><div class="line"><a name="l03069"></a><span class="lineno"> 3069</span>&#160;    <span class="keyword">const</span> <a class="code" href="a01972.html">indirectPrimitivePatch</a>&amp; pp = meshMover.<a class="code" href="a01532.html#a1ff8b2fdb3637d00594b64bf4d72b51d">patch</a>();</div><div class="line"><a name="l03070"></a><span class="lineno"> 3070</span>&#160;    <span class="keyword">const</span> <a class="code" href="a00754.html">pointField</a>&amp; localPoints = pp.<a class="code" href="a01972.html#a180aa335ba66b3224df33de8eb29b3bf">localPoints</a>();</div><div class="line"><a name="l03071"></a><span class="lineno"> 3071</span>&#160;    <span class="keyword">const</span> <a class="code" href="a00876.html">fvMesh</a>&amp; <a class="code" href="a04729.html#a4c1de256df6b3d186a85745b3149394a">mesh</a> = meshRefiner_.mesh();</div><div class="line"><a name="l03072"></a><span class="lineno"> 3072</span>&#160;</div><div class="line"><a name="l03073"></a><span class="lineno"> 3073</span>&#160;</div><div class="line"><a name="l03074"></a><span class="lineno"> 3074</span>&#160;</div><div class="line"><a name="l03075"></a><span class="lineno"> 3075</span>&#160;    <span class="comment">// Per point, per surrounding face:</span></div><div class="line"><a name="l03076"></a><span class="lineno"> 3076</span>&#160;    <span class="comment">// - faceSurfaceNormal</span></div><div class="line"><a name="l03077"></a><span class="lineno"> 3077</span>&#160;    <span class="comment">// - faceDisp</span></div><div class="line"><a name="l03078"></a><span class="lineno"> 3078</span>&#160;    <span class="comment">// - faceCentres</span></div><div class="line"><a name="l03079"></a><span class="lineno"> 3079</span>&#160;    <a class="code" href="a01364.html">List&lt;List&lt;point&gt;</a>&gt; pointFaceSurfNormals;</div><div class="line"><a name="l03080"></a><span class="lineno"> 3080</span>&#160;    <a class="code" href="a01364.html">List&lt;List&lt;point&gt;</a>&gt; pointFaceDisp;</div><div class="line"><a name="l03081"></a><span class="lineno"> 3081</span>&#160;    <a class="code" href="a01364.html">List&lt;List&lt;point&gt;</a>&gt; pointFaceCentres;</div><div class="line"><a name="l03082"></a><span class="lineno"> 3082</span>&#160;    <a class="code" href="a01364.html">List&lt;labelList&gt;</a> pointFacePatchID;</div><div class="line"><a name="l03083"></a><span class="lineno"> 3083</span>&#160;</div><div class="line"><a name="l03084"></a><span class="lineno"> 3084</span>&#160;    {</div><div class="line"><a name="l03085"></a><span class="lineno"> 3085</span>&#160;        <span class="comment">// Calculate attraction distance per face (from the attraction distance</span></div><div class="line"><a name="l03086"></a><span class="lineno"> 3086</span>&#160;        <span class="comment">// per point)</span></div><div class="line"><a name="l03087"></a><span class="lineno"> 3087</span>&#160;        <a class="code" href="a00754.html">scalarField</a> faceSnapDist(pp.size(), -GREAT);</div><div class="line"><a name="l03088"></a><span class="lineno"> 3088</span>&#160;        <a class="code" href="a07669.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(pp.<a class="code" href="a01972.html#af5aca3ce69275c80366bc8d5c0584da2">localFaces</a>(), faceI)</div><div class="line"><a name="l03089"></a><span class="lineno"> 3089</span>&#160;        {</div><div class="line"><a name="l03090"></a><span class="lineno"> 3090</span>&#160;            <span class="keyword">const</span> <a class="code" href="a00714.html">face</a>&amp; <a class="code" href="a03926.html#a888be93833ac7a23170555c69c690288">f</a> = pp.<a class="code" href="a01972.html#af5aca3ce69275c80366bc8d5c0584da2">localFaces</a>()[faceI];</div><div class="line"><a name="l03091"></a><span class="lineno"> 3091</span>&#160;            <a class="code" href="a07669.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(f, fp)</div><div class="line"><a name="l03092"></a><span class="lineno"> 3092</span>&#160;            {</div><div class="line"><a name="l03093"></a><span class="lineno"> 3093</span>&#160;                faceSnapDist[faceI] = <a class="code" href="a10733.html#ac993e906cf2774ae77e666bc24e81733">max</a>(faceSnapDist[faceI], snapDist[f[fp]]);</div><div class="line"><a name="l03094"></a><span class="lineno"> 3094</span>&#160;            }</div><div class="line"><a name="l03095"></a><span class="lineno"> 3095</span>&#160;        }</div><div class="line"><a name="l03096"></a><span class="lineno"> 3096</span>&#160;</div><div class="line"><a name="l03097"></a><span class="lineno"> 3097</span>&#160;</div><div class="line"><a name="l03098"></a><span class="lineno"> 3098</span>&#160;        <span class="comment">// Displacement and orientation per pp face</span></div><div class="line"><a name="l03099"></a><span class="lineno"> 3099</span>&#160;        <span class="comment">// ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></div><div class="line"><a name="l03100"></a><span class="lineno"> 3100</span>&#160;</div><div class="line"><a name="l03101"></a><span class="lineno"> 3101</span>&#160;        <span class="comment">// vector from point on surface back to face centre</span></div><div class="line"><a name="l03102"></a><span class="lineno"> 3102</span>&#160;        <a class="code" href="a00754.html">vectorField</a> faceDisp(pp.size(), <a class="code" href="a02791.html#ac3b79445511a1e3a6443b59ac93c394a">vector::zero</a>);</div><div class="line"><a name="l03103"></a><span class="lineno"> 3103</span>&#160;        <span class="comment">// normal of surface at point on surface</span></div><div class="line"><a name="l03104"></a><span class="lineno"> 3104</span>&#160;        <a class="code" href="a00754.html">vectorField</a> faceSurfaceNormal(pp.size(), <a class="code" href="a02791.html#ac3b79445511a1e3a6443b59ac93c394a">vector::zero</a>);</div><div class="line"><a name="l03105"></a><span class="lineno"> 3105</span>&#160;        <a class="code" href="a01364.html">labelList</a> faceSurfaceGlobalRegion(pp.size(), -1);</div><div class="line"><a name="l03106"></a><span class="lineno"> 3106</span>&#160;        <a class="code" href="a00754.html">vectorField</a> faceRotation(pp.size(), <a class="code" href="a02791.html#ac3b79445511a1e3a6443b59ac93c394a">vector::zero</a>);</div><div class="line"><a name="l03107"></a><span class="lineno"> 3107</span>&#160;</div><div class="line"><a name="l03108"></a><span class="lineno"> 3108</span>&#160;        calcNearestFace</div><div class="line"><a name="l03109"></a><span class="lineno"> 3109</span>&#160;        (</div><div class="line"><a name="l03110"></a><span class="lineno"> 3110</span>&#160;            iter,</div><div class="line"><a name="l03111"></a><span class="lineno"> 3111</span>&#160;            pp,</div><div class="line"><a name="l03112"></a><span class="lineno"> 3112</span>&#160;            faceSnapDist,</div><div class="line"><a name="l03113"></a><span class="lineno"> 3113</span>&#160;            faceDisp,</div><div class="line"><a name="l03114"></a><span class="lineno"> 3114</span>&#160;            faceSurfaceNormal,</div><div class="line"><a name="l03115"></a><span class="lineno"> 3115</span>&#160;            faceSurfaceGlobalRegion,</div><div class="line"><a name="l03116"></a><span class="lineno"> 3116</span>&#160;            faceRotation</div><div class="line"><a name="l03117"></a><span class="lineno"> 3117</span>&#160;        );</div><div class="line"><a name="l03118"></a><span class="lineno"> 3118</span>&#160;</div><div class="line"><a name="l03119"></a><span class="lineno"> 3119</span>&#160;</div><div class="line"><a name="l03120"></a><span class="lineno"> 3120</span>&#160;        <span class="comment">// Collect (possibly remote) per point data of all surrounding faces</span></div><div class="line"><a name="l03121"></a><span class="lineno"> 3121</span>&#160;        <span class="comment">// ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></div><div class="line"><a name="l03122"></a><span class="lineno"> 3122</span>&#160;        <span class="comment">// - faceSurfaceNormal</span></div><div class="line"><a name="l03123"></a><span class="lineno"> 3123</span>&#160;        <span class="comment">// - faceDisp</span></div><div class="line"><a name="l03124"></a><span class="lineno"> 3124</span>&#160;        <span class="comment">// - faceCentres</span></div><div class="line"><a name="l03125"></a><span class="lineno"> 3125</span>&#160;        calcNearestFacePointProperties</div><div class="line"><a name="l03126"></a><span class="lineno"> 3126</span>&#160;        (</div><div class="line"><a name="l03127"></a><span class="lineno"> 3127</span>&#160;            iter,</div><div class="line"><a name="l03128"></a><span class="lineno"> 3128</span>&#160;            pp,</div><div class="line"><a name="l03129"></a><span class="lineno"> 3129</span>&#160;</div><div class="line"><a name="l03130"></a><span class="lineno"> 3130</span>&#160;            faceDisp,</div><div class="line"><a name="l03131"></a><span class="lineno"> 3131</span>&#160;            faceSurfaceNormal,</div><div class="line"><a name="l03132"></a><span class="lineno"> 3132</span>&#160;            faceSurfaceGlobalRegion,</div><div class="line"><a name="l03133"></a><span class="lineno"> 3133</span>&#160;</div><div class="line"><a name="l03134"></a><span class="lineno"> 3134</span>&#160;            pointFaceSurfNormals,</div><div class="line"><a name="l03135"></a><span class="lineno"> 3135</span>&#160;            pointFaceDisp,</div><div class="line"><a name="l03136"></a><span class="lineno"> 3136</span>&#160;            pointFaceCentres,</div><div class="line"><a name="l03137"></a><span class="lineno"> 3137</span>&#160;            pointFacePatchID</div><div class="line"><a name="l03138"></a><span class="lineno"> 3138</span>&#160;        );</div><div class="line"><a name="l03139"></a><span class="lineno"> 3139</span>&#160;    }</div><div class="line"><a name="l03140"></a><span class="lineno"> 3140</span>&#160;</div><div class="line"><a name="l03141"></a><span class="lineno"> 3141</span>&#160;</div><div class="line"><a name="l03142"></a><span class="lineno"> 3142</span>&#160;    <span class="comment">// Start off with nearest point on surface</span></div><div class="line"><a name="l03143"></a><span class="lineno"> 3143</span>&#160;    <a class="code" href="a00754.html">vectorField</a> patchDisp = nearestDisp;</div><div class="line"><a name="l03144"></a><span class="lineno"> 3144</span>&#160;</div><div class="line"><a name="l03145"></a><span class="lineno"> 3145</span>&#160;</div><div class="line"><a name="l03146"></a><span class="lineno"> 3146</span>&#160;    <span class="comment">// Main calculation</span></div><div class="line"><a name="l03147"></a><span class="lineno"> 3147</span>&#160;    <span class="comment">// ~~~~~~~~~~~~~~~~</span></div><div class="line"><a name="l03148"></a><span class="lineno"> 3148</span>&#160;    <span class="comment">// This is the main intelligence which calculates per point the vector to</span></div><div class="line"><a name="l03149"></a><span class="lineno"> 3149</span>&#160;    <span class="comment">// attract it to the nearest surface. There are lots of possibilities</span></div><div class="line"><a name="l03150"></a><span class="lineno"> 3150</span>&#160;    <span class="comment">// here.</span></div><div class="line"><a name="l03151"></a><span class="lineno"> 3151</span>&#160;</div><div class="line"><a name="l03152"></a><span class="lineno"> 3152</span>&#160;    <span class="comment">// Nearest feature</span></div><div class="line"><a name="l03153"></a><span class="lineno"> 3153</span>&#160;    patchAttraction.<a class="code" href="a01364.html#aedb985ffeaf1bdbfeccc2a8730405703">setSize</a>(localPoints.<a class="code" href="a01364.html#a8a5f6fa29bd4b500caf186f60245b384">size</a>());</div><div class="line"><a name="l03154"></a><span class="lineno"> 3154</span>&#160;    patchAttraction = <a class="code" href="a02791.html#ac3b79445511a1e3a6443b59ac93c394a">vector::zero</a>;</div><div class="line"><a name="l03155"></a><span class="lineno"> 3155</span>&#160;    <span class="comment">// Constraints at feature</span></div><div class="line"><a name="l03156"></a><span class="lineno"> 3156</span>&#160;    patchConstraints.<a class="code" href="a01364.html#aedb985ffeaf1bdbfeccc2a8730405703">setSize</a>(localPoints.<a class="code" href="a01364.html#a8a5f6fa29bd4b500caf186f60245b384">size</a>());</div><div class="line"><a name="l03157"></a><span class="lineno"> 3157</span>&#160;    patchConstraints = <a class="code" href="a01871.html">pointConstraint</a>();</div><div class="line"><a name="l03158"></a><span class="lineno"> 3158</span>&#160;</div><div class="line"><a name="l03159"></a><span class="lineno"> 3159</span>&#160;    <span class="keywordflow">if</span> (implicitFeatureAttraction)</div><div class="line"><a name="l03160"></a><span class="lineno"> 3160</span>&#160;    {</div><div class="line"><a name="l03161"></a><span class="lineno"> 3161</span>&#160;        <span class="comment">// Sample faces around each point and see if nearest surface normal</span></div><div class="line"><a name="l03162"></a><span class="lineno"> 3162</span>&#160;        <span class="comment">// differs. Reconstruct a feature edge/point if possible and snap to</span></div><div class="line"><a name="l03163"></a><span class="lineno"> 3163</span>&#160;        <span class="comment">// it.</span></div><div class="line"><a name="l03164"></a><span class="lineno"> 3164</span>&#160;        featureAttractionUsingReconstruction</div><div class="line"><a name="l03165"></a><span class="lineno"> 3165</span>&#160;        (</div><div class="line"><a name="l03166"></a><span class="lineno"> 3166</span>&#160;            iter,</div><div class="line"><a name="l03167"></a><span class="lineno"> 3167</span>&#160;            avoidSnapProblems,</div><div class="line"><a name="l03168"></a><span class="lineno"> 3168</span>&#160;            featureCos,</div><div class="line"><a name="l03169"></a><span class="lineno"> 3169</span>&#160;</div><div class="line"><a name="l03170"></a><span class="lineno"> 3170</span>&#160;            pp,</div><div class="line"><a name="l03171"></a><span class="lineno"> 3171</span>&#160;            snapDist,</div><div class="line"><a name="l03172"></a><span class="lineno"> 3172</span>&#160;            nearestDisp,</div><div class="line"><a name="l03173"></a><span class="lineno"> 3173</span>&#160;</div><div class="line"><a name="l03174"></a><span class="lineno"> 3174</span>&#160;            pointFaceSurfNormals,</div><div class="line"><a name="l03175"></a><span class="lineno"> 3175</span>&#160;            pointFaceDisp,</div><div class="line"><a name="l03176"></a><span class="lineno"> 3176</span>&#160;            pointFaceCentres,</div><div class="line"><a name="l03177"></a><span class="lineno"> 3177</span>&#160;            pointFacePatchID,</div><div class="line"><a name="l03178"></a><span class="lineno"> 3178</span>&#160;</div><div class="line"><a name="l03179"></a><span class="lineno"> 3179</span>&#160;            patchAttraction,</div><div class="line"><a name="l03180"></a><span class="lineno"> 3180</span>&#160;            patchConstraints</div><div class="line"><a name="l03181"></a><span class="lineno"> 3181</span>&#160;        );</div><div class="line"><a name="l03182"></a><span class="lineno"> 3182</span>&#160;    }</div><div class="line"><a name="l03183"></a><span class="lineno"> 3183</span>&#160;</div><div class="line"><a name="l03184"></a><span class="lineno"> 3184</span>&#160;    <span class="keywordflow">if</span> (explicitFeatureAttraction)</div><div class="line"><a name="l03185"></a><span class="lineno"> 3185</span>&#160;    {</div><div class="line"><a name="l03186"></a><span class="lineno"> 3186</span>&#160;        <span class="comment">// Sample faces around each point and see if nearest surface normal</span></div><div class="line"><a name="l03187"></a><span class="lineno"> 3187</span>&#160;        <span class="comment">// differs. For those find the nearest real feature edge/point and</span></div><div class="line"><a name="l03188"></a><span class="lineno"> 3188</span>&#160;        <span class="comment">// store the correspondence. Then loop over feature edge/point</span></div><div class="line"><a name="l03189"></a><span class="lineno"> 3189</span>&#160;        <span class="comment">// and attract those nearest mesh point. (the first phase just is</span></div><div class="line"><a name="l03190"></a><span class="lineno"> 3190</span>&#160;        <span class="comment">// a subsetting of candidate points, the second makes sure that only</span></div><div class="line"><a name="l03191"></a><span class="lineno"> 3191</span>&#160;        <span class="comment">// one mesh point gets attracted per feature)</span></div><div class="line"><a name="l03192"></a><span class="lineno"> 3192</span>&#160;        featureAttractionUsingFeatureEdges</div><div class="line"><a name="l03193"></a><span class="lineno"> 3193</span>&#160;        (</div><div class="line"><a name="l03194"></a><span class="lineno"> 3194</span>&#160;            iter,</div><div class="line"><a name="l03195"></a><span class="lineno"> 3195</span>&#160;            avoidSnapProblems,</div><div class="line"><a name="l03196"></a><span class="lineno"> 3196</span>&#160;            featureCos,</div><div class="line"><a name="l03197"></a><span class="lineno"> 3197</span>&#160;            multiRegionFeatureSnap,</div><div class="line"><a name="l03198"></a><span class="lineno"> 3198</span>&#160;</div><div class="line"><a name="l03199"></a><span class="lineno"> 3199</span>&#160;            pp,</div><div class="line"><a name="l03200"></a><span class="lineno"> 3200</span>&#160;            snapDist,</div><div class="line"><a name="l03201"></a><span class="lineno"> 3201</span>&#160;            nearestDisp,</div><div class="line"><a name="l03202"></a><span class="lineno"> 3202</span>&#160;</div><div class="line"><a name="l03203"></a><span class="lineno"> 3203</span>&#160;            pointFaceSurfNormals,</div><div class="line"><a name="l03204"></a><span class="lineno"> 3204</span>&#160;            pointFaceDisp,</div><div class="line"><a name="l03205"></a><span class="lineno"> 3205</span>&#160;            pointFaceCentres,</div><div class="line"><a name="l03206"></a><span class="lineno"> 3206</span>&#160;            pointFacePatchID,</div><div class="line"><a name="l03207"></a><span class="lineno"> 3207</span>&#160;</div><div class="line"><a name="l03208"></a><span class="lineno"> 3208</span>&#160;            patchAttraction,</div><div class="line"><a name="l03209"></a><span class="lineno"> 3209</span>&#160;            patchConstraints</div><div class="line"><a name="l03210"></a><span class="lineno"> 3210</span>&#160;        );</div><div class="line"><a name="l03211"></a><span class="lineno"> 3211</span>&#160;    }</div><div class="line"><a name="l03212"></a><span class="lineno"> 3212</span>&#160;</div><div class="line"><a name="l03213"></a><span class="lineno"> 3213</span>&#160;    preventFaceSqueeze</div><div class="line"><a name="l03214"></a><span class="lineno"> 3214</span>&#160;    (</div><div class="line"><a name="l03215"></a><span class="lineno"> 3215</span>&#160;        iter,</div><div class="line"><a name="l03216"></a><span class="lineno"> 3216</span>&#160;        featureCos,</div><div class="line"><a name="l03217"></a><span class="lineno"> 3217</span>&#160;</div><div class="line"><a name="l03218"></a><span class="lineno"> 3218</span>&#160;        pp,</div><div class="line"><a name="l03219"></a><span class="lineno"> 3219</span>&#160;        snapDist,</div><div class="line"><a name="l03220"></a><span class="lineno"> 3220</span>&#160;</div><div class="line"><a name="l03221"></a><span class="lineno"> 3221</span>&#160;        patchAttraction,</div><div class="line"><a name="l03222"></a><span class="lineno"> 3222</span>&#160;        patchConstraints</div><div class="line"><a name="l03223"></a><span class="lineno"> 3223</span>&#160;    );</div><div class="line"><a name="l03224"></a><span class="lineno"> 3224</span>&#160;</div><div class="line"><a name="l03225"></a><span class="lineno"> 3225</span>&#160;    <span class="comment">//const PackedBoolList isMasterPoint(syncTools::getMasterPoints(mesh));</span></div><div class="line"><a name="l03226"></a><span class="lineno"> 3226</span>&#160;    <span class="keyword">const</span> <a class="code" href="a01756.html">PackedBoolList</a> isPatchMasterPoint</div><div class="line"><a name="l03227"></a><span class="lineno"> 3227</span>&#160;    (</div><div class="line"><a name="l03228"></a><span class="lineno"> 3228</span>&#160;        <a class="code" href="a01470.html#ab7f36dd5e2a0f638f316332f5e355ea6">meshRefinement::getMasterPoints</a></div><div class="line"><a name="l03229"></a><span class="lineno"> 3229</span>&#160;        (</div><div class="line"><a name="l03230"></a><span class="lineno"> 3230</span>&#160;            mesh,</div><div class="line"><a name="l03231"></a><span class="lineno"> 3231</span>&#160;            pp.<a class="code" href="a01972.html#ae4935f85c38392518565dd7c666e3caf">meshPoints</a>()</div><div class="line"><a name="l03232"></a><span class="lineno"> 3232</span>&#160;        )</div><div class="line"><a name="l03233"></a><span class="lineno"> 3233</span>&#160;    );</div><div class="line"><a name="l03234"></a><span class="lineno"> 3234</span>&#160;    {</div><div class="line"><a name="l03235"></a><span class="lineno"> 3235</span>&#160;        <a class="code" href="a02791.html">vector</a> avgPatchDisp = <a class="code" href="a01470.html#a7e4205ba28cb720bb897769658b2bcc2">meshRefinement::gAverage</a></div><div class="line"><a name="l03236"></a><span class="lineno"> 3236</span>&#160;        (</div><div class="line"><a name="l03237"></a><span class="lineno"> 3237</span>&#160;            isPatchMasterPoint,</div><div class="line"><a name="l03238"></a><span class="lineno"> 3238</span>&#160;            patchDisp</div><div class="line"><a name="l03239"></a><span class="lineno"> 3239</span>&#160;        );</div><div class="line"><a name="l03240"></a><span class="lineno"> 3240</span>&#160;        <a class="code" href="a02791.html">vector</a> avgPatchAttr = <a class="code" href="a01470.html#a7e4205ba28cb720bb897769658b2bcc2">meshRefinement::gAverage</a></div><div class="line"><a name="l03241"></a><span class="lineno"> 3241</span>&#160;        (</div><div class="line"><a name="l03242"></a><span class="lineno"> 3242</span>&#160;            isPatchMasterPoint,</div><div class="line"><a name="l03243"></a><span class="lineno"> 3243</span>&#160;            patchAttraction</div><div class="line"><a name="l03244"></a><span class="lineno"> 3244</span>&#160;        );</div><div class="line"><a name="l03245"></a><span class="lineno"> 3245</span>&#160;</div><div class="line"><a name="l03246"></a><span class="lineno"> 3246</span>&#160;        <a class="code" href="a10733.html#a501e80d1e14c94973e82f1555e7eb711">Info</a>&lt;&lt; <span class="stringliteral">&quot;Attraction:&quot;</span> &lt;&lt; endl</div><div class="line"><a name="l03247"></a><span class="lineno"> 3247</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;     linear   : max:&quot;</span> &lt;&lt; <a class="code" href="a10733.html#a78faa7b12ce7a0cbdf8a1c95d80ea330">gMaxMagSqr</a>(patchDisp)</div><div class="line"><a name="l03248"></a><span class="lineno"> 3248</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; avg:&quot;</span> &lt;&lt; avgPatchDisp &lt;&lt; endl</div><div class="line"><a name="l03249"></a><span class="lineno"> 3249</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;     feature  : max:&quot;</span> &lt;&lt; <a class="code" href="a10733.html#a78faa7b12ce7a0cbdf8a1c95d80ea330">gMaxMagSqr</a>(patchAttraction)</div><div class="line"><a name="l03250"></a><span class="lineno"> 3250</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; avg:&quot;</span> &lt;&lt; avgPatchAttr &lt;&lt; <a class="code" href="a10733.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div><div class="line"><a name="l03251"></a><span class="lineno"> 3251</span>&#160;    }</div><div class="line"><a name="l03252"></a><span class="lineno"> 3252</span>&#160;</div><div class="line"><a name="l03253"></a><span class="lineno"> 3253</span>&#160;    <span class="comment">// So now we have:</span></div><div class="line"><a name="l03254"></a><span class="lineno"> 3254</span>&#160;    <span class="comment">// - patchDisp          : point movement to go to nearest point on surface</span></div><div class="line"><a name="l03255"></a><span class="lineno"> 3255</span>&#160;    <span class="comment">//                       (either direct or through interpolation of</span></div><div class="line"><a name="l03256"></a><span class="lineno"> 3256</span>&#160;    <span class="comment">//                        face nearest)</span></div><div class="line"><a name="l03257"></a><span class="lineno"> 3257</span>&#160;    <span class="comment">// - patchAttraction    : direct attraction to features</span></div><div class="line"><a name="l03258"></a><span class="lineno"> 3258</span>&#160;    <span class="comment">// - patchConstraints   : type of features</span></div><div class="line"><a name="l03259"></a><span class="lineno"> 3259</span>&#160;</div><div class="line"><a name="l03260"></a><span class="lineno"> 3260</span>&#160;    <span class="comment">// Use any combination of patchDisp and direct feature attraction.</span></div><div class="line"><a name="l03261"></a><span class="lineno"> 3261</span>&#160;</div><div class="line"><a name="l03262"></a><span class="lineno"> 3262</span>&#160;</div><div class="line"><a name="l03263"></a><span class="lineno"> 3263</span>&#160;    <span class="comment">// Mix with direct feature attraction</span></div><div class="line"><a name="l03264"></a><span class="lineno"> 3264</span>&#160;    <a class="code" href="a07669.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(patchConstraints, pointI)</div><div class="line"><a name="l03265"></a><span class="lineno"> 3265</span>&#160;    {</div><div class="line"><a name="l03266"></a><span class="lineno"> 3266</span>&#160;        <span class="keywordflow">if</span> (patchConstraints[pointI].first() &gt; 1)</div><div class="line"><a name="l03267"></a><span class="lineno"> 3267</span>&#160;        {</div><div class="line"><a name="l03268"></a><span class="lineno"> 3268</span>&#160;            patchDisp[pointI] =</div><div class="line"><a name="l03269"></a><span class="lineno"> 3269</span>&#160;                (1.0-featureAttract)*patchDisp[pointI]</div><div class="line"><a name="l03270"></a><span class="lineno"> 3270</span>&#160;              + featureAttract*patchAttraction[pointI];</div><div class="line"><a name="l03271"></a><span class="lineno"> 3271</span>&#160;        }</div><div class="line"><a name="l03272"></a><span class="lineno"> 3272</span>&#160;    }</div><div class="line"><a name="l03273"></a><span class="lineno"> 3273</span>&#160;</div><div class="line"><a name="l03274"></a><span class="lineno"> 3274</span>&#160;</div><div class="line"><a name="l03275"></a><span class="lineno"> 3275</span>&#160;</div><div class="line"><a name="l03276"></a><span class="lineno"> 3276</span>&#160;    <span class="comment">// Count</span></div><div class="line"><a name="l03277"></a><span class="lineno"> 3277</span>&#160;    {</div><div class="line"><a name="l03278"></a><span class="lineno"> 3278</span>&#160;        <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> nMasterPoints = 0;</div><div class="line"><a name="l03279"></a><span class="lineno"> 3279</span>&#160;        <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> nPlanar = 0;</div><div class="line"><a name="l03280"></a><span class="lineno"> 3280</span>&#160;        <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> nEdge = 0;</div><div class="line"><a name="l03281"></a><span class="lineno"> 3281</span>&#160;        <a class="code" href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">label</a> nPoint = 0;</div><div class="line"><a name="l03282"></a><span class="lineno"> 3282</span>&#160;</div><div class="line"><a name="l03283"></a><span class="lineno"> 3283</span>&#160;        <a class="code" href="a07669.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a>(patchConstraints, pointI)</div><div class="line"><a name="l03284"></a><span class="lineno"> 3284</span>&#160;        {</div><div class="line"><a name="l03285"></a><span class="lineno"> 3285</span>&#160;            <span class="keywordflow">if</span> (isPatchMasterPoint[pointI])</div><div class="line"><a name="l03286"></a><span class="lineno"> 3286</span>&#160;            {</div><div class="line"><a name="l03287"></a><span class="lineno"> 3287</span>&#160;                nMasterPoints++;</div><div class="line"><a name="l03288"></a><span class="lineno"> 3288</span>&#160;</div><div class="line"><a name="l03289"></a><span class="lineno"> 3289</span>&#160;                <span class="keywordflow">if</span> (patchConstraints[pointI].first() == 1)</div><div class="line"><a name="l03290"></a><span class="lineno"> 3290</span>&#160;                {</div><div class="line"><a name="l03291"></a><span class="lineno"> 3291</span>&#160;                    nPlanar++;</div><div class="line"><a name="l03292"></a><span class="lineno"> 3292</span>&#160;                }</div><div class="line"><a name="l03293"></a><span class="lineno"> 3293</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (patchConstraints[pointI].first() == 2)</div><div class="line"><a name="l03294"></a><span class="lineno"> 3294</span>&#160;                {</div><div class="line"><a name="l03295"></a><span class="lineno"> 3295</span>&#160;                    nEdge++;</div><div class="line"><a name="l03296"></a><span class="lineno"> 3296</span>&#160;                }</div><div class="line"><a name="l03297"></a><span class="lineno"> 3297</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (patchConstraints[pointI].first() == 3)</div><div class="line"><a name="l03298"></a><span class="lineno"> 3298</span>&#160;                {</div><div class="line"><a name="l03299"></a><span class="lineno"> 3299</span>&#160;                    nPoint++;</div><div class="line"><a name="l03300"></a><span class="lineno"> 3300</span>&#160;                }</div><div class="line"><a name="l03301"></a><span class="lineno"> 3301</span>&#160;            }</div><div class="line"><a name="l03302"></a><span class="lineno"> 3302</span>&#160;        }</div><div class="line"><a name="l03303"></a><span class="lineno"> 3303</span>&#160;</div><div class="line"><a name="l03304"></a><span class="lineno"> 3304</span>&#160;        <a class="code" href="a10733.html#a7ffd6af4acc2eb9ba72ee296b5ecda23">reduce</a>(nMasterPoints, <a class="code" href="a02469.html">sumOp&lt;label&gt;</a>());</div><div class="line"><a name="l03305"></a><span class="lineno"> 3305</span>&#160;        <a class="code" href="a10733.html#a7ffd6af4acc2eb9ba72ee296b5ecda23">reduce</a>(nPlanar, <a class="code" href="a02469.html">sumOp&lt;label&gt;</a>());</div><div class="line"><a name="l03306"></a><span class="lineno"> 3306</span>&#160;        <a class="code" href="a10733.html#a7ffd6af4acc2eb9ba72ee296b5ecda23">reduce</a>(nEdge, <a class="code" href="a02469.html">sumOp&lt;label&gt;</a>());</div><div class="line"><a name="l03307"></a><span class="lineno"> 3307</span>&#160;        <a class="code" href="a10733.html#a7ffd6af4acc2eb9ba72ee296b5ecda23">reduce</a>(nPoint, <a class="code" href="a02469.html">sumOp&lt;label&gt;</a>());</div><div class="line"><a name="l03308"></a><span class="lineno"> 3308</span>&#160;        <a class="code" href="a10733.html#a501e80d1e14c94973e82f1555e7eb711">Info</a>&lt;&lt; <span class="stringliteral">&quot;Feature analysis : total master points:&quot;</span></div><div class="line"><a name="l03309"></a><span class="lineno"> 3309</span>&#160;            &lt;&lt; nMasterPoints</div><div class="line"><a name="l03310"></a><span class="lineno"> 3310</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; attraction to :&quot;</span> &lt;&lt; <a class="code" href="a10733.html#ae53117a9770efe95d2d01bb5cc2c99ef">nl</a></div><div class="line"><a name="l03311"></a><span class="lineno"> 3311</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;    feature point   : &quot;</span> &lt;&lt; nPoint &lt;&lt; <a class="code" href="a10733.html#ae53117a9770efe95d2d01bb5cc2c99ef">nl</a></div><div class="line"><a name="l03312"></a><span class="lineno"> 3312</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;    feature edge    : &quot;</span> &lt;&lt; nEdge &lt;&lt; <a class="code" href="a10733.html#ae53117a9770efe95d2d01bb5cc2c99ef">nl</a></div><div class="line"><a name="l03313"></a><span class="lineno"> 3313</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;    nearest surface : &quot;</span> &lt;&lt; nPlanar &lt;&lt; <a class="code" href="a10733.html#ae53117a9770efe95d2d01bb5cc2c99ef">nl</a></div><div class="line"><a name="l03314"></a><span class="lineno"> 3314</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;    rest            : &quot;</span> &lt;&lt; nMasterPoints-nPoint-nEdge-nPlanar</div><div class="line"><a name="l03315"></a><span class="lineno"> 3315</span>&#160;            &lt;&lt; <a class="code" href="a10733.html#ae53117a9770efe95d2d01bb5cc2c99ef">nl</a></div><div class="line"><a name="l03316"></a><span class="lineno"> 3316</span>&#160;            &lt;&lt; <a class="code" href="a10733.html#a2db8fe02a0d3909e9351bb4275b23ce4">endl</a>;</div><div class="line"><a name="l03317"></a><span class="lineno"> 3317</span>&#160;    }</div><div class="line"><a name="l03318"></a><span class="lineno"> 3318</span>&#160;</div><div class="line"><a name="l03319"></a><span class="lineno"> 3319</span>&#160;</div><div class="line"><a name="l03320"></a><span class="lineno"> 3320</span>&#160;    <span class="comment">// Now we have the displacement per patch point to move onto the surface</span></div><div class="line"><a name="l03321"></a><span class="lineno"> 3321</span>&#160;    <span class="comment">// Split into tangential and normal direction.</span></div><div class="line"><a name="l03322"></a><span class="lineno"> 3322</span>&#160;    <span class="comment">// - start off with all non-constrained points following the constrained</span></div><div class="line"><a name="l03323"></a><span class="lineno"> 3323</span>&#160;    <span class="comment">//   ones since point normals not relevant.</span></div><div class="line"><a name="l03324"></a><span class="lineno"> 3324</span>&#160;    <span class="comment">// - finish with only tangential component smoothed.</span></div><div class="line"><a name="l03325"></a><span class="lineno"> 3325</span>&#160;    <span class="comment">// Note: tangential is most</span></div><div class="line"><a name="l03326"></a><span class="lineno"> 3326</span>&#160;    <span class="comment">// likely to come purely from face-centre snapping, not face rotation.</span></div><div class="line"><a name="l03327"></a><span class="lineno"> 3327</span>&#160;    <span class="comment">// Note: could use the constraints here (constraintTransformation())</span></div><div class="line"><a name="l03328"></a><span class="lineno"> 3328</span>&#160;    <span class="comment">//       but this is not necessarily accurate and we&#39;re smoothing to</span></div><div class="line"><a name="l03329"></a><span class="lineno"> 3329</span>&#160;    <span class="comment">//       get out of problems.</span></div><div class="line"><a name="l03330"></a><span class="lineno"> 3330</span>&#160;</div><div class="line"><a name="l03331"></a><span class="lineno"> 3331</span>&#160;    <span class="keywordflow">if</span> (featureAttract &lt; 1-0.001)</div><div class="line"><a name="l03332"></a><span class="lineno"> 3332</span>&#160;    {</div><div class="line"><a name="l03333"></a><span class="lineno"> 3333</span>&#160;        <span class="comment">//const PackedBoolList isMasterEdge(syncTools::getMasterEdges(mesh));</span></div><div class="line"><a name="l03334"></a><span class="lineno"> 3334</span>&#160;        <span class="keyword">const</span> <a class="code" href="a01364.html">labelList</a> meshEdges</div><div class="line"><a name="l03335"></a><span class="lineno"> 3335</span>&#160;        (</div><div class="line"><a name="l03336"></a><span class="lineno"> 3336</span>&#160;            pp.<a class="code" href="a01972.html#ac19048ef57f6dd80e2dec2e69709e82d">meshEdges</a>(mesh.<a class="code" href="a01969.html#aae82d34fe433288eb6b1f9dea53675c8">edges</a>(), mesh.<a class="code" href="a01969.html#a9372e15b6f50db75f39f33f24d4887a4">pointEdges</a>())</div><div class="line"><a name="l03337"></a><span class="lineno"> 3337</span>&#160;        );</div><div class="line"><a name="l03338"></a><span class="lineno"> 3338</span>&#160;        <span class="keyword">const</span> <a class="code" href="a01756.html">PackedBoolList</a> isPatchMasterEdge</div><div class="line"><a name="l03339"></a><span class="lineno"> 3339</span>&#160;        (</div><div class="line"><a name="l03340"></a><span class="lineno"> 3340</span>&#160;            <a class="code" href="a01470.html#ab5eff13c92babee0ba0af3caec1d7e87">meshRefinement::getMasterEdges</a></div><div class="line"><a name="l03341"></a><span class="lineno"> 3341</span>&#160;            (</div><div class="line"><a name="l03342"></a><span class="lineno"> 3342</span>&#160;                mesh,</div><div class="line"><a name="l03343"></a><span class="lineno"> 3343</span>&#160;                meshEdges</div><div class="line"><a name="l03344"></a><span class="lineno"> 3344</span>&#160;            )</div><div class="line"><a name="l03345"></a><span class="lineno"> 3345</span>&#160;        );</div><div class="line"><a name="l03346"></a><span class="lineno"> 3346</span>&#160;</div><div class="line"><a name="l03347"></a><span class="lineno"> 3347</span>&#160;        <span class="keyword">const</span> <a class="code" href="a00754.html">vectorField</a> pointNormals</div><div class="line"><a name="l03348"></a><span class="lineno"> 3348</span>&#160;        (</div><div class="line"><a name="l03349"></a><span class="lineno"> 3349</span>&#160;            <a class="code" href="a01815.html#a58be29b3b41b95dc044d8d273cf990a2">PatchTools::pointNormals</a></div><div class="line"><a name="l03350"></a><span class="lineno"> 3350</span>&#160;            (</div><div class="line"><a name="l03351"></a><span class="lineno"> 3351</span>&#160;                mesh,</div><div class="line"><a name="l03352"></a><span class="lineno"> 3352</span>&#160;                pp</div><div class="line"><a name="l03353"></a><span class="lineno"> 3353</span>&#160;            )</div><div class="line"><a name="l03354"></a><span class="lineno"> 3354</span>&#160;        );</div><div class="line"><a name="l03355"></a><span class="lineno"> 3355</span>&#160;</div><div class="line"><a name="l03356"></a><span class="lineno"> 3356</span>&#160;</div><div class="line"><a name="l03357"></a><span class="lineno"> 3357</span>&#160;        <span class="comment">// 1. Smoothed all displacement</span></div><div class="line"><a name="l03358"></a><span class="lineno"> 3358</span>&#160;        <a class="code" href="a00754.html">vectorField</a> smoothedPatchDisp = patchDisp;</div><div class="line"><a name="l03359"></a><span class="lineno"> 3359</span>&#160;        smoothAndConstrain</div><div class="line"><a name="l03360"></a><span class="lineno"> 3360</span>&#160;        (</div><div class="line"><a name="l03361"></a><span class="lineno"> 3361</span>&#160;            isPatchMasterEdge,</div><div class="line"><a name="l03362"></a><span class="lineno"> 3362</span>&#160;            pp,</div><div class="line"><a name="l03363"></a><span class="lineno"> 3363</span>&#160;            meshEdges,</div><div class="line"><a name="l03364"></a><span class="lineno"> 3364</span>&#160;            patchConstraints,</div><div class="line"><a name="l03365"></a><span class="lineno"> 3365</span>&#160;            smoothedPatchDisp</div><div class="line"><a name="l03366"></a><span class="lineno"> 3366</span>&#160;        );</div><div class="line"><a name="l03367"></a><span class="lineno"> 3367</span>&#160;</div><div class="line"><a name="l03368"></a><span class="lineno"> 3368</span>&#160;</div><div class="line"><a name="l03369"></a><span class="lineno"> 3369</span>&#160;        <span class="comment">// 2. Smoothed tangential component</span></div><div class="line"><a name="l03370"></a><span class="lineno"> 3370</span>&#160;        <a class="code" href="a00754.html">vectorField</a> tangPatchDisp = patchDisp;</div><div class="line"><a name="l03371"></a><span class="lineno"> 3371</span>&#160;        tangPatchDisp -= (pointNormals &amp; patchDisp) * pointNormals;</div><div class="line"><a name="l03372"></a><span class="lineno"> 3372</span>&#160;        smoothAndConstrain</div><div class="line"><a name="l03373"></a><span class="lineno"> 3373</span>&#160;        (</div><div class="line"><a name="l03374"></a><span class="lineno"> 3374</span>&#160;            isPatchMasterEdge,</div><div class="line"><a name="l03375"></a><span class="lineno"> 3375</span>&#160;            pp,</div><div class="line"><a name="l03376"></a><span class="lineno"> 3376</span>&#160;            meshEdges,</div><div class="line"><a name="l03377"></a><span class="lineno"> 3377</span>&#160;            patchConstraints,</div><div class="line"><a name="l03378"></a><span class="lineno"> 3378</span>&#160;            tangPatchDisp</div><div class="line"><a name="l03379"></a><span class="lineno"> 3379</span>&#160;        );</div><div class="line"><a name="l03380"></a><span class="lineno"> 3380</span>&#160;</div><div class="line"><a name="l03381"></a><span class="lineno"> 3381</span>&#160;        <span class="comment">// Re-add normal component</span></div><div class="line"><a name="l03382"></a><span class="lineno"> 3382</span>&#160;        tangPatchDisp += (pointNormals &amp; patchDisp) * pointNormals;</div><div class="line"><a name="l03383"></a><span class="lineno"> 3383</span>&#160;</div><div class="line"><a name="l03384"></a><span class="lineno"> 3384</span>&#160;        <span class="keywordflow">if</span> (debug&amp;<a class="code" href="a01470.html#a92dc814ea7fd34acae287945426740d3a42750666a219d68f9028ca726fe4fa71">meshRefinement::ATTRACTION</a>)</div><div class="line"><a name="l03385"></a><span class="lineno"> 3385</span>&#160;        {</div><div class="line"><a name="l03386"></a><span class="lineno"> 3386</span>&#160;            dumpMove</div><div class="line"><a name="l03387"></a><span class="lineno"> 3387</span>&#160;            (</div><div class="line"><a name="l03388"></a><span class="lineno"> 3388</span>&#160;                mesh.<a class="code" href="a00876.html#a48fcf6de2789aff6b430b5fc1a05693f">time</a>().<a class="code" href="a02610.html#a2db7691b348697844893a04d3110e3d5">path</a>()</div><div class="line"><a name="l03389"></a><span class="lineno"> 3389</span>&#160;              / <span class="stringliteral">&quot;tangPatchDispConstrained_&quot;</span> + <a class="code" href="a10733.html#adcb0df2bd4953cb6bb390272d8263c3a">name</a>(iter) + <span class="stringliteral">&quot;.obj&quot;</span>,</div><div class="line"><a name="l03390"></a><span class="lineno"> 3390</span>&#160;                pp.<a class="code" href="a01972.html#a180aa335ba66b3224df33de8eb29b3bf">localPoints</a>(),</div><div class="line"><a name="l03391"></a><span class="lineno"> 3391</span>&#160;                pp.<a class="code" href="a01972.html#a180aa335ba66b3224df33de8eb29b3bf">localPoints</a>() + tangPatchDisp</div><div class="line"><a name="l03392"></a><span class="lineno"> 3392</span>&#160;            );</div><div class="line"><a name="l03393"></a><span class="lineno"> 3393</span>&#160;        }</div><div class="line"><a name="l03394"></a><span class="lineno"> 3394</span>&#160;</div><div class="line"><a name="l03395"></a><span class="lineno"> 3395</span>&#160;        patchDisp =</div><div class="line"><a name="l03396"></a><span class="lineno"> 3396</span>&#160;             (1.0-featureAttract)*smoothedPatchDisp</div><div class="line"><a name="l03397"></a><span class="lineno"> 3397</span>&#160;           + featureAttract*tangPatchDisp;</div><div class="line"><a name="l03398"></a><span class="lineno"> 3398</span>&#160;    }</div><div class="line"><a name="l03399"></a><span class="lineno"> 3399</span>&#160;</div><div class="line"><a name="l03400"></a><span class="lineno"> 3400</span>&#160;</div><div class="line"><a name="l03401"></a><span class="lineno"> 3401</span>&#160;    <span class="keyword">const</span> scalar <a class="code" href="a03001.html#ae7e2b1e87cf8932eba1e615fb13c3a2c">relax</a> = featureAttract;</div><div class="line"><a name="l03402"></a><span class="lineno"> 3402</span>&#160;    patchDisp *= <a class="code" href="a03001.html#ae7e2b1e87cf8932eba1e615fb13c3a2c">relax</a>;</div><div class="line"><a name="l03403"></a><span class="lineno"> 3403</span>&#160;</div><div class="line"><a name="l03404"></a><span class="lineno"> 3404</span>&#160;</div><div class="line"><a name="l03405"></a><span class="lineno"> 3405</span>&#160;    <span class="comment">// Points on zones in one domain but only present as point on other</span></div><div class="line"><a name="l03406"></a><span class="lineno"> 3406</span>&#160;    <span class="comment">// will not do condition 2 on all. Sync explicitly.</span></div><div class="line"><a name="l03407"></a><span class="lineno"> 3407</span>&#160;    <a class="code" href="a02545.html#a197ed77a9101bdfb37253bd3f507c017">syncTools::syncPointList</a></div><div class="line"><a name="l03408"></a><span class="lineno"> 3408</span>&#160;    (</div><div class="line"><a name="l03409"></a><span class="lineno"> 3409</span>&#160;        mesh,</div><div class="line"><a name="l03410"></a><span class="lineno"> 3410</span>&#160;        pp.<a class="code" href="a01972.html#ae4935f85c38392518565dd7c666e3caf">meshPoints</a>(),</div><div class="line"><a name="l03411"></a><span class="lineno"> 3411</span>&#160;        patchDisp,</div><div class="line"><a name="l03412"></a><span class="lineno"> 3412</span>&#160;        <a class="code" href="a01493.html">minMagSqrEqOp&lt;point&gt;</a>(),         <span class="comment">// combine op</span></div><div class="line"><a name="l03413"></a><span class="lineno"> 3413</span>&#160;        <a class="code" href="a10733.html#a7ea82552101f041fad7635b3ed036a84">vector</a>(GREAT, GREAT, GREAT)     <span class="comment">// null value (note: cant use VGREAT)</span></div><div class="line"><a name="l03414"></a><span class="lineno"> 3414</span>&#160;    );</div><div class="line"><a name="l03415"></a><span class="lineno"> 3415</span>&#160;</div><div class="line"><a name="l03416"></a><span class="lineno"> 3416</span>&#160;    <span class="keywordflow">return</span> patchDisp;</div><div class="line"><a name="l03417"></a><span class="lineno"> 3417</span>&#160;}</div><div class="line"><a name="l03418"></a><span class="lineno"> 3418</span>&#160;</div><div class="line"><a name="l03419"></a><span class="lineno"> 3419</span>&#160;</div><div class="line"><a name="l03420"></a><span class="lineno"> 3420</span>&#160;<span class="comment">// ************************************************************************* //</span></div><div class="ttc" id="a10733_html_ac993e906cf2774ae77e666bc24e81733"><div class="ttname"><a href="a10733.html#ac993e906cf2774ae77e666bc24e81733">Foam::max</a></div><div class="ttdeci">dimensioned&lt; Type &gt; max(const dimensioned&lt; Type &gt; &amp;, const dimensioned&lt; Type &gt; &amp;)</div></div>
<div class="ttc" id="a02791_html_ac3b79445511a1e3a6443b59ac93c394a"><div class="ttname"><a href="a02791.html#ac3b79445511a1e3a6443b59ac93c394a">Foam::Vector&lt; scalar &gt;::zero</a></div><div class="ttdeci">static const Vector zero</div><div class="ttdef"><b>Definition:</b> <a href="a09042_source.html#l00080">Vector.H:80</a></div></div>
<div class="ttc" id="a01692_html"><div class="ttname"><a href="a01692.html">Foam::OBJstream</a></div><div class="ttdoc">OFstream which keeps track of vertices. </div><div class="ttdef"><b>Definition:</b> <a href="a09836_source.html#l00053">OBJstream.H:53</a></div></div>
<div class="ttc" id="a10733_html_a643590f4015338d12714af03d61a0ac9"><div class="ttname"><a href="a10733.html#a643590f4015338d12714af03d61a0ac9">Foam::point</a></div><div class="ttdeci">vector point</div><div class="ttdoc">Point is a vector. </div><div class="ttdef"><b>Definition:</b> <a href="a08774_source.html#l00041">point.H:41</a></div></div>
<div class="ttc" id="a00087_html_a8d985300b138b6c5556ab17ed4df3b38"><div class="ttname"><a href="a00087.html#a8d985300b138b6c5556ab17ed4df3b38">Foam::autoPtr::valid</a></div><div class="ttdeci">bool valid() const </div><div class="ttdoc">Return true if the autoPtr valid (ie, the pointer is set). </div><div class="ttdef"><b>Definition:</b> <a href="a08447_source.html#l00083">autoPtrI.H:83</a></div></div>
<div class="ttc" id="a01532_html_a1ff8b2fdb3637d00594b64bf4d72b51d"><div class="ttname"><a href="a01532.html#a1ff8b2fdb3637d00594b64bf4d72b51d">Foam::motionSmootherAlgo::patch</a></div><div class="ttdeci">const indirectPrimitivePatch &amp; patch() const </div><div class="ttdoc">Reference to patch. </div><div class="ttdef"><b>Definition:</b> <a href="a04831_source.html#l00395">motionSmootherAlgo.C:395</a></div></div>
<div class="ttc" id="a02117_html_ae149e1770f0bee2a1c69148fe9c6e6a3"><div class="ttname"><a href="a02117.html#ae149e1770f0bee2a1c69148fe9c6e6a3">Foam::refinementSurfaces::surfZones</a></div><div class="ttdeci">const PtrList&lt; surfaceZonesInfo &gt; &amp; surfZones() const </div><div class="ttdef"><b>Definition:</b> <a href="a07063_source.html#l00152">refinementSurfaces.H:152</a></div></div>
<div class="ttc" id="a01917_html_a4434536d50d4c14116249da802a1e2b2"><div class="ttname"><a href="a01917.html#a4434536d50d4c14116249da802a1e2b2">Foam::polyMesh::faces</a></div><div class="ttdeci">virtual const faceList &amp; faces() const </div><div class="ttdoc">Return raw faces. </div><div class="ttdef"><b>Definition:</b> <a href="a08630_source.html#l01004">polyMesh.C:1004</a></div></div>
<div class="ttc" id="a02502_html_a1f8c08324d9ad320e759f30f23b2d151"><div class="ttname"><a href="a02502.html#a1f8c08324d9ad320e759f30f23b2d151">Foam::surfaceZonesInfo::getUnnamedSurfaces</a></div><div class="ttdeci">static labelList getUnnamedSurfaces(const PtrList&lt; surfaceZonesInfo &gt; &amp;surfList)</div><div class="ttdoc">Get indices of unnamed surfaces (surfaces without faceZoneName) </div><div class="ttdef"><b>Definition:</b> <a href="a07064_source.html#l00184">surfaceZonesInfo.C:184</a></div></div>
<div class="ttc" id="a01917_html_a084ae534298576408f063a6b3b820959"><div class="ttname"><a href="a01917.html#a084ae534298576408f063a6b3b820959">Foam::polyMesh::points</a></div><div class="ttdeci">virtual const pointField &amp; points() const </div><div class="ttdoc">Return raw points. </div><div class="ttdef"><b>Definition:</b> <a href="a08630_source.html#l00979">polyMesh.C:979</a></div></div>
<div class="ttc" id="a07267_html"><div class="ttname"><a href="a07267.html">treeDataPoint.H</a></div></div>
<div class="ttc" id="a10733_html_a929da2a3fdcf3dacbbe0487d3a330dae"><div class="ttname"><a href="a10733.html#a929da2a3fdcf3dacbbe0487d3a330dae">Foam::mag</a></div><div class="ttdeci">dimensioned&lt; scalar &gt; mag(const dimensioned&lt; Type &gt; &amp;)</div></div>
<div class="ttc" id="a01858_html_a20158d89e149ca638d4b63470e420781"><div class="ttname"><a href="a01858.html#a20158d89e149ca638d4b63470e420781">Foam::plane::planePlaneIntersect</a></div><div class="ttdeci">point planePlaneIntersect(const plane &amp;, const plane &amp;) const </div><div class="ttdoc">Return the cutting point between this plane and two other planes. </div><div class="ttdef"><b>Definition:</b> <a href="a08772_source.html#l00406">plane.C:406</a></div></div>
<div class="ttc" id="a10733_html_a22f45a3cb4f074e609f58ebaeef0ecf9"><div class="ttname"><a href="a10733.html#a22f45a3cb4f074e609f58ebaeef0ecf9">Foam::label</a></div><div class="ttdeci">intWM_LABEL_SIZE_t label</div><div class="ttdoc">A label is an int32_t or int64_t as specified by the pre-processor macro WM_LABEL_SIZE. </div><div class="ttdef"><b>Definition:</b> <a href="a08883_source.html#l00059">label.H:59</a></div></div>
<div class="ttc" id="a01885_html"><div class="ttname"><a href="a01885.html">Foam::PointIndexHit</a></div><div class="ttdoc">This class describes the interaction of (usually) a face and a point. It carries the info of a succes...</div><div class="ttdef"><b>Definition:</b> <a href="a08769_source.html#l00053">PointIndexHit.H:53</a></div></div>
<div class="ttc" id="a07728_html_a58548a3fc67fb931bc4e99f94d5f41b8"><div class="ttname"><a href="a07728.html#a58548a3fc67fb931bc4e99f94d5f41b8">WarningInFunction</a></div><div class="ttdeci">#define WarningInFunction</div><div class="ttdoc">Report a warning using Foam::Warning. </div><div class="ttdef"><b>Definition:</b> <a href="a07728_source.html#l00259">messageStream.H:259</a></div></div>
<div class="ttc" id="a04973_html"><div class="ttname"><a href="a04973.html">featureEdgeMesh.H</a></div></div>
<div class="ttc" id="a02502_html_a59d8871cd9c916017046af1f0a57c60f"><div class="ttname"><a href="a02502.html#a59d8871cd9c916017046af1f0a57c60f">Foam::surfaceZonesInfo::getNamedSurfaces</a></div><div class="ttdeci">static labelList getNamedSurfaces(const PtrList&lt; surfaceZonesInfo &gt; &amp;surfList)</div><div class="ttdoc">Get indices of named surfaces (surfaces with faceZoneName) </div><div class="ttdef"><b>Definition:</b> <a href="a07064_source.html#l00205">surfaceZonesInfo.C:205</a></div></div>
<div class="ttc" id="a10733_html_a1cb143a027019075df276006651d7048"><div class="ttname"><a href="a10733.html#a1cb143a027019075df276006651d7048">Foam::labelList</a></div><div class="ttdeci">List&lt; label &gt; labelList</div><div class="ttdoc">A List of labels. </div><div class="ttdef"><b>Definition:</b> <a href="a08887_source.html#l00056">labelList.H:56</a></div></div>
<div class="ttc" id="a01969_html_a9be088de373a98524a153de7da0e92e8"><div class="ttname"><a href="a01969.html#a9be088de373a98524a153de7da0e92e8">Foam::primitiveMesh::nFaces</a></div><div class="ttdeci">label nFaces() const </div><div class="ttdef"><b>Definition:</b> <a href="a08733_source.html#l00088">primitiveMeshI.H:88</a></div></div>
<div class="ttc" id="a01972_html_a3f7e028407f9cc6cc3aa08672f9c1eb6"><div class="ttname"><a href="a01972.html#a3f7e028407f9cc6cc3aa08672f9c1eb6">Foam::PrimitivePatch::faceCentres</a></div><div class="ttdeci">const Field&lt; PointType &gt; &amp; faceCentres() const </div><div class="ttdoc">Return face centres for patch. </div><div class="ttdef"><b>Definition:</b> <a href="a08741_source.html#l00516">PrimitivePatch.C:516</a></div></div>
<div class="ttc" id="a07543_html"><div class="ttname"><a href="a07543.html">indexedOctree.H</a></div></div>
<div class="ttc" id="a01917_html_a6b7f5ba89250dbd7a1c6c7860ab60fe3"><div class="ttname"><a href="a01917.html#a6b7f5ba89250dbd7a1c6c7860ab60fe3">Foam::polyMesh::boundaryMesh</a></div><div class="ttdeci">const polyBoundaryMesh &amp; boundaryMesh() const </div><div class="ttdoc">Return boundary mesh. </div><div class="ttdef"><b>Definition:</b> <a href="a08631_source.html#l00421">polyMesh.H:421</a></div></div>
<div class="ttc" id="a01871_html"><div class="ttname"><a href="a01871.html">Foam::pointConstraint</a></div><div class="ttdoc">Accumulates point constraints through successive applications of the applyConstraint function...</div><div class="ttdef"><b>Definition:</b> <a href="a08130_source.html#l00056">pointConstraint.H:56</a></div></div>
<div class="ttc" id="a02873_html"><div class="ttname"><a href="a02873.html">Foam::word</a></div><div class="ttdoc">A class for handling words, derived from string. </div><div class="ttdef"><b>Definition:</b> <a href="a08985_source.html#l00059">word.H:59</a></div></div>
<div class="ttc" id="a00603_html"><div class="ttname"><a href="a00603.html">Foam::DynamicList&lt; label &gt;</a></div></div>
<div class="ttc" id="a01969_html_aae82d34fe433288eb6b1f9dea53675c8"><div class="ttname"><a href="a01969.html#aae82d34fe433288eb6b1f9dea53675c8">Foam::primitiveMesh::edges</a></div><div class="ttdeci">const edgeList &amp; edges() const </div><div class="ttdoc">Return mesh edges. Uses calcEdges. </div><div class="ttdef"><b>Definition:</b> <a href="a08730_source.html#l00496">primitiveMeshEdges.C:496</a></div></div>
<div class="ttc" id="a10733_html_a919915170941701c1223291531ad010c"><div class="ttname"><a href="a10733.html#a919915170941701c1223291531ad010c">Foam::transform</a></div><div class="ttdeci">dimensionSet transform(const dimensionSet &amp;)</div><div class="ttdef"><b>Definition:</b> <a href="a07878_source.html#l00465">dimensionSet.C:465</a></div></div>
<div class="ttc" id="a02671_html"><div class="ttname"><a href="a02671.html">Foam::treeBoundBox</a></div><div class="ttdoc">Standard boundBox + extra functionality for use in octree. </div><div class="ttdef"><b>Definition:</b> <a href="a08797_source.html#l00075">treeBoundBox.H:75</a></div></div>
<div class="ttc" id="a10733_html_a6e363d070e971ead1a4c40475084e584"><div class="ttname"><a href="a10733.html#a6e363d070e971ead1a4c40475084e584">Foam::scalarField</a></div><div class="ttdeci">Field&lt; scalar &gt; scalarField</div><div class="ttdoc">Specialisation of Field&lt;T&gt; for scalar. </div><div class="ttdef"><b>Definition:</b> <a href="a07963_source.html#l00048">primitiveFieldsFwd.H:48</a></div></div>
<div class="ttc" id="a07063_html"><div class="ttname"><a href="a07063.html">refinementSurfaces.H</a></div></div>
<div class="ttc" id="a00876_html"><div class="ttname"><a href="a00876.html">Foam::fvMesh</a></div><div class="ttdoc">Mesh data needed to do the Finite Volume discretisation. </div><div class="ttdef"><b>Definition:</b> <a href="a05871_source.html#l00078">fvMesh.H:78</a></div></div>
<div class="ttc" id="a01493_html"><div class="ttname"><a href="a01493.html">Foam::minMagSqrEqOp</a></div><div class="ttdef"><b>Definition:</b> <a href="a08907_source.html#l00079">ops.H:79</a></div></div>
<div class="ttc" id="a01368_html"><div class="ttname"><a href="a01368.html">Foam::listPlusEqOp</a></div><div class="ttdef"><b>Definition:</b> <a href="a07030_source.html#l00047">autoSnapDriverFeature.C:47</a></div></div>
<div class="ttc" id="a10733_html_aebb41a148f7cf44b63e12f69e487e49f"><div class="ttname"><a href="a10733.html#aebb41a148f7cf44b63e12f69e487e49f">Foam::cos</a></div><div class="ttdeci">dimensionedScalar cos(const dimensionedScalar &amp;ds)</div><div class="ttdef"><b>Definition:</b> <a href="a07865_source.html#l00256">dimensionedScalar.C:256</a></div></div>
<div class="ttc" id="a01972_html_af5aca3ce69275c80366bc8d5c0584da2"><div class="ttname"><a href="a01972.html#af5aca3ce69275c80366bc8d5c0584da2">Foam::PrimitivePatch::localFaces</a></div><div class="ttdeci">const List&lt; Face &gt; &amp; localFaces() const </div><div class="ttdoc">Return patch faces addressing into local point list. </div><div class="ttdef"><b>Definition:</b> <a href="a08741_source.html#l00388">PrimitivePatch.C:388</a></div></div>
<div class="ttc" id="a07061_html"><div class="ttname"><a href="a07061.html">refinementFeatures.H</a></div></div>
<div class="ttc" id="a00603_html_a7b67b42af715604376ad63a681dee6d8"><div class="ttname"><a href="a00603.html#a7b67b42af715604376ad63a681dee6d8">Foam::DynamicList::append</a></div><div class="ttdeci">DynamicList&lt; T, SizeInc, SizeMult, SizeDiv &gt; &amp; append(const T &amp;)</div><div class="ttdoc">Append an element at the end of the list. </div><div class="ttdef"><b>Definition:</b> <a href="a07628_source.html#l00310">DynamicListI.H:310</a></div></div>
<div class="ttc" id="a10733_html_a501e80d1e14c94973e82f1555e7eb711"><div class="ttname"><a href="a10733.html#a501e80d1e14c94973e82f1555e7eb711">Foam::Info</a></div><div class="ttdeci">messageStream Info</div></div>
<div class="ttc" id="a01756_html"><div class="ttname"><a href="a01756.html">Foam::PackedBoolList</a></div><div class="ttdoc">A bit-packed bool list. </div><div class="ttdef"><b>Definition:</b> <a href="a07648_source.html#l00063">PackedBoolList.H:63</a></div></div>
<div class="ttc" id="a01969_html_a9372e15b6f50db75f39f33f24d4887a4"><div class="ttname"><a href="a01969.html#a9372e15b6f50db75f39f33f24d4887a4">Foam::primitiveMesh::pointEdges</a></div><div class="ttdeci">const labelListList &amp; pointEdges() const </div><div class="ttdef"><b>Definition:</b> <a href="a08730_source.html#l00507">primitiveMeshEdges.C:507</a></div></div>
<div class="ttc" id="a02791_html"><div class="ttname"><a href="a02791.html">Foam::Vector&lt; scalar &gt;</a></div></div>
<div class="ttc" id="a02545_html_a5ed3e64d2ef89e3823674727ea1b3d58"><div class="ttname"><a href="a02545.html#a5ed3e64d2ef89e3823674727ea1b3d58">Foam::syncTools::syncEdgeList</a></div><div class="ttdeci">static void syncEdgeList(const polyMesh &amp;, List&lt; T &gt; &amp;, const CombineOp &amp;cop, const T &amp;nullValue, const TransformOp &amp;top)</div><div class="ttdoc">Synchronize values on all mesh edges. </div><div class="ttdef"><b>Definition:</b> <a href="a08678_source.html#l01141">syncToolsTemplates.C:1141</a></div></div>
<div class="ttc" id="a02033_html_a723361dc2020160f5492e8fe2d09fa44"><div class="ttname"><a href="a02033.html#a723361dc2020160f5492e8fe2d09fa44">Foam::PtrList::size</a></div><div class="ttdeci">label size() const </div><div class="ttdoc">Return the number of elements in the PtrList. </div><div class="ttdef"><b>Definition:</b> <a href="a07656_source.html#l00032">PtrListI.H:32</a></div></div>
<div class="ttc" id="a04830_html"><div class="ttname"><a href="a04830.html">motionSmoother.H</a></div></div>
<div class="ttc" id="a02695_html_a6bc9dc0330d36f5f75e816ddc4ec213e"><div class="ttname"><a href="a02695.html#a6bc9dc0330d36f5f75e816ddc4ec213e">Foam::Tuple2::first</a></div><div class="ttdeci">const Type1 &amp; first() const </div><div class="ttdoc">Return first. </div><div class="ttdef"><b>Definition:</b> <a href="a09028_source.html#l00094">Tuple2.H:94</a></div></div>
<div class="ttc" id="a00603_html_ac8bb3912a3ce86b15842e79d0b421204"><div class="ttname"><a href="a00603.html#ac8bb3912a3ce86b15842e79d0b421204">Foam::DynamicList::clear</a></div><div class="ttdeci">void clear()</div><div class="ttdoc">Clear the addressed list, i.e. set the size to zero. </div><div class="ttdef"><b>Definition:</b> <a href="a07628_source.html#l00242">DynamicListI.H:242</a></div></div>
<div class="ttc" id="a02610_html_a2db7691b348697844893a04d3110e3d5"><div class="ttname"><a href="a02610.html#a2db7691b348697844893a04d3110e3d5">Foam::Time::path</a></div><div class="ttdeci">fileName path() const </div><div class="ttdoc">Return path. </div><div class="ttdef"><b>Definition:</b> <a href="a07855_source.html#l00281">Time.H:281</a></div></div>
<div class="ttc" id="a10733_html_a7ffd6af4acc2eb9ba72ee296b5ecda23"><div class="ttname"><a href="a10733.html#a7ffd6af4acc2eb9ba72ee296b5ecda23">Foam::reduce</a></div><div class="ttdeci">void reduce(const List&lt; UPstream::commsStruct &gt; &amp;comms, T &amp;Value, const BinaryOp &amp;bop, const int tag, const label comm)</div><div class="ttdef"><b>Definition:</b> <a href="a07798_source.html#l00043">PstreamReduceOps.H:43</a></div></div>
<div class="ttc" id="a01935_html_a861f370e41af7d54d7ff91da65de6e6a"><div class="ttname"><a href="a01935.html#a861f370e41af7d54d7ff91da65de6e6a">Foam::polyPatch::start</a></div><div class="ttdeci">label start() const </div><div class="ttdoc">Return start label of this patch in the polyMesh face list. </div><div class="ttdef"><b>Definition:</b> <a href="a08672_source.html#l00300">polyPatch.H:300</a></div></div>
<div class="ttc" id="a01969_html_a460495623a8ec621b95f93bbcb3d4773"><div class="ttname"><a href="a01969.html#a460495623a8ec621b95f93bbcb3d4773">Foam::primitiveMesh::faceAreas</a></div><div class="ttdeci">const vectorField &amp; faceAreas() const </div><div class="ttdef"><b>Definition:</b> <a href="a08731_source.html#l00151">primitiveMeshFaceCentresAndAreas.C:151</a></div></div>
<div class="ttc" id="a10733_html_af706f965be4d1457b0f1e7fade1c0118"><div class="ttname"><a href="a10733.html#af706f965be4d1457b0f1e7fade1c0118">Foam::degToRad</a></div><div class="ttdeci">scalar degToRad(const scalar deg)</div><div class="ttdoc">Conversion from degrees to radians. </div><div class="ttdef"><b>Definition:</b> <a href="a08181_source.html#l00045">unitConversion.H:45</a></div></div>
<div class="ttc" id="a07029_html"><div class="ttname"><a href="a07029.html">autoSnapDriver.H</a></div></div>
<div class="ttc" id="a01059_html"><div class="ttname"><a href="a01059.html">Foam::IndirectList</a></div><div class="ttdoc">A List with indirect addressing. </div><div class="ttdef"><b>Definition:</b> <a href="a07635_source.html#l00102">IndirectList.H:102</a></div></div>
<div class="ttc" id="a01972_html_ac19048ef57f6dd80e2dec2e69709e82d"><div class="ttname"><a href="a01972.html#ac19048ef57f6dd80e2dec2e69709e82d">Foam::PrimitivePatch::meshEdges</a></div><div class="ttdeci">labelList meshEdges(const edgeList &amp;allEdges, const labelListList &amp;cellEdges, const labelList &amp;faceCells) const </div><div class="ttdoc">Return labels of patch edges in the global edge list using. </div><div class="ttdef"><b>Definition:</b> <a href="a08751_source.html#l00041">PrimitivePatchMeshEdges.C:41</a></div></div>
<div class="ttc" id="a10733_html_a06ca7250d8e89caf05243ec094843642"><div class="ttname"><a href="a10733.html#a06ca7250d8e89caf05243ec094843642">Foam::exit</a></div><div class="ttdeci">errorManipArg&lt; error, int &gt; exit(error &amp;err, const int errNo=1)</div><div class="ttdef"><b>Definition:</b> <a href="a07725_source.html#l00124">errorManip.H:124</a></div></div>
<div class="ttc" id="a07669_html_a1a02bffef961ee015f0e9b03d336c6a9"><div class="ttname"><a href="a07669.html#a1a02bffef961ee015f0e9b03d336c6a9">forAll</a></div><div class="ttdeci">#define forAll(list, i)</div><div class="ttdoc">Loop across all elements in list. </div><div class="ttdef"><b>Definition:</b> <a href="a07669_source.html#l00406">UList.H:406</a></div></div>
<div class="ttc" id="a02117_html_a1216e33f4746b2776b87629c0510fa3b"><div class="ttname"><a href="a02117.html#a1216e33f4746b2776b87629c0510fa3b">Foam::refinementSurfaces::globalRegion</a></div><div class="ttdeci">label globalRegion(const label surfI, const label regionI) const </div><div class="ttdoc">From surface and region on surface to global region. </div><div class="ttdef"><b>Definition:</b> <a href="a07063_source.html#l00197">refinementSurfaces.H:197</a></div></div>
<div class="ttc" id="a04428_html_a5131998e20f3c5a8bd03cf9b48cc76c7"><div class="ttname"><a href="a04428.html#a5131998e20f3c5a8bd03cf9b48cc76c7">rndGen</a></div><div class="ttdeci">cachedRandom rndGen(label(0),-1)</div></div>
<div class="ttc" id="a01364_html"><div class="ttname"><a href="a01364.html">Foam::List</a></div><div class="ttdoc">A 1D array of objects of type &lt;T&gt;, where the size of the vector is known and used for subscript bound...</div><div class="ttdef"><b>Definition:</b> <a href="a07575_source.html#l00059">HashTable.H:59</a></div></div>
<div class="ttc" id="a08181_html"><div class="ttname"><a href="a08181.html">unitConversion.H</a></div><div class="ttdoc">Unit conversion functions. </div></div>
<div class="ttc" id="a02064_html"><div class="ttname"><a href="a02064.html">Foam::Random</a></div><div class="ttdoc">Simple random number generator. </div><div class="ttdef"><b>Definition:</b> <a href="a08919_source.html#l00049">Random.H:49</a></div></div>
<div class="ttc" id="a01935_html"><div class="ttname"><a href="a01935.html">Foam::polyPatch</a></div><div class="ttdoc">A patch is a list of labels that address the faces in the global face list. </div><div class="ttdef"><b>Definition:</b> <a href="a08672_source.html#l00066">polyPatch.H:66</a></div></div>
<div class="ttc" id="a10733_html_acac9122dd09fe8b931de9af18f7f4ead"><div class="ttname"><a href="a10733.html#acac9122dd09fe8b931de9af18f7f4ead">Foam::labelMax</a></div><div class="ttdeci">static const label labelMax</div><div class="ttdef"><b>Definition:</b> <a href="a08883_source.html#l00062">label.H:62</a></div></div>
<div class="ttc" id="a02735_html_a1c9828bc3de9502754d944c95a2ce0d9"><div class="ttname"><a href="a02735.html#a1c9828bc3de9502754d944c95a2ce0d9">Foam::UList::first</a></div><div class="ttdeci">T &amp; first()</div><div class="ttdoc">Return the first element of the list. </div><div class="ttdef"><b>Definition:</b> <a href="a07670_source.html#l00117">UListI.H:117</a></div></div>
<div class="ttc" id="a01972_html_a9927abeba2c8506177084d644b6e573a"><div class="ttname"><a href="a01972.html#a9927abeba2c8506177084d644b6e573a">Foam::PrimitivePatch::nPoints</a></div><div class="ttdeci">label nPoints() const </div><div class="ttdoc">Return number of points supporting patch faces. </div><div class="ttdef"><b>Definition:</b> <a href="a08743_source.html#l00295">PrimitivePatch.H:295</a></div></div>
<div class="ttc" id="a02113_html_a54a38a30d12368aeb05534de2e216f3d"><div class="ttname"><a href="a02113.html#a54a38a30d12368aeb05534de2e216f3d">Foam::refinementFeatures::findNearestEdge</a></div><div class="ttdeci">void findNearestEdge(const pointField &amp;samples, const scalarField &amp;nearestDistSqr, labelList &amp;nearFeature, List&lt; pointIndexHit &gt; &amp;nearInfo, vectorField &amp;nearNormal) const </div><div class="ttdoc">Find nearest point on nearest feature edge. Sets. </div><div class="ttdef"><b>Definition:</b> <a href="a07060_source.html#l00525">refinementFeatures.C:525</a></div></div>
<div class="ttc" id="a02900_html_a09614eb35eb88968e053707fde62f274"><div class="ttname"><a href="a02900.html#a09614eb35eb88968e053707fde62f274">Foam::ZoneMesh::findZoneID</a></div><div class="ttdeci">label findZoneID(const word &amp;zoneName) const </div><div class="ttdoc">Find zone index given a name. </div><div class="ttdef"><b>Definition:</b> <a href="a08700_source.html#l00348">ZoneMesh.C:348</a></div></div>
<div class="ttc" id="a02735_html_af4d05e19e6cdc80f0c7acd5bbe250f69"><div class="ttname"><a href="a02735.html#af4d05e19e6cdc80f0c7acd5bbe250f69">Foam::UList::fcIndex</a></div><div class="ttdeci">label fcIndex(const label i) const </div><div class="ttdoc">Return the forward circular index, i.e. the next index. </div><div class="ttdef"><b>Definition:</b> <a href="a07670_source.html#l00058">UListI.H:58</a></div></div>
<div class="ttc" id="a08705_html"><div class="ttname"><a href="a08705.html">PatchTools.H</a></div></div>
<div class="ttc" id="a00087_html"><div class="ttname"><a href="a00087.html">Foam::autoPtr</a></div><div class="ttdoc">An auto-pointer similar to the STL auto_ptr but with automatic casting to a reference to the type and...</div><div class="ttdef"><b>Definition:</b> <a href="a07655_source.html#l00117">PtrList.H:117</a></div></div>
<div class="ttc" id="a02117_html_adcd7311efdf37e4637a13fa45dd405ef"><div class="ttname"><a href="a02117.html#adcd7311efdf37e4637a13fa45dd405ef">Foam::refinementSurfaces::surfaces</a></div><div class="ttdeci">const labelList &amp; surfaces() const </div><div class="ttdef"><b>Definition:</b> <a href="a07063_source.html#l00141">refinementSurfaces.H:141</a></div></div>
<div class="ttc" id="a01470_html_a92dc814ea7fd34acae287945426740d3a42750666a219d68f9028ca726fe4fa71"><div class="ttname"><a href="a01470.html#a92dc814ea7fd34acae287945426740d3a42750666a219d68f9028ca726fe4fa71">Foam::meshRefinement::ATTRACTION</a></div><div class="ttdef"><b>Definition:</b> <a href="a07051_source.html#l00104">meshRefinement.H:104</a></div></div>
<div class="ttc" id="a10733_html"><div class="ttname"><a href="a10733.html">Foam</a></div><div class="ttdoc">Namespace for OpenFOAM. </div><div class="ttdef"><b>Definition:</b> <a href="a04628_source.html#l00030">combustionModel.C:30</a></div></div>
<div class="ttc" id="a02362_html"><div class="ttname"><a href="a02362.html">Foam::snapParameters</a></div><div class="ttdoc">Simple container to keep together snap specific information. </div><div class="ttdef"><b>Definition:</b> <a href="a07039_source.html#l00052">snapParameters.H:52</a></div></div>
<div class="ttc" id="a04729_html_a4c1de256df6b3d186a85745b3149394a"><div class="ttname"><a href="a04729.html#a4c1de256df6b3d186a85745b3149394a">mesh</a></div><div class="ttdeci">dynamicFvMesh &amp; mesh</div><div class="ttdef"><b>Definition:</b> <a href="a04729_source.html#l00018">createDynamicFvMesh.H:18</a></div></div>
<div class="ttc" id="a10733_html_a8cdb0ba0633c91ed7041368519cd217c"><div class="ttname"><a href="a10733.html#a8cdb0ba0633c91ed7041368519cd217c">Foam::diag</a></div><div class="ttdeci">void diag(pointPatchField&lt; vector &gt; &amp;, const pointPatchField&lt; tensor &gt; &amp;)</div><div class="ttdef"><b>Definition:</b> <a href="a08134_source.html#l00262">pointPatchFieldFunctions.H:262</a></div></div>
<div class="ttc" id="a07006_html_a830e93cc5b8d859299d1a788c12be8ac"><div class="ttname"><a href="a07006.html#a830e93cc5b8d859299d1a788c12be8ac">n</a></div><div class="ttdeci">label n</div><div class="ttdef"><b>Definition:</b> <a href="a07006_source.html#l00031">TABSMDCalcMethod2.H:31</a></div></div>
<div class="ttc" id="a00611_html_ab53e2468b3b9d33c35dc8be5c6867e0f"><div class="ttname"><a href="a00611.html#ab53e2468b3b9d33c35dc8be5c6867e0f">Foam::edge::otherVertex</a></div><div class="ttdeci">label otherVertex(const label a) const </div><div class="ttdoc">Given one vertex, return the other. </div><div class="ttdef"><b>Definition:</b> <a href="a08522_source.html#l00103">edgeI.H:103</a></div></div>
<div class="ttc" id="a01364_html_a8a5f6fa29bd4b500caf186f60245b384"><div class="ttname"><a href="a01364.html#a8a5f6fa29bd4b500caf186f60245b384">Foam::List::size</a></div><div class="ttdeci">void size(const label)</div><div class="ttdoc">Override size to be inconsistent with allocated storage. </div><div class="ttdef"><b>Definition:</b> <a href="a07639_source.html#l00076">ListI.H:76</a></div></div>
<div class="ttc" id="a02362_html_a9beb196b6dd5025bfc4d4adad6eddce8"><div class="ttname"><a href="a02362.html#a9beb196b6dd5025bfc4d4adad6eddce8">Foam::snapParameters::implicitFeatureSnap</a></div><div class="ttdeci">Switch implicitFeatureSnap() const </div><div class="ttdef"><b>Definition:</b> <a href="a07039_source.html#l00135">snapParameters.H:135</a></div></div>
<div class="ttc" id="a01885_html_a7d1e8acadb27bd2b4e61457d47b71b6f"><div class="ttname"><a href="a01885.html#a7d1e8acadb27bd2b4e61457d47b71b6f">Foam::PointIndexHit::index</a></div><div class="ttdeci">label index() const </div><div class="ttdoc">Return index. </div><div class="ttdef"><b>Definition:</b> <a href="a08769_source.html#l00111">PointIndexHit.H:111</a></div></div>
<div class="ttc" id="a01871_html_a1c47e7042699d937ffa928bbdcf19556"><div class="ttname"><a href="a01871.html#a1c47e7042699d937ffa928bbdcf19556">Foam::pointConstraint::applyConstraint</a></div><div class="ttdeci">void applyConstraint(const vector &amp;cd)</div><div class="ttdoc">Apply and accumulate the effect of the given constraint direction. </div><div class="ttdef"><b>Definition:</b> <a href="a08131_source.html#l00048">pointConstraintI.H:48</a></div></div>
<div class="ttc" id="a10733_html_a8d528a67d2a9c6fe4fb94bc86872624b"><div class="ttname"><a href="a10733.html#a8d528a67d2a9c6fe4fb94bc86872624b">Foam::returnReduce</a></div><div class="ttdeci">T returnReduce(const T &amp;Value, const BinaryOp &amp;bop, const int tag=Pstream::msgType(), const label comm=UPstream::worldComm)</div><div class="ttdef"><b>Definition:</b> <a href="a07798_source.html#l00086">PstreamReduceOps.H:86</a></div></div>
<div class="ttc" id="a02117_html_a5ce86015ef1926009d3bee3cc1b1784c"><div class="ttname"><a href="a02117.html#a5ce86015ef1926009d3bee3cc1b1784c">Foam::refinementSurfaces::findNearestRegion</a></div><div class="ttdeci">void findNearestRegion(const labelList &amp;surfacesToTest, const pointField &amp;samples, const scalarField &amp;nearestDistSqr, labelList &amp;hitSurface, labelList &amp;hitRegion) const </div><div class="ttdoc">Find nearest point on surfaces. Return surface and region on. </div><div class="ttdef"><b>Definition:</b> <a href="a07062_source.html#l01089">refinementSurfaces.C:1089</a></div></div>
<div class="ttc" id="a04438_html_a334650304cdcdff41898bee9eaf2e3db"><div class="ttname"><a href="a04438.html#a334650304cdcdff41898bee9eaf2e3db">p</a></div><div class="ttdeci">volScalarField &amp; p</div><div class="ttdef"><b>Definition:</b> <a href="a04438_source.html#l00051">createFields.H:51</a></div></div>
<div class="ttc" id="a00714_html"><div class="ttname"><a href="a00714.html">Foam::face</a></div><div class="ttdoc">A face is a list of labels corresponding to mesh vertices. </div><div class="ttdef"><b>Definition:</b> <a href="a08528_source.html#l00075">face.H:75</a></div></div>
<div class="ttc" id="a10749_html_a8d66fa4b7d96f0523ff86522f1d01c6f"><div class="ttname"><a href="a10749.html#a8d66fa4b7d96f0523ff86522f1d01c6f">Foam::constant::universal::c</a></div><div class="ttdeci">const dimensionedScalar c</div><div class="ttdoc">Speed of light in a vacuum. </div></div>
<div class="ttc" id="a10733_html_ae6fff2c6981e6d9618aa5038e69def6e"><div class="ttname"><a href="a10733.html#ae6fff2c6981e6d9618aa5038e69def6e">Foam::magSqr</a></div><div class="ttdeci">dimensioned&lt; scalar &gt; magSqr(const dimensioned&lt; Type &gt; &amp;)</div></div>
<div class="ttc" id="a06985_html_a9336ebf25087d91c818ee6e9ec29f8c1"><div class="ttname"><a href="a06985.html#a9336ebf25087d91c818ee6e9ec29f8c1">x</a></div><div class="ttdeci">x</div><div class="ttdef"><b>Definition:</b> <a href="a06985_source.html#l00052">LISASMDCalcMethod2.H:52</a></div></div>
<div class="ttc" id="a10733_html_a86079a031eeab35048e976435c8d4bae"><div class="ttname"><a href="a10733.html#a86079a031eeab35048e976435c8d4bae">Foam::nearInfo</a></div><div class="ttdeci">Tuple2&lt; scalar, label &gt; nearInfo</div><div class="ttdoc">Private class for finding nearest. </div><div class="ttdef"><b>Definition:</b> <a href="a09719_source.html#l00064">sampledTriSurfaceMesh.C:64</a></div></div>
<div class="ttc" id="a10733_html_adcb0df2bd4953cb6bb390272d8263c3a"><div class="ttname"><a href="a10733.html#adcb0df2bd4953cb6bb390272d8263c3a">Foam::name</a></div><div class="ttdeci">word name(const complex &amp;)</div><div class="ttdoc">Return a string representation of a complex. </div><div class="ttdef"><b>Definition:</b> <a href="a08813_source.html#l00047">complex.C:47</a></div></div>
<div class="ttc" id="a01815_html_a58be29b3b41b95dc044d8d273cf990a2"><div class="ttname"><a href="a01815.html#a58be29b3b41b95dc044d8d273cf990a2">Foam::PatchTools::pointNormals</a></div><div class="ttdeci">static tmp&lt; pointField &gt; pointNormals(const polyMesh &amp;, const PrimitivePatch&lt; Face, FaceList, PointField, PointType &gt; &amp;)</div><div class="ttdoc">Return parallel consistent point normals for patches using mesh points. </div></div>
<div class="ttc" id="a02695_html_a5d570a89988f907024eede54003b8a79"><div class="ttname"><a href="a02695.html#a5d570a89988f907024eede54003b8a79">Foam::Tuple2::second</a></div><div class="ttdeci">const Type2 &amp; second() const </div><div class="ttdoc">Return second. </div><div class="ttdef"><b>Definition:</b> <a href="a09028_source.html#l00106">Tuple2.H:106</a></div></div>
<div class="ttc" id="a02362_html_a3296425edf549e49f202c712b2e7bc92"><div class="ttname"><a href="a02362.html#a3296425edf549e49f202c712b2e7bc92">Foam::snapParameters::explicitFeatureSnap</a></div><div class="ttdeci">Switch explicitFeatureSnap() const </div><div class="ttdef"><b>Definition:</b> <a href="a07039_source.html#l00130">snapParameters.H:130</a></div></div>
<div class="ttc" id="a01972_html_a1db9478309c639504a743b7b194226f4"><div class="ttname"><a href="a01972.html#a1db9478309c639504a743b7b194226f4">Foam::PrimitivePatch::nEdges</a></div><div class="ttdeci">label nEdges() const </div><div class="ttdoc">Return number of edges in patch. </div><div class="ttdef"><b>Definition:</b> <a href="a08743_source.html#l00301">PrimitivePatch.H:301</a></div></div>
<div class="ttc" id="a10733_html_a2e0318a3a140a9ee64174b45fbfd45f0"><div class="ttname"><a href="a10733.html#a2e0318a3a140a9ee64174b45fbfd45f0">Foam::linePointRef</a></div><div class="ttdeci">line&lt; point, const point &amp; &gt; linePointRef</div><div class="ttdoc">Line using referred points. </div><div class="ttdef"><b>Definition:</b> <a href="a08762_source.html#l00045">linePointRef.H:45</a></div></div>
<div class="ttc" id="a10733_html_a2db8fe02a0d3909e9351bb4275b23ce4"><div class="ttname"><a href="a10733.html#a2db8fe02a0d3909e9351bb4275b23ce4">Foam::endl</a></div><div class="ttdeci">Ostream &amp; endl(Ostream &amp;os)</div><div class="ttdoc">Add newline and flush stream. </div><div class="ttdef"><b>Definition:</b> <a href="a07784_source.html#l00251">Ostream.H:251</a></div></div>
<div class="ttc" id="a01863_html"><div class="ttname"><a href="a01863.html">Foam::plusEqOp</a></div><div class="ttdef"><b>Definition:</b> <a href="a08907_source.html#l00071">ops.H:71</a></div></div>
<div class="ttc" id="a10733_html_acf128ea037506c14446998bb7ca39264"><div class="ttname"><a href="a10733.html#acf128ea037506c14446998bb7ca39264">Foam::sortedOrder</a></div><div class="ttdeci">void sortedOrder(const UList&lt; T &gt; &amp;, labelList &amp;order)</div><div class="ttdoc">Generate the (stable) sort order for the list. </div><div class="ttdef"><b>Definition:</b> <a href="a07646_source.html#l00179">ListOpsTemplates.C:179</a></div></div>
<div class="ttc" id="a02675_html"><div class="ttname"><a href="a02675.html">Foam::treeDataPoint</a></div><div class="ttdoc">Holds (reference to) pointField. Encapsulation of data needed for octree searches. Used for searching for nearest point. No bounding boxes around points. Only overlaps and calcNearest are implemented, rest makes little sense. </div><div class="ttdef"><b>Definition:</b> <a href="a07267_source.html#l00059">treeDataPoint.H:59</a></div></div>
<div class="ttc" id="a01368_html_ae4420a9fd791f5ab9ebad1a3150ba899"><div class="ttname"><a href="a01368.html#ae4420a9fd791f5ab9ebad1a3150ba899">Foam::listPlusEqOp::operator()</a></div><div class="ttdeci">void operator()(List&lt; T &gt; &amp;x, const List&lt; T &gt; &amp;y) const </div><div class="ttdef"><b>Definition:</b> <a href="a07030_source.html#l00051">autoSnapDriverFeature.C:51</a></div></div>
<div class="ttc" id="a02663_html"><div class="ttname"><a href="a02663.html">Foam::mapDistribute::transform</a></div><div class="ttdoc">Default transformation behaviour. </div><div class="ttdef"><b>Definition:</b> <a href="a08613_source.html#l00249">mapDistribute.H:249</a></div></div>
<div class="ttc" id="a01972_html_a758f775d09e1be4cdd80daea4e402f55"><div class="ttname"><a href="a01972.html#a758f775d09e1be4cdd80daea4e402f55">Foam::PrimitivePatch::pointFaces</a></div><div class="ttdeci">const labelListList &amp; pointFaces() const </div><div class="ttdoc">Return point-face addressing. </div><div class="ttdef"><b>Definition:</b> <a href="a08741_source.html#l00368">PrimitivePatch.C:368</a></div></div>
<div class="ttc" id="a01935_html_acffd678e538fc569f301aacdb4f019b7"><div class="ttname"><a href="a01935.html#acffd678e538fc569f301aacdb4f019b7">Foam::polyPatch::coupled</a></div><div class="ttdeci">virtual bool coupled() const </div><div class="ttdoc">Return true if this patch is geometrically coupled (i.e. faces and. </div><div class="ttdef"><b>Definition:</b> <a href="a08672_source.html#l00310">polyPatch.H:310</a></div></div>
<div class="ttc" id="a01054_html_abd186b2cbd8c6def61dc033a4892b847"><div class="ttname"><a href="a01054.html#abd186b2cbd8c6def61dc033a4892b847">Foam::indexedOctree::shapes</a></div><div class="ttdeci">const Type &amp; shapes() const </div><div class="ttdoc">Reference to shape. </div><div class="ttdef"><b>Definition:</b> <a href="a07543_source.html#l00449">indexedOctree.H:449</a></div></div>
<div class="ttc" id="a08677_html"><div class="ttname"><a href="a08677.html">syncTools.H</a></div></div>
<div class="ttc" id="a03926_html_a888be93833ac7a23170555c69c690288"><div class="ttname"><a href="a03926.html#a888be93833ac7a23170555c69c690288">f</a></div><div class="ttdeci">labelList f(nPoints)</div></div>
<div class="ttc" id="a10733_html_a8616bd62eebf2342a80222fecb1bda71"><div class="ttname"><a href="a10733.html#a8616bd62eebf2342a80222fecb1bda71">Foam::sqrt</a></div><div class="ttdeci">dimensionedScalar sqrt(const dimensionedScalar &amp;ds)</div><div class="ttdef"><b>Definition:</b> <a href="a07865_source.html#l00142">dimensionedScalar.C:142</a></div></div>
<div class="ttc" id="a01972_html_ae4935f85c38392518565dd7c666e3caf"><div class="ttname"><a href="a01972.html#ae4935f85c38392518565dd7c666e3caf">Foam::PrimitivePatch::meshPoints</a></div><div class="ttdeci">const labelList &amp; meshPoints() const </div><div class="ttdoc">Return labelList of mesh points in patch. They are constructed. </div><div class="ttdef"><b>Definition:</b> <a href="a08741_source.html#l00408">PrimitivePatch.C:408</a></div></div>
<div class="ttc" id="a01858_html"><div class="ttname"><a href="a01858.html">Foam::plane</a></div><div class="ttdoc">Geometric class that creates a 2D plane and can return the intersection point between a line and the ...</div><div class="ttdef"><b>Definition:</b> <a href="a08773_source.html#l00060">plane.H:60</a></div></div>
<div class="ttc" id="a02695_html"><div class="ttname"><a href="a02695.html">Foam::Tuple2</a></div><div class="ttdoc">A 2-tuple for storing two objects of different types. </div><div class="ttdef"><b>Definition:</b> <a href="a09028_source.html#l00047">Tuple2.H:47</a></div></div>
<div class="ttc" id="a00754_html"><div class="ttname"><a href="a00754.html">Foam::Field&lt; vector &gt;</a></div></div>
<div class="ttc" id="a06984_html_afa8b67a0d5607da908ad92ed485e19e8"><div class="ttname"><a href="a06984.html#afa8b67a0d5607da908ad92ed485e19e8">y</a></div><div class="ttdeci">scalar y</div><div class="ttdef"><b>Definition:</b> <a href="a06984_source.html#l00014">LISASMDCalcMethod1.H:14</a></div></div>
<div class="ttc" id="a01969_html_aa1eec60bd258a70018b8ffda0dced7bb"><div class="ttname"><a href="a01969.html#aa1eec60bd258a70018b8ffda0dced7bb">Foam::primitiveMesh::nInternalFaces</a></div><div class="ttdeci">label nInternalFaces() const </div><div class="ttdef"><b>Definition:</b> <a href="a08733_source.html#l00082">primitiveMeshI.H:82</a></div></div>
<div class="ttc" id="a02117_html"><div class="ttname"><a href="a02117.html">Foam::refinementSurfaces</a></div><div class="ttdoc">Container for data on surfaces used for surface-driven refinement. Contains all the data about the le...</div><div class="ttdef"><b>Definition:</b> <a href="a07063_source.html#l00060">refinementSurfaces.H:60</a></div></div>
<div class="ttc" id="a00740_html"><div class="ttname"><a href="a00740.html">Foam::faceZone</a></div><div class="ttdoc">A subset of mesh faces organised as a primitive patch. </div><div class="ttdef"><b>Definition:</b> <a href="a08684_source.html#l00064">faceZone.H:64</a></div></div>
<div class="ttc" id="a02517_html"><div class="ttname"><a href="a02517.html">Foam::Switch</a></div><div class="ttdoc">A simple wrapper around bool so that it can be read as a word: true/false, on/off, yes/no, y/n, t/f, or none. </div><div class="ttdef"><b>Definition:</b> <a href="a08807_source.html#l00060">Switch.H:60</a></div></div>
<div class="ttc" id="a10733_html_a123bf349eca926d6984b23e5e067d8b9"><div class="ttname"><a href="a10733.html#a123bf349eca926d6984b23e5e067d8b9">Foam::labelPair</a></div><div class="ttdeci">Pair&lt; label &gt; labelPair</div><div class="ttdoc">Label pair. </div><div class="ttdef"><b>Definition:</b> <a href="a08908_source.html#l00048">labelPair.H:48</a></div></div>
<div class="ttc" id="a00611_html"><div class="ttname"><a href="a00611.html">Foam::edge</a></div><div class="ttdoc">An edge is a list of two point labels. The functionality it provides supports the discretisation on a...</div><div class="ttdef"><b>Definition:</b> <a href="a08521_source.html#l00058">edge.H:58</a></div></div>
<div class="ttc" id="a01720_html"><div class="ttname"><a href="a01720.html">Foam::orEqOp</a></div><div class="ttdef"><b>Definition:</b> <a href="a08907_source.html#l00082">ops.H:82</a></div></div>
<div class="ttc" id="a01972_html_aae82d34fe433288eb6b1f9dea53675c8"><div class="ttname"><a href="a01972.html#aae82d34fe433288eb6b1f9dea53675c8">Foam::PrimitivePatch::edges</a></div><div class="ttdeci">const edgeList &amp; edges() const </div><div class="ttdoc">Return list of edges, address into LOCAL point list. </div><div class="ttdef"><b>Definition:</b> <a href="a08741_source.html#l00228">PrimitivePatch.C:228</a></div></div>
<div class="ttc" id="a02362_html_aadaf99e1219953afcef1749915d6a2cc"><div class="ttname"><a href="a02362.html#aadaf99e1219953afcef1749915d6a2cc">Foam::snapParameters::multiRegionFeatureSnap</a></div><div class="ttdeci">Switch multiRegionFeatureSnap() const </div><div class="ttdef"><b>Definition:</b> <a href="a07039_source.html#l00140">snapParameters.H:140</a></div></div>
<div class="ttc" id="a02078_html"><div class="ttname"><a href="a02078.html">Foam::plane::ray</a></div><div class="ttdoc">A direction and a reference point. </div><div class="ttdef"><b>Definition:</b> <a href="a08773_source.html#l00073">plane.H:73</a></div></div>
<div class="ttc" id="a10733_html_a29558ed008131ebedb6c3b965e9f4175"><div class="ttname"><a href="a10733.html#a29558ed008131ebedb6c3b965e9f4175">Foam::pointIndexHit</a></div><div class="ttdeci">PointIndexHit&lt; point &gt; pointIndexHit</div><div class="ttdef"><b>Definition:</b> <a href="a08768_source.html#l00042">pointIndexHit.H:42</a></div></div>
<div class="ttc" id="a08773_html"><div class="ttname"><a href="a08773.html">plane.H</a></div></div>
<div class="ttc" id="a10733_html_a7ea82552101f041fad7635b3ed036a84"><div class="ttname"><a href="a10733.html#a7ea82552101f041fad7635b3ed036a84">Foam::vector</a></div><div class="ttdeci">Vector&lt; scalar &gt; vector</div><div class="ttdoc">A scalar version of the templated Vector. </div><div class="ttdef"><b>Definition:</b> <a href="a09045_source.html#l00049">vector.H:49</a></div></div>
<div class="ttc" id="a01054_html"><div class="ttname"><a href="a01054.html">Foam::indexedOctree</a></div><div class="ttdoc">Non-pointer based hierarchical recursive searching. </div><div class="ttdef"><b>Definition:</b> <a href="a07263_source.html#l00047">treeDataEdge.H:47</a></div></div>
<div class="ttc" id="a01885_html_ad963d38a624b8bf8b37c210109dba03c"><div class="ttname"><a href="a01885.html#ad963d38a624b8bf8b37c210109dba03c">Foam::PointIndexHit::hit</a></div><div class="ttdeci">bool hit() const </div><div class="ttdoc">Is there a hit. </div><div class="ttdef"><b>Definition:</b> <a href="a08769_source.html#l00105">PointIndexHit.H:105</a></div></div>
<div class="ttc" id="a01364_html_a399dd2bf0d9a32016717dc90126f016b"><div class="ttname"><a href="a01364.html#a399dd2bf0d9a32016717dc90126f016b">Foam::List::append</a></div><div class="ttdeci">void append(const T &amp;)</div><div class="ttdoc">Append an element at the end of the list. </div><div class="ttdef"><b>Definition:</b> <a href="a07639_source.html#l00097">ListI.H:97</a></div></div>
<div class="ttc" id="a02666_html"><div class="ttname"><a href="a02666.html">Foam::mapDistribute::transformPosition</a></div><div class="ttdoc">Default transformation behaviour for position. </div><div class="ttdef"><b>Definition:</b> <a href="a08613_source.html#l00302">mapDistribute.H:302</a></div></div>
<div class="ttc" id="a01969_html_a758f775d09e1be4cdd80daea4e402f55"><div class="ttname"><a href="a01969.html#a758f775d09e1be4cdd80daea4e402f55">Foam::primitiveMesh::pointFaces</a></div><div class="ttdeci">const labelListList &amp; pointFaces() const </div><div class="ttdef"><b>Definition:</b> <a href="a08735_source.html#l00032">primitiveMeshPointFaces.C:32</a></div></div>
<div class="ttc" id="a01470_html_ab5eff13c92babee0ba0af3caec1d7e87"><div class="ttname"><a href="a01470.html#ab5eff13c92babee0ba0af3caec1d7e87">Foam::meshRefinement::getMasterEdges</a></div><div class="ttdeci">static PackedBoolList getMasterEdges(const polyMesh &amp;mesh, const labelList &amp;meshEdges)</div><div class="ttdoc">Determine master edge for subset of edges. If coupled. </div><div class="ttdef"><b>Definition:</b> <a href="a07050_source.html#l02658">meshRefinement.C:2658</a></div></div>
<div class="ttc" id="a05871_html"><div class="ttname"><a href="a05871.html">fvMesh.H</a></div></div>
<div class="ttc" id="a04278_html_a1adbc4c519b2cee284a47d6682036276"><div class="ttname"><a href="a04278.html#a1adbc4c519b2cee284a47d6682036276">points</a></div><div class="ttdeci">const pointField &amp; points</div><div class="ttdef"><b>Definition:</b> <a href="a04278_source.html#l00001">gmvOutputHeader.H:1</a></div></div>
<div class="ttc" id="a01470_html_ab7f36dd5e2a0f638f316332f5e355ea6"><div class="ttname"><a href="a01470.html#ab7f36dd5e2a0f638f316332f5e355ea6">Foam::meshRefinement::getMasterPoints</a></div><div class="ttdeci">static PackedBoolList getMasterPoints(const polyMesh &amp;mesh, const labelList &amp;meshPoints)</div><div class="ttdoc">Determine master point for subset of points. If coupled. </div><div class="ttdef"><b>Definition:</b> <a href="a07050_source.html#l02621">meshRefinement.C:2621</a></div></div>
<div class="ttc" id="a02545_html_a197ed77a9101bdfb37253bd3f507c017"><div class="ttname"><a href="a02545.html#a197ed77a9101bdfb37253bd3f507c017">Foam::syncTools::syncPointList</a></div><div class="ttdeci">static void syncPointList(const polyMesh &amp;, List&lt; T &gt; &amp;, const CombineOp &amp;cop, const T &amp;nullValue, const TransformOp &amp;top)</div><div class="ttdoc">Synchronize values on all mesh points. </div><div class="ttdef"><b>Definition:</b> <a href="a08678_source.html#l00984">syncToolsTemplates.C:984</a></div></div>
<div class="ttc" id="a07039_html"><div class="ttname"><a href="a07039.html">snapParameters.H</a></div></div>
<div class="ttc" id="a01972_html_a180aa335ba66b3224df33de8eb29b3bf"><div class="ttname"><a href="a01972.html#a180aa335ba66b3224df33de8eb29b3bf">Foam::PrimitivePatch::localPoints</a></div><div class="ttdeci">const Field&lt; PointType &gt; &amp; localPoints() const </div><div class="ttdoc">Return pointField of points in patch. </div><div class="ttdef"><b>Definition:</b> <a href="a08741_source.html#l00448">PrimitivePatch.C:448</a></div></div>
<div class="ttc" id="a02113_html"><div class="ttname"><a href="a02113.html">Foam::refinementFeatures</a></div><div class="ttdoc">Encapsulates queries for features. </div><div class="ttdef"><b>Definition:</b> <a href="a07061_source.html#l00051">refinementFeatures.H:51</a></div></div>
<div class="ttc" id="a00714_html_ac47b383852677ce70d239fc1c06b500d"><div class="ttname"><a href="a00714.html#ac47b383852677ce70d239fc1c06b500d">Foam::face::mag</a></div><div class="ttdeci">scalar mag(const pointField &amp;) const </div><div class="ttdoc">Magnitude of face area. </div><div class="ttdef"><b>Definition:</b> <a href="a08531_source.html#l00097">faceI.H:97</a></div></div>
<div class="ttc" id="a01911_html"><div class="ttname"><a href="a01911.html">Foam::polyBoundaryMesh</a></div><div class="ttdoc">Foam::polyBoundaryMesh. </div><div class="ttdef"><b>Definition:</b> <a href="a08626_source.html#l00060">polyBoundaryMesh.H:60</a></div></div>
<div class="ttc" id="a00876_html_a48fcf6de2789aff6b430b5fc1a05693f"><div class="ttname"><a href="a00876.html#a48fcf6de2789aff6b430b5fc1a05693f">Foam::fvMesh::time</a></div><div class="ttdeci">const Time &amp; time() const </div><div class="ttdoc">Return the top-level database. </div><div class="ttdef"><b>Definition:</b> <a href="a05871_source.html#l00243">fvMesh.H:243</a></div></div>
<div class="ttc" id="a10733_html_a5997a67f2e85a15c0e13a1724273aa5f"><div class="ttname"><a href="a10733.html#a5997a67f2e85a15c0e13a1724273aa5f">Foam::pointField</a></div><div class="ttdeci">vectorField pointField</div><div class="ttdoc">pointField is a vectorField. </div><div class="ttdef"><b>Definition:</b> <a href="a08776_source.html#l00042">pointFieldFwd.H:42</a></div></div>
<div class="ttc" id="a01470_html_a7e4205ba28cb720bb897769658b2bcc2"><div class="ttname"><a href="a01470.html#a7e4205ba28cb720bb897769658b2bcc2">Foam::meshRefinement::gAverage</a></div><div class="ttdeci">static T gAverage(const PackedBoolList &amp;isMasterElem, const UList&lt; T &gt; &amp;values)</div><div class="ttdoc">Helper: calculate average. </div><div class="ttdef"><b>Definition:</b> <a href="a07056_source.html#l00059">meshRefinementTemplates.C:59</a></div></div>
<div class="ttc" id="a10733_html_a277dc11c581d53826ab5090b08f3b17b"><div class="ttname"><a href="a10733.html#a277dc11c581d53826ab5090b08f3b17b">Foam::sqr</a></div><div class="ttdeci">dimensionedSymmTensor sqr(const dimensionedVector &amp;dv)</div><div class="ttdef"><b>Definition:</b> <a href="a07870_source.html#l00049">dimensionedSymmTensor.C:49</a></div></div>
<div class="ttc" id="a02469_html"><div class="ttname"><a href="a02469.html">Foam::sumOp</a></div><div class="ttdef"><b>Definition:</b> <a href="a08907_source.html#l00162">ops.H:162</a></div></div>
<div class="ttc" id="a02113_html_af325395e896cf5a85e7d72a0c8c34735"><div class="ttname"><a href="a02113.html#af325395e896cf5a85e7d72a0c8c34735">Foam::refinementFeatures::findNearestPoint</a></div><div class="ttdeci">void findNearestPoint(const pointField &amp;samples, const scalarField &amp;nearestDistSqr, labelList &amp;nearFeature, List&lt; pointIndexHit &gt; &amp;nearInfo) const </div><div class="ttdoc">Find nearest feature point. Sets. </div><div class="ttdef"><b>Definition:</b> <a href="a07060_source.html#l00699">refinementFeatures.C:699</a></div></div>
<div class="ttc" id="a01972_html_ab456054a1e7e1a07261799f50167916f"><div class="ttname"><a href="a01972.html#ab456054a1e7e1a07261799f50167916f">Foam::PrimitivePatch::edgeFaces</a></div><div class="ttdeci">const labelListList &amp; edgeFaces() const </div><div class="ttdoc">Return edge-face addressing. </div><div class="ttdef"><b>Definition:</b> <a href="a08741_source.html#l00308">PrimitivePatch.C:308</a></div></div>
<div class="ttc" id="a01858_html_aebd9283b52c2ab06723a37a4abf61466"><div class="ttname"><a href="a01858.html#aebd9283b52c2ab06723a37a4abf61466">Foam::plane::planeIntersect</a></div><div class="ttdeci">ray planeIntersect(const plane &amp;) const </div><div class="ttdoc">Return the cutting line between this plane and another. </div><div class="ttdef"><b>Definition:</b> <a href="a08772_source.html#l00337">plane.C:337</a></div></div>
<div class="ttc" id="a01972_html_aa454c45ea89f03f5d0bd92ea2f38d85a"><div class="ttname"><a href="a01972.html#aa454c45ea89f03f5d0bd92ea2f38d85a">Foam::PrimitivePatch::faceNormals</a></div><div class="ttdeci">const Field&lt; PointType &gt; &amp; faceNormals() const </div><div class="ttdoc">Return face normals for patch. </div><div class="ttdef"><b>Definition:</b> <a href="a08741_source.html#l00536">PrimitivePatch.C:536</a></div></div>
<div class="ttc" id="a01364_html_aedb985ffeaf1bdbfeccc2a8730405703"><div class="ttname"><a href="a01364.html#aedb985ffeaf1bdbfeccc2a8730405703">Foam::List::setSize</a></div><div class="ttdeci">void setSize(const label)</div><div class="ttdoc">Reset size of List. </div><div class="ttdef"><b>Definition:</b> <a href="a07637_source.html#l00318">List.C:318</a></div></div>
<div class="ttc" id="a03926_html_a2f81f8565e1a8d530c3f1a811faa6614"><div class="ttname"><a href="a03926.html#a2f81f8565e1a8d530c3f1a811faa6614">pFaces</a></div><div class="ttdeci">Info&lt;&lt; &quot;Finished reading KIVA file&quot;&lt;&lt; endl;cellShapeList cellShapes(nPoints);labelList cellZoning(nPoints,-1);const cellModel &amp;hex=*(cellModeller::lookup(&quot;hex&quot;));labelList hexLabels(8);label activeCells=0;labelList pointMap(nPoints);forAll(pointMap, i){pointMap[i]=i;}for(label i=0;i&lt; nPoints;i++){if(f[i] &gt; 0.0){hexLabels[0]=i;hexLabels[1]=i1tab[i];hexLabels[2]=i3tab[i1tab[i]];hexLabels[3]=i3tab[i];hexLabels[4]=i8tab[i];hexLabels[5]=i1tab[i8tab[i]];hexLabels[6]=i3tab[i1tab[i8tab[i]]];hexLabels[7]=i3tab[i8tab[i]];cellShapes[activeCells]=cellShape(hex, hexLabels);edgeList edges=cellShapes[activeCells].edges();forAll(edges, ei){if(edges[ei].mag(points)&lt; SMALL){label start=pointMap[edges[ei].start()];while(start!=pointMap[start]){start=pointMap[start];}label end=pointMap[edges[ei].end()];while(end!=pointMap[end]){end=pointMap[end];}label minLabel=min(start, end);pointMap[start]=pointMap[end]=minLabel;}}cellZoning[activeCells]=idreg[i];activeCells++;}}cellShapes.setSize(activeCells);cellZoning.setSize(activeCells);forAll(cellShapes, celli){cellShape &amp;cs=cellShapes[celli];forAll(cs, i){cs[i]=pointMap[cs[i]];}cs.collapse();}label bcIDs[11]={-1, 0, 2, 4,-1, 5,-1, 6, 7, 8, 9};const label nBCs=12;const word *kivaPatchTypes[nBCs]={&amp;wallPolyPatch::typeName,&amp;wallPolyPatch::typeName,&amp;wallPolyPatch::typeName,&amp;wallPolyPatch::typeName,&amp;symmetryPolyPatch::typeName,&amp;wedgePolyPatch::typeName,&amp;polyPatch::typeName,&amp;polyPatch::typeName,&amp;polyPatch::typeName,&amp;polyPatch::typeName,&amp;symmetryPolyPatch::typeName,&amp;oldCyclicPolyPatch::typeName};enum patchTypeNames{PISTON, VALVE, LINER, CYLINDERHEAD, AXIS, WEDGE, INFLOW, OUTFLOW, PRESIN, PRESOUT, SYMMETRYPLANE, CYCLIC};const char *kivaPatchNames[nBCs]={&quot;piston&quot;,&quot;valve&quot;,&quot;liner&quot;,&quot;cylinderHead&quot;,&quot;axis&quot;,&quot;wedge&quot;,&quot;inflow&quot;,&quot;outflow&quot;,&quot;presin&quot;,&quot;presout&quot;,&quot;symmetryPlane&quot;,&quot;cyclic&quot;};List&lt; SLList&lt; face &gt; &gt; pFaces[nBCs]</div><div class="ttdef"><b>Definition:</b> <a href="a03926_source.html#l00235">readKivaGrid.H:235</a></div></div>
<div class="ttc" id="a01972_html_a4f3f0946737ca194c1976468d653dc21"><div class="ttname"><a href="a01972.html#a4f3f0946737ca194c1976468d653dc21">Foam::PrimitivePatch::boundaryPoints</a></div><div class="ttdeci">const labelList &amp; boundaryPoints() const </div><div class="ttdoc">Return list of boundary points,. </div><div class="ttdef"><b>Definition:</b> <a href="a08741_source.html#l00268">PrimitivePatch.C:268</a></div></div>
<div class="ttc" id="a01872_html"><div class="ttname"><a href="a01872.html">Foam::pointConstraints</a></div><div class="ttdoc">Application of (multi-)patch point contraints. </div><div class="ttdef"><b>Definition:</b> <a href="a06152_source.html#l00062">pointConstraints.H:62</a></div></div>
<div class="ttc" id="a02545_html_a46e7fd91866d97d6f21c35b1a892f0c4"><div class="ttname"><a href="a02545.html#a46e7fd91866d97d6f21c35b1a892f0c4">Foam::syncTools::getMasterFaces</a></div><div class="ttdeci">static PackedBoolList getMasterFaces(const polyMesh &amp;)</div><div class="ttdoc">Get per face whether it is uncoupled or a master of a. </div><div class="ttdef"><b>Definition:</b> <a href="a08676_source.html#l00153">syncTools.C:153</a></div></div>
<div class="ttc" id="a10733_html_a4225a7492f7d468ad5b985282c8ee7b1"><div class="ttname"><a href="a10733.html#a4225a7492f7d468ad5b985282c8ee7b1">Foam::e</a></div><div class="ttdeci">const double e</div><div class="ttdoc">Elementary charge. </div><div class="ttdef"><b>Definition:</b> <a href="a08930_source.html#l00078">doubleFloat.H:78</a></div></div>
<div class="ttc" id="a01885_html_a0c448cd4b96e9ea9ba38c62c019a8bce"><div class="ttname"><a href="a01885.html#a0c448cd4b96e9ea9ba38c62c019a8bce">Foam::PointIndexHit::hitPoint</a></div><div class="ttdeci">const Point &amp; hitPoint() const </div><div class="ttdoc">Return hit point. </div><div class="ttdef"><b>Definition:</b> <a href="a08769_source.html#l00117">PointIndexHit.H:117</a></div></div>
<div class="ttc" id="a01972_html"><div class="ttname"><a href="a01972.html">Foam::PrimitivePatch</a></div><div class="ttdoc">A list of faces which address into the list of points. </div><div class="ttdef"><b>Definition:</b> <a href="a08743_source.html#l00087">PrimitivePatch.H:87</a></div></div>
<div class="ttc" id="a04889_html"><div class="ttname"><a href="a04889.html">polyTopoChange.H</a></div></div>
<div class="ttc" id="a01972_html_a9372e15b6f50db75f39f33f24d4887a4"><div class="ttname"><a href="a01972.html#a9372e15b6f50db75f39f33f24d4887a4">Foam::PrimitivePatch::pointEdges</a></div><div class="ttdeci">const labelListList &amp; pointEdges() const </div><div class="ttdoc">Return point-edge addressing. </div><div class="ttdef"><b>Definition:</b> <a href="a08741_source.html#l00348">PrimitivePatch.C:348</a></div></div>
<div class="ttc" id="a09836_html"><div class="ttname"><a href="a09836.html">OBJstream.H</a></div></div>
<div class="ttc" id="a02033_html"><div class="ttname"><a href="a02033.html">Foam::PtrList</a></div><div class="ttdoc">A templated 1D list of pointers to objects of type &lt;T&gt;, where the size of the array is known and used...</div><div class="ttdef"><b>Definition:</b> <a href="a07638_source.html#l00061">List.H:61</a></div></div>
<div class="ttc" id="a01760_html"><div class="ttname"><a href="a01760.html">Foam::Pair</a></div><div class="ttdoc">An ordered pair of two objects of type &lt;T&gt; with first() and second() elements. </div><div class="ttdef"><b>Definition:</b> <a href="a08816_source.html#l00049">contiguous.H:49</a></div></div>
<div class="ttc" id="a01911_html_aa3446017bbf9e5b33aff322cb86f2072"><div class="ttname"><a href="a01911.html#aa3446017bbf9e5b33aff322cb86f2072">Foam::polyBoundaryMesh::patchID</a></div><div class="ttdeci">const labelList &amp; patchID() const </div><div class="ttdoc">Per boundary face label the patch index. </div><div class="ttdef"><b>Definition:</b> <a href="a08625_source.html#l00399">polyBoundaryMesh.C:399</a></div></div>
<div class="ttc" id="a01531_html"><div class="ttname"><a href="a01531.html">Foam::motionSmoother</a></div><div class="ttdoc">Given a displacement moves the mesh by scaling the displacement back until there are no more mesh err...</div><div class="ttdef"><b>Definition:</b> <a href="a04830_source.html#l00089">motionSmoother.H:89</a></div></div>
<div class="ttc" id="a02733_html"><div class="ttname"><a href="a02733.html">Foam::UIndirectList</a></div><div class="ttdoc">A List with indirect addressing. </div><div class="ttdef"><b>Definition:</b> <a href="a05787_source.html#l00106">fvMatrix.H:106</a></div></div>
<div class="ttc" id="a07724_html_af2484eff8084de37cba5d9d7a00fb293"><div class="ttname"><a href="a07724.html#af2484eff8084de37cba5d9d7a00fb293">FatalErrorInFunction</a></div><div class="ttdeci">#define FatalErrorInFunction</div><div class="ttdoc">Report an error message using Foam::FatalError. </div><div class="ttdef"><b>Definition:</b> <a href="a07724_source.html#l00319">error.H:319</a></div></div>
<div class="ttc" id="a01885_html_afd573313da8eac9d8e6c3064ba18ea8f"><div class="ttname"><a href="a01885.html#afd573313da8eac9d8e6c3064ba18ea8f">Foam::PointIndexHit::missPoint</a></div><div class="ttdeci">const Point &amp; missPoint() const </div><div class="ttdoc">Return miss point. </div><div class="ttdef"><b>Definition:</b> <a href="a08769_source.html#l00130">PointIndexHit.H:130</a></div></div>
<div class="ttc" id="a01917_html_aa3b2dc268f43cd7ca2d043febae4f0e6"><div class="ttname"><a href="a01917.html#aa3b2dc268f43cd7ca2d043febae4f0e6">Foam::polyMesh::faceZones</a></div><div class="ttdeci">const faceZoneMesh &amp; faceZones() const </div><div class="ttdoc">Return face zone mesh. </div><div class="ttdef"><b>Definition:</b> <a href="a08631_source.html#l00463">polyMesh.H:463</a></div></div>
<div class="ttc" id="a04281_html_a6d6b99210a64ad23792eb7a3b0411c42"><div class="ttname"><a href="a04281.html#a6d6b99210a64ad23792eb7a3b0411c42">s</a></div><div class="ttdeci">gmvFile&lt;&lt; &quot;tracers &quot;&lt;&lt; particles.size()&lt;&lt; nl;forAllConstIter(Cloud&lt; passiveParticle &gt;, particles, iter){gmvFile&lt;&lt; iter().position().x()&lt;&lt; &quot; &quot;;}gmvFile&lt;&lt; nl;forAllConstIter(Cloud&lt; passiveParticle &gt;, particles, iter){gmvFile&lt;&lt; iter().position().y()&lt;&lt; &quot; &quot;;}gmvFile&lt;&lt; nl;forAllConstIter(Cloud&lt; passiveParticle &gt;, particles, iter){gmvFile&lt;&lt; iter().position().z()&lt;&lt; &quot; &quot;;}gmvFile&lt;&lt; nl;forAll(lagrangianScalarNames, i){word name=lagrangianScalarNames[i];IOField&lt; scalar &gt; s(IOobject(                                       name,                                       runTime.timeName(),                                       cloud::prefix,                                       mesh,                                       IOobject::MUST_READ,                                       IOobject::NO_WRITE                       ))</div></div>
<div class="ttc" id="a10733_html_a78faa7b12ce7a0cbdf8a1c95d80ea330"><div class="ttname"><a href="a10733.html#a78faa7b12ce7a0cbdf8a1c95d80ea330">Foam::gMaxMagSqr</a></div><div class="ttdeci">Type gMaxMagSqr(const UList&lt; Type &gt; &amp;f, const label comm)</div><div class="ttdef"><b>Definition:</b> <a href="a07943_source.html#l00544">FieldFunctions.C:544</a></div></div>
<div class="ttc" id="a01969_html_a836bb7ec097736e6d0c7903e486776a8"><div class="ttname"><a href="a01969.html#a836bb7ec097736e6d0c7903e486776a8">Foam::primitiveMesh::isInternalFace</a></div><div class="ttdeci">bool isInternalFace(const label faceIndex) const </div><div class="ttdoc">Return true if given face label is internal to the mesh. </div><div class="ttdef"><b>Definition:</b> <a href="a08733_source.html#l00100">primitiveMeshI.H:100</a></div></div>
<div class="ttc" id="a02735_html_ac6e61de369e994009e36f344f99c15ad"><div class="ttname"><a href="a02735.html#ac6e61de369e994009e36f344f99c15ad">Foam::UList::empty</a></div><div class="ttdeci">bool empty() const </div><div class="ttdoc">Return true if the UList is empty (ie, size() is zero). </div><div class="ttdef"><b>Definition:</b> <a href="a07670_source.html#l00313">UListI.H:313</a></div></div>
<div class="ttc" id="a03001_html_ae7e2b1e87cf8932eba1e615fb13c3a2c"><div class="ttname"><a href="a03001.html#ae7e2b1e87cf8932eba1e615fb13c3a2c">relax</a></div><div class="ttdeci">UEqn relax()</div></div>
<div class="ttc" id="a01969_html_a56749206c7d38a4c3cfbf4103547e555"><div class="ttname"><a href="a01969.html#a56749206c7d38a4c3cfbf4103547e555">Foam::primitiveMesh::faceCentres</a></div><div class="ttdeci">const vectorField &amp; faceCentres() const </div><div class="ttdef"><b>Definition:</b> <a href="a08731_source.html#l00140">primitiveMeshFaceCentresAndAreas.C:140</a></div></div>
<div class="ttc" id="a10733_html_ac50d206700f3f71855dd30c9a076de43"><div class="ttname"><a href="a10733.html#ac50d206700f3f71855dd30c9a076de43">Foam::FatalError</a></div><div class="ttdeci">error FatalError</div></div>
<div class="ttc" id="a02113_html_a3c1594dfe7daf51065b42d9a71f2305d"><div class="ttname"><a href="a02113.html#a3c1594dfe7daf51065b42d9a71f2305d">Foam::refinementFeatures::findNearestRegionEdge</a></div><div class="ttdeci">void findNearestRegionEdge(const pointField &amp;samples, const scalarField &amp;nearestDistSqr, labelList &amp;nearFeature, List&lt; pointIndexHit &gt; &amp;nearInfo, vectorField &amp;nearNormal) const </div><div class="ttdoc">Find nearest point on nearest region edge. Sets. </div><div class="ttdef"><b>Definition:</b> <a href="a07060_source.html#l00584">refinementFeatures.C:584</a></div></div>
<div class="ttc" id="a10733_html_ae53117a9770efe95d2d01bb5cc2c99ef"><div class="ttname"><a href="a10733.html#ae53117a9770efe95d2d01bb5cc2c99ef">Foam::nl</a></div><div class="ttdeci">static const char nl</div><div class="ttdef"><b>Definition:</b> <a href="a07784_source.html#l00260">Ostream.H:260</a></div></div>
<div class="ttc" id="a00087_html_ab46a1bc64c9af6414376c6c18d3bee62"><div class="ttname"><a href="a00087.html#ab46a1bc64c9af6414376c6c18d3bee62">Foam::autoPtr::reset</a></div><div class="ttdeci">void reset(T *=0)</div><div class="ttdoc">If object pointer already set, delete object and set to given. </div><div class="ttdef"><b>Definition:</b> <a href="a08447_source.html#l00114">autoPtrI.H:114</a></div></div>
</div><!-- fragment --></div><!-- contents -->
  <!-- end of doxygen-generated content -->
  </div> <!-- main -->
  <div class="footer">
    <p>
      Copyright&nbsp;&copy;&nbsp;2011-2013&nbsp;
      <a href="http://www.openfoam.org/about">OpenFOAM Foundation</a>
      |
      OPENFOAM&reg; is a registered
      <a href="http://www.openfoam.com/legal/trademark-policy.php">trademarks
      </a> of OpenCFD Ltd.
    </p>
    <p class="credits">
      Based on design by
      <a target="new" href="http://1234.info">1234.info</a>
      |
      Content generated by
      <a target="new" href="http://www.doxygen.org">doxygen</a>
    </p>
  </div>  <!-- footer -->
</div>  <!-- page-container -->
</body>
</html>
